
/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Wed Mar 16 2022 @ 12:25
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
 if (window.localStorage.debug === 'true') {
    window.scriptLibStartTime = new Date().getTime();
    console.warn("SCRIPT LIB START TIME: ", window.scriptLibStartTime);
}

function die(msg = "") {
    throw msg != "" ? msg : "dead!!!";
}
if (window.isLibLoaded) {
    console.warn("Script Lib was already loaded");
    die();
}
console.info(
    "%c Script Lib was loaded successfully! ",
    "background: #222; color: #bada55"
);
window.isLibLoaded = true;
window.block3DaysFunc = false;

function fix_jQueryDollarSign() {
    // This function will fix jquery dollar dign problem temporary

    console.log("started jquery fixer");
    let startTime = new Date().getTime();
    let hwd = setInterval(() => {
        $ = jQuery;
        if (startTime + 20000 <= new Date().getTime()) {
            clearInterval(hwd);
            console.log("jquery fixer finished after 20 seconds");
        }
    }, 1);
}
// fix_jQueryDollarSign();

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Thu Mar 24 2022 @ 16:25
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
class ScriptLibFunctions { 

constructor() {
this.methodsEndedExecutionCount = 0;
const worker1 = setInterval(() => {
    if(typeof scriptLibFunctions.testModeFunction === 'function') {
        window.dispatchEvent(new Event("onWaitingForFictionsStart"));
        clearInterval(worker1);
    }
}, 1);

const worker2 = setInterval(() => {
    if($('div#loading-wrapper').length>1 ) {
      let thisElement = $($('div#loading-wrapper')[1]);
      if(thisElement.next().html().startsWith('#loading-wrapper')){
        thisElement.remove();
      }
    }
}, 100);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
testModeFunction() {if (!scriptLib.runThisFunctionOnlyInTestMode("610a1d9e-6052-4822-ad93-e0e65dbcdd7a")) return;
        // 610a1d9e-6052-4822-ad93-e0e65dbcdd7a ====> this is the UUID of this test function
        /**
         * IMPORTANT !!!!!!!!!!!!!!!!!!!!!!!!!!!          DONT DELETE THIS FUNCTION CUZ ITS USED IN THE CONSTRUCTOR
    *) to set the test mode:
    add SCRIPT_LIB_TEST_UUID to the request url forwarded by the equal sign and the function UUID example:
    https://www.mediamarkt.com.tr/tr/product/_samsung-galaxy-a52-128-gb-ak%C4%B1ll%C4%B1-telefon-siyah-1215223.html?ga_query=1215223&SCRIPT_LIB_TEST_UUID=610a1d9e-6052-4822-ad93-e0e65dbcdd7a
    *) to unset the test mode:
    add SCRIPT_LIB_TEST_UUID_END to the request url example:
    https://www.mediamarkt.com.tr/tr/product/_samsung-galaxy-a52-128-gb-ak%C4%B1ll%C4%B1-telefon-siyah-1215223.html?ga_query=1215223&SCRIPT_LIB_TEST_UUID_END
*/
        console.log(
            "the function has been called successfully from test mode\nAdd &SCRIPT_LIB_TEST_UUID_END to the url to exit test mode"
        );

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
LoadingForWawlabs() {
/*
let loading = `
<div id="loading-wrapper"><img src="https://csscdn.redblue.de/MediaTR/skins/102021/tr/images/general/mm-loader.gif" alt="loading icon"></div><style>#loading-wrapper{display:flex;position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;justify-content:center;align-items:center;background-color:#fff}</style>
`;
*/
let { pathname, search } = window.location
let queryString = search;
let urlParams = new URLSearchParams(queryString);
let parm = urlParams.get('query');

if (scriptLib.isBasketPage) {
   // dont remove the loading layer if basket-main-content exists. because the new design send a load finished event
   // we remove it only on the old design.
    if($("#basket-main-content").length==0) {
      setTimeout( () => {
        scriptLib.SetLoadingLayer(false);
      }, 1500);
    }
}
else if (!scriptLib.isSearchPage) {
    setTimeout( () => {
        scriptLib.SetLoadingLayer(false);
    }, 1500);
} else {
    // scriptLib.injectJS("//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/wawlabsLoadingSearch_D_M.min.js");
    if (parm && parm.toUpperCase().startsWith('PFF_')) { // case of "kampanya" page
      // burağa soralım campain=true ilgili
      $('#loading-wrapper').remove();
      return;
    }
    fetch('//mm.wawlabs.com').then((res) => {
      if (res.status === 200) {
          // $('body').append(loading);
          
          if(scriptLib.isDesktop) {
            $('#sidebar-wrapper').remove();
            $('<div id="content-page"></div>').insertBefore('body > .ms-container');
          } 
          else if(scriptLib.isMobile) {
            $('.product-list-container').remove();
            $('#wrapper-main > section:not(.fixed-search-container)').remove();
            $('#wrapper-main .mrh-endless-scroll-end').remove();
            $('#wrapper-main .seg-reco-wrapper').remove();
            $('#wrapper-main .contentspot.grid').remove(); // this removes the not found message
            $('<div id="content-page"></div>').insertBefore('body > #wrapper-main > .ms-container');
          }
          scriptLib.injectJS('https://collector.wawlabs.com/mmsearch.js');
          //scriptLib.SetLoadingLayer(false);
          setTimeout( () => {
             scriptLib.SetLoadingLayer(false);
          }, 1500);
      }
    })
}

$(document).on('onScriptLibReady', () => {
  scriptLib.SetLoadingLayer(false);
});

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
processNewDeviceRequest() {
if(!document.location.pathname.replace('/tr/shop/','').startsWith('eski-cihazini-yenile')) return;
let buttonSelector = ".crfl_menu-inner";
scriptLib.waitUntilFieldCreated(buttonSelector).then(() => {
    $(buttonSelector).click((e) => {
        e.target.setAttribute("disabled", "disabled");
        var url_string = window.location.href;
        var url = new URL(url_string);
        var returnCode = url.searchParams.get("returnCode");
        var uId = "";
        // if(mcs && mcs.user && mcs.user.authenticated) {
        if (mcs && mcs.user && mcs.user.loginStatus != "OUT") {
            uId = mcs.user.userId;
        }
        if (!uId) {
            window.location.href =
                "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/LogonForm?redirectURL=" +
                window.location.href;
            return;
        }
        var src =
            "https://bayi.fintegre.com/OnlineBuyback?id=6912&requestID=" +
            uId * 2 +
            "&returnCode=" +
            returnCode +
            "&userId=" +
            uId;
        window.location.href = src;
    });
});

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async setKargoExpectedDate() {if (!scriptLib.runThisFunctionOnlyInTestMode("b749ddb1-b2e6-42e9-a860-76bcf484a006")) return;
/*
*********************************************************************************************************
*********************************************************************************************************
*********************************************************************************************************

**** this function is passed to Test Mode
**** if it still not used then it would be deleted from the code list
        
*********************************************************************************************************
*********************************************************************************************************
*********************************************************************************************************

*/

return;
if (!scriptLib.isPDP) return; // quit when page is not PDP
let f = new Intl.DateTimeFormat("tr-TR", {
    weekday: "long",
    day: "2-digit",
    month: "long",
});
// cancel when a specific date:
const isForceMessageInThisPeriod = (a, b) => {
    let d = new Date();
    let c1 = d > new Date(a);
    let c2 = d < new Date(b);
    let c3 = c1 && c2;
    return c3;
};
//---------------------------
function isIphone14() {
    // if(!scriptLib.runThisFunctionOnlyInTestMode('40bb22ca-3af9-4444-ba17-6c7b1dc9cc4c')) return false;
    let headEl;

    // declaration head element
    if (scriptLib.isPDP) {
        headEl = document.querySelector('#product-details > .details > h1')
    }
    if (scriptLib.isPDP && scriptLib.isMobile) {
        headEl = document.querySelector('h1.product-overview-title span.ellipsis_text')
    }

    // is the title has ihphone 14

    let regex = /i[pP]hone\s*14\s*/gm;
    if (regex.exec(headEl.textContent)) {
        return true
    } else {
        return false
    };
}
//---------------------------
let d = new Date();
let text =
    "En geç " +
    f.format(scriptLib.getNextWorkDay(d)) +
    " günü kargoya verilir.";
if (new Date().getHours() < 14) {
    // 13 Temmuz Tarihinde Kargoda!
    text = "Saat 14:00’a kadar sipariş verin bugün kargoda!";
    block3DaysFunc = false;
}
if (isForceMessageInThisPeriod("Jul 8 2022 12:00", "Jul 12 2022 14:00")) {
    // 13 Temmuz Tarihinde Kargoda!
    text = "13 Temmuz Tarihinde Kargoda!";
    block3DaysFunc = true;
}
if (
    isForceMessageInThisPeriod("Sep 15 2022 23:50", "Sep 22 2022 23:54") &&
    isIphone14()
) {
    // 13 Temmuz Tarihinde Kargoda!
    text = "Ön Sipariş! 14 İş günü içerisinde kargoda";
    block3DaysFunc = true;
}
if (
    isForceMessageInThisPeriod("Sep 16 2022 14:00", "Sep 17 2022 12:00") &&
    !isIphone14()
) {
    // 13 Temmuz Tarihinde Kargoda!
    if (scriptLib.isDesktop) {
        scriptLib.waitUntilFieldCreated(".price-details .infobox ul li.send-stock").then((res) => {
            if (res) {
                text = "19 Eylül'de Kargoda!";
                $(".price-details .infobox ul li.send-stock").text(text);
                block3DaysFunc = true;
            }
        })
    }
    if (scriptLib.isMobile) {
        scriptLib.waitUntilFieldCreated("#type-standard-delivery h2.green").then((res) => {
            if (res) {
                text = "19 Eylül'de Kargoda!";
                $("#type-standard-delivery h2.green").text(text);
                block3DaysFunc = true;
            }
        })
    }

}

if (scriptLib.isDesktop) {
    scriptLib.waitUntilFieldCreated(".price-sidebar .infobox ul > span")
        .then(res => {
            if (res) {
                $(".price-sidebar .infobox ul > span").text(text);
            }
        })
    scriptLib.waitUntilFieldCreated(".price-sidebar .infobox ul > li:first-child")
        .then(res => {
            if (res) {
                $(".price-sidebar .infobox ul > li:first-child").text(text);
            }
        })
} else if (scriptLib.isMobile) {
    if (
        await scriptLib.waitUntilFieldCreated(
            "#type-standard-delivery h2.green"
        )
    ) {
        $("#type-standard-delivery h2.green").text(text);
        $(".mrh-delivery-type .delivery-type-item h2").css(
            "margin-left",
            "25px"
        );
        $("#delivery-type").css("flex-direction", "column");
        if ($("#delivery-type .stok-sorgu").length === 1) {
            $("#delivery-type").css("height", "60px");
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
iphone14BasketpagesetCargoDate() {if (!scriptLib.runThisFunctionOnlyInTestMode("f85d2ea5-d5cb-4997-86f1-80ed9b9dc00d")) return;
let regex = /i[pP]hone\s*14\s*/gm;

if (scriptLib.isDesktop && scriptLib.isBasketPage) {
    let els = document.querySelectorAll('.ctable-wrapper tbody.cart-product-table')
    els.forEach(function(e) {
        let text = e.querySelector('.cproduct h4 span')
        let head = e.querySelector('.cproduct-heading')
        if (regex.exec(head.textContent)) {
            text.textContent = "Ön Sipariş! 14 İş günü içerisinde kargoda";
        }
    })
}
if (scriptLib.isMobile && scriptLib.isBasketPage) {
    let els = document.querySelectorAll('.dynamic-basket-wrapper section.basket-teaser-item')
    els.forEach(function(e) {
        let text = e.querySelector('.basket-teaser-delivery .standard-delivery')
        let head = e.querySelector('.basket-product-title-wrapper h2:nth-child(1)')
        if (regex.exec(head.textContent)) {
            text.textContent = "Ön Sipariş! 14 İş günü içerisinde kargoda";
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
iphone14ListPagesetCargoDate() {if (!scriptLib.runThisFunctionOnlyInTestMode("115727df-8d2d-4e28-acce-a79bcf38f406")) return;
let regex = /i[pP]hone\s*14\s*/gm;

if (scriptLib.isDesktop && scriptLib.isPLP) {

    scriptLib.waitUntilFieldCreated('ul.products-list > li .product-wrapper').then((res) => {
        if (res) {
            let els = document.querySelectorAll('ul.products-list > li .product-wrapper')
            els.forEach(function(e) {
                let text = e.querySelector('.availability ul > span')
                let head = e.querySelector('.content h2 a')
                let regExMatch = head.textContent.match(regex);
                if (regExMatch && (regExMatch.length > 0)) {
                    text.textContent = "Ön Sipariş! 14 İş günü içerisinde kargoda";
                }
            })
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
iphone14BasketNextPagesetCargoDate() {if (!scriptLib.runThisFunctionOnlyInTestMode("f7809b29-4b75-40a3-8ec4-47d8e78358c3")) return;
if (scriptLib.isRegisterBasketPage) {

    let regex = /i[pP]hone\s*14\s*/gm;

    scriptLib.waitUntilFieldCreated('.checkout-logon .ctable-wrapper tbody.cart-product-table').then((res) => {
        if (res) {
            let els = document.querySelectorAll('.checkout-logon .ctable-wrapper tbody.cart-product-table')
            els.forEach(function(e) {
                let text = e.querySelector('.cproduct-info div.ng-scope span.ng-scope')
                let head = e.querySelector('.cproduct-info a h2')
                if (regex.exec(head.textContent)) {
                    text.textContent = "Ön Sipariş! 14 İş günü içerisinde kargoda";
                }
            })
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
removeiPhone14infoBadge() {
if (scriptLib.isMobile && scriptLib.isPDP) {

    scriptLib.waitUntilFieldCreated('#delivery-type #type-standard-delivery h2 a span.icon').then((res) => {
        if (res) {
            let regex = /i[pP]hone\s*14\s*/gm;
            let headEl = document.querySelector('.product-overview-title span.ellipsis_text')
            let badge = document.querySelector('#delivery-type #type-standard-delivery h2 a span.icon')
            if (regex.exec(headEl.textContent)) {
                badge.style.display = 'none';
            }
        }
    })

}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async showIphoneWarning() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
if (scriptLib.isDesktop) {
    // 644527
    function isIphone() {
        return new Promise((resolve) => {
            if (
                $('h1[itemprop="name"]').text().toLowerCase().includes("iphone")
            ) {
                resolve(true);
            }
            resolve(false);
        });
    }
    if (await isIphone()) {
        $(
            'div[data-cms-id="product_detail-content_social_media_snippet"]'
        ).prepend(
            "<h3>iPhone ürün kutusu içerisinde kulaklık ve adaptör bulunmamaktadır.</h3>"
        );
    }
} else if (scriptLib.isMobile) {
    if (
        await scriptLib.waitUntilFieldCreated(
            "#swogo-bundle-1 .swogo-bundle-title"
        )
    ) {
        let divGrid = $("#add-to-basket-buttons").parent();
        if (
            $(".product-overview-title span")
            .text()
            .toLowerCase()
            .includes("iphone")
        ) {
            divGrid.after(
                '<h3 style="margin-bottom:10px;color:#df0000;padding:0 10px;">iPhone ürün kutusu içerisinde kulaklık ve adaptör bulunmamaktadır.</h3><div class="bundle-wrapper"></div>'
            );
        } else {
            divGrid.after('<div class="bundle-wrapper"></div>');
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async manageAssistBox() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
let time = new Date();
let currentHour = time.toLocaleString("tr-TR", {
    hour: "numeric",
    hour12: false,
});
currentHour = parseInt(currentHour);
if (currentHour < 10 || currentHour >= 22) {
    if (
        await scriptLib.waitUntilFieldCreated("#assistboxConnectButton", 30)
    ) {
        $("#assistboxConnectButton").addClass("hide-assistbox");
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async setKargoMessageInPDP() {
if (window.block3DaysFunc) {
    return;
}
if (!scriptLib.isPDP) return; // quit when page is not PDP

(async() => {
    let f = new Intl.DateTimeFormat("tr-TR", {
        weekday: "long",
        day: "2-digit",
        month: "long",
    });
    //---------------------------------------------------------------------------------
  
    // normal days with all products: 
    let d = new Date();
    let mesaj =
        "En geç " +
        f.format(scriptLib.getNextWorkDay(d)) +
        " günü kargoya verilir.";
    if (new Date().getHours() < 14) {
        mesaj = "Saat 14:00’a kadar sipariş verin bugün kargoda!";
        // block3DaysFunc = false;
    }
    //---------------------------------------------------------------------------------

    // in case of BSP products:
    let brandList = ["bosch", "siemens", "profilo"];
    let itemList = [
        "çamaşır mak",
        "buzdolabı",
        "bulaşık",
        "kurutma mak",
        "ocak",
        "fırın",
        "davlumbaz",
        "ankastre",
        "aspiratör",
        "dondurucu",
    ];
    let brand = scriptLib.getProductBrand();
    let title = await scriptLib.getProductTitle();

    function isItemExist() {
        return new Promise((resolve) => {
            itemList.forEach((el) => {
                if (title.toLowerCase().includes(el)) {
                    resolve(true);
                }
            });
            resolve(false);
        });
    }

    let isBrandTrue = brandList.includes(brand.toLowerCase());
    let isItemTrue = await isItemExist();
    if (isBrandTrue && isItemTrue) {
        mesaj = '3 iş günü içerisinde kargoya verilecektir<span style="display:none;" class="icon icon-info" data-layer="StoktanGonderi"></span>';
    }
    //---------------------------------------------------------------------------------

    // override the message in this period for all the products
    if(scriptLib.AreWeInThisPeriod("Sep 16 1998 14:00", "Nov 30 2022 23:59")) {
        mesaj = '1-3 iş gününde kargoda!';
        scriptLib.injectBrutCSS(`a[data-layer="StoktanGonderi"]{display:none !important;}`);
    }
    //---------------------------------------------------------------------------------

    // Show the message in the PDP
    if (scriptLib.isDesktop && await scriptLib.waitUntilFieldCreated(".price-sidebar .infobox .send-stock")) {
        $(".price-sidebar .infobox .send-stock").html(mesaj );
        $("#product-details > div.price-sidebar > div.price-details > div.box.infobox.availability > ul > li:nth-child(1)").html(mesaj );
    }
    else if (scriptLib.isMobile && await scriptLib.waitUntilFieldCreated("#type-standard-delivery h2.green")) {
        $("#type-standard-delivery h2.green").html(mesaj);
    }
})();

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async removePickupStoreBtnForOutletProducts() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
let sku = scriptLib.getProductSKU();
if (sku[0] === "3") {
    // outlet products start with '3'
    if (await scriptLib.waitUntilFieldCreated(".store-delivery")) {
        $(".store-delivery").remove();
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async swogoForCategoryAndSearchPages() {if (!scriptLib.runThisFunctionOnlyInTestMode("9b6bed7b-2cb9-470b-a41c-9b954a2e7db7")) return;
// https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=9b6bed7b-2cb9-470b-a41c-9b954a2e7db7
let currentPage = scriptLib.isCategoryPage || scriptLib.isSearchPage;
if (!currentPage) return; // exits if the current page is different than category or search pages
// insert a swogo dom in production for swogo's develooppers test and shpıld be deleted later:
setInterval(() => {
    $("#swogo-bundle-0").length ||
        $('#basket-flyout div[data-cms-id="precheckout-layer"]').after(
            '<div id="swogo-bundle-0" class="swogo-box"></div>'
        );
}, 50);
// end of this block
//
if (!window.isOnLoadingFinishedEventMounted) {
    window.isOnLoadingFinishedEventMounted = true;
    document.addEventListener("onLoadingFinished", function() {
        // console.log("event onLoadingFinished: create swogo btns");
        scriptLibFunctions.swogoForCategoryAndSearchPages();
    });
}
const fillDataLayer = (id, name, price, brand) => {
    let obj = {
        ecommerce: {
            add: {
                products: [{
                    id: id,
                    name: name,
                    price: price.replace("-", "00"),
                    dimension9: "",
                    dimension10: "",
                    dimension24: "",
                    dimension25: "InStock",
                    brand: brand,
                }, ],
            },
        },
        event: "EECaddToCart",
    };

    let ndx = -1;
    [...dataLayer].findIndex((layer, i) => {
        layer.event === "EECaddToCart" && (ndx = i);
    });
    if (ndx > -1) {
        dataLayer[ndx] = obj;
    } else {
        dataLayer.push(obj);
    }
};
//scriptLib.injectJS('https://ui.swogo.net/bundles/v4/mediamarktComTr/swogo.js');
let buttonList = $(".product-wrapper .product-price a.button.add-to-cart");
buttonList.hide();
$(".product-wrapper .button.new-add-2-cart").remove();
buttonList.after(
    `<button class="button new-add-2-cart">Sepete Ekle</button>`
);
let html = `<div id="mm-popup" style="display:none;"><div class="overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#0000004f;z-index:9999;"></div><div class="content" style="width:100%;top:0;z-index:10000;position:fixed;padding:20px 40px;"><svg class="cls-icn" width="32px" height="32px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="close"><rect width="24" height="24" transform="rotate(180 12 12)" opacity="0"></rect><path d="M13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29-4.3 4.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l4.29-4.3 4.29 4.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path></g></g></svg><div class="precheckout-header"><h3>Ürün Sepete Eklenmiştir</h3><div><img src="//assets.mmsrg.com/isr/166325/c1/-/ASSET_MMS_89722915/fee_325_225_png/APPLE-iPhone-11-128GB-Ak%C4%B1ll%C4%B1-Telefon-Siyah"><div class="basket-items"><div><span class="prod-title">APPLE iPhone 11 128GB Akıllı Telefon Siyah</span><span class="prce">13499₺</span></div></div></div></div><div class="buy-with-wrapper"><div id="swogo-bundle-0" class="swogo-box"></div><span class="left-arrw" style="display:block;"></span><span class="right-arrw" style="display:block;"></span></div><div class="buttons-container"><div class="button-white">&#9664; Alişverişe Devam Et</div><div class="button-green-pdp" id="add-item-to-basket">Sepete Git</div></div></div></div>`;
html += `<style>#mm-popup .cls-icn {position: absolute;right: -21px;top: -21px;background: #fff;border-radius: 100%;border: 1px solid #ddd;padding: 5px;cursor: pointer;}#mm-popup>div.content{background:#fff;border:1px solid #ddd;font-size:18px;display:flex;justify-content:center;flex-direction:column;align-items:center;width:90%;max-width:956px;box-sizing:border-box;border-radius:5px;box-shadow:0 0 3px 0 #ccc;position:relative;max-height:90vh;margin:5vh auto 0;padding-bottom:30px}#swogo-bundle-0 .swogo-bundle-products{max-width:756px}.precheckout-header{width:100%;background:#f8f8f8;padding:0 30px 10px;box-sizing:border-box;border-radius:10px;border: 1px solid #aaaaaa;}.precheckout-header>div{display:flex;align-items:center;justify-content:space-between;margin:15px 0 10px}.precheckout-header img{max-width:80px;max-height:60px}.precheckout-header h3{color:#000;font-size:24px;line-height:50px}#colorbox .prce{display:inline-block;font-weight:700}#colorbox .precheckout-content .prce{font-weight:700;font-size:18px}.sub-products{font-size:16px;padding-left:20px;margin-top:5px;position:relative;line-height:18px;font-weight:400}.sub-products .del{background:url(http://data.mediamarkt.com.tr/ux/spritescd.png) no-repeat;background-position:-243px -67px;width:16px;height:16px;position:absolute;right:-25px;top:0;cursor:pointer}.precheckout-body{display:flex;flex-direction:column;width:100%;box-sizing:border-box;position:relative;max-height:calc(90vh - 127px);overflow-y:auto;padding-bottom:30px}.precheckout-content{padding:0 50px 30px 130px;position:relative}.precheckout-content>p{color:#444;font-size:22px;margin:25px 0 15px;font-weight:700}.chckbx-row{display:flex;justify-content:space-between;padding:2px 0;align-items:center;position:relative}.precheckout-body label{display:flex;align-items:center}.precheckout-body input{width:24px;height:24px;margin-right:15px}.precheckout-body .precheckout-action{justify-content:space-around;margin-top:30px;display:flex}.precheckout-btn{padding:10px 40px;color:#fff;background:green;border:1px solid green;border-radius:4px}.precheckout-btn.passive{color:#4f4f4f;background:#fff}.left-arrw,.right-arrw{position:absolute;left:20px;width:40px;height:40px;border:1px solid #ddd;top:50%;margin-top:-20px;border-radius:5px;cursor:pointer;background:#f8f8f8}.right-arrw{left:auto;right:20px}.left-arrw:before,.right-arrw:before{background:url(http://data.mediamarkt.com.tr/ux/spritescd.png) -106px -18px no-repeat transparent;width:10px!important;height:19px!important;display:inline-block;content:'';transform:translate(-50%,-50%);left:50%;top:50%;position:absolute}.right-arrw:before{background-position:-116px -18px}.pre-mess{position:absolute;bottom:5px;padding:10px;background:green;color:#fff;min-width:70%;border-radius:4px;display:none}.pre-mess.gray{background:#918e8c}.garanti-koruma-frame footer,.garanti-koruma-frame header{display:none}.garanti-koruma-frame{width:100%;min-height:3800px}.read-mr{padding:0 20px 20px}.read-mr:not(.service){text-indent:9px;padding-bottom:10px}.read-mr span{text-decoration:underline}#colorbox .cls-icn{position:absolute;right:-21px;top:-21px;background:#fff;border-radius:100%;border:1px solid #ddd;padding:5px;cursor:pointer}.buy-with-wrapper{display:flex;padding:20px 100px;background: url(https://data.mediamarkt.com.tr/uploads/loading.gif);min-width:85%;background-size:150px;background-repeat:no-repeat;background-position:center;filter:brightness(1.1)}.buy-with{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;width:33%}.buy-with img{max-width:100%}.buy-with .price{background:url(//css.redblue.de/fee/BaseSkin/images/currency-tr.png) left 26px no-repeat;display:inline-block!important;margin:-30px 0 0 0!important;width:auto!important;height:auto}.buy-with a{font-weight:700;font-size:20px;line-height:22px;height:44px;margin:10px;overflow:hidden}.buy-with button{padding:10px 20px;background:#4f4f4f;color:#fff;border:1px solid #4f4f4f;border-radius:4px}.basket-items{flex:1;padding:0 20px;font-weight:700;font-size:21px;line-height:25px}.basket-items span::not(.prce){max-width:80px}.basket-items>div{display:flex;justify-content:space-between}.iiiinfo,.iinfo{background:url(https://csscdn.redblue.de/fee/mobile_mrh/images/icon-64x64-info.png) no-repeat;width:14px;height:14px;background-size:14px 14px;margin-left:5px;flex:1}.g-img{display:none;position:absolute;left:0;top:calc(100% + 5px)}.button-green-pdp{background:#090!important;text-shadow:none;text-transform:none;font-family:mm-text-bold,Arial;font-weight:400!important;text-align:center;padding:12px;color:#fff;font-size:20px;border-radius:4px;cursor:pointer;line-height:18px;border-radius:24px}#swogo-bundle-0 .swogo-product.swogo-accessory .swogo-atc{border-radius:24px!important}#colorbox .button-green-pdp{width:100%;max-width:186px;margin-top:30px}.sidebar-form .cf .price-button{width:calc(100% - 120px)!important;margin-top:-50px!important}span.left-arrw.disabled,span.right-arrw.disabled{pointer-events:none;cursor:default;filter:opacity(.4)}input[type=checkbox]{filter:hue-rotate(251deg) brightness(1)}.layer-content{margin-top:20px}.layer-content .fg-container{visibility:visible}.fg-box.mpy1{position:relative}#product-details>div.price-sidebar>div.price-details>span{text-decoration:underline;color:#090;cursor:pointer}.#swogo-bundle-0 .swogo-product.swogo-accessory .swogo-atc{border-radius: 100vh !important;}#mm-popup>div.content>.buttons-container{display: flex;width: 100%;justify-content: space-between;align-content: space-around;}#add-item-to-basket{width:300px}.buttons-container .button-white{border: 2px solid #bfbfbf;padding: 0 40px;border-radius: 100vh;font-size:14px;line-height:38px}#mm-popup{display: flex;width: 100vw;justify-content: center;}.precheckout-header h3{color: #f00;}#mm-popup .button-white{cursor:pointer;}#swogo-bundle-0 .swogo-bundle-title{display:none}#swogo-bundle-0{min-height:344px}#swogo-bundle-0 .swogo-bundle-products{background-color:#fff}</style>`;
setTimeout(() => {
    //console.log(swogo);
    $("body").append(html);
    $("#mm-popup .cls-icn").click((e) => {
        $("#mm-popup").hide();
        $("#swogo-bundle-0").html("");
    });
    $("#mm-popup .button-white").click((e) => {
        $("#mm-popup").hide();
        $("#swogo-bundle-0").html("");
    });
    $("#add-item-to-basket").click((e) => {
        window.location.href =
            "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14";
    });
    $(".button.new-add-2-cart").click(async(e) => {
        let data = $(e.target)
            .parent()
            .find("a.button.add-to-cart")
            .attr("data-href");
        let price = $(e.target)
            .parent()
            .parent()
            .find(".price-box .price")
            .text();
        let title = $(e.target)
            .parent()
            .parent()
            .parent()
            .find(".content h2 a")
            .text()
            .replace(/\t|\n/gm, "");
        let imgPath = $(e.target)
            .parent()
            .parent()
            .parent()
            .find(".product-photo .photo-wrapper img")
            .attr("src");
        $("#mm-popup .basket-items .prod-title").text(title);
        $("#mm-popup .basket-items .prce").text(price);
        $("#mm-popup img").attr("src", imgPath);
        let sku = $(e.target)
            .parent()
            .parent()
            .parent()
            .find(".content .article-number")[0]
            .innerText.split(": ")[1];
        let brand = $(e.target)
            .parent()
            .parent()
            .parent()
            .find(".content .manufacturer img")
            .attr("alt");
        fillDataLayer(sku, title, price, brand);
        /*await*/
        fetch(data);
        $("#mm-popup").show();
    });
}, 1000);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
SwogoHeroPDP() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
scriptLib
.waitUntilFieldCreated(".store-delivery.button-green-pdp")
.then(() =>
    $(".store-delivery.button-green-pdp").after(
        '<div id="swogo-bundle-0" class="swogo-box"></div>'
    )
);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async loadTvSliderFiles() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
if (scriptLib.isDesktop) {
    if ((await scriptLib.waitUntilFieldCreated(".breadcrumbs li"), 20)) {
        if ($("ul.breadcrumbs").html().indexOf("465019.html") !== -1) {
            scriptLib.injectCSS(
                "https://data.mediamarkt.com.tr/ux/tv-slide-desc/tv-slider-desc.css"
            );
            scriptLib.injectJS(
                "https://data.mediamarkt.com.tr/ux/tv-slide-desc/tv-slider-desc.js"
            );
        }
    }
} else if (scriptLib.isMobile) {
    if ((await scriptLib.waitUntilFieldCreated(".breadcrumbs li"), 20)) {
        var ct = $('meta[property="prudsys:recomm:parentcategory"]').attr(
            "content"
        );
        if (ct && ct === "465019") {
            scriptLib.injectCSS(
                "https://data.mediamarkt.com.tr/ux/tv-slide-desc/tv-slider-desc-m.css"
            );
            scriptLib.injectJS(
                "https://data.mediamarkt.com.tr/ux/tv-slide-desc/tv-slider-desc-m.js"
            );
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async changeMoreClickableLink() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
if (scriptLib.isDesktop) {
    if ((await $("a.more.clickable"), 20)) {
        $("a.more.clickable").text("İade koşulları için tıklayınız");
        $("a.more.clickable").removeAttr("href");
        $("a.more.clickable").removeAttr("data-clickable-href");
        $("a.more.clickable").attr(
            "href",
            "https://www.mediamarkt.com.tr/tr/shop/yardim/iade.html"
        );
        $("a.more.clickable").attr("target", "_blank");
    }
} else if (scriptLib.isMobile) {
    if ((await $("#type-standard-delivery"), 20)) {
        $("#type-standard-delivery").after(
            '<a class="return-condition" href="https://www.mediamarkt.com.tr/tr/shop/yardim/iade.html" target="_blank">İade koşulları için tıklayınız</a>'
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async setTabMenuPDP() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
if (scriptLib.isDesktop) {
    var tabsHtml = [
        '<div class="contentspot "><div id="pdp-tab"><div class="pdp-tabs">',
        '<span id="pdp-tab4" class="active" style="display: none;">Ürün Açıklaması</span>',
        '<span id="pdp-tab3" style="display: none;">Teknik Özellikler</span>',
        '<span id="pdp-tab1" style="display: none;">Tamamlayıcı Ürünler</span>',
        '<span id="pdp-tab2" style="display: none;">Cihazınızın Ömrünü Uzatın</span>',
        '<span id="pdp-tab5" style="display: none;">Ürün Yorumları</span>',
        '<span id="pdp-tab6" style="display: none;">Taksit/Kredi Seçenekleri</span>',
        "</div>",
        '<div class="tab-content">',
        '<div class="content1" style="display: none">',
        "</div>",
        '<div class="content2" style="display: none">',
        "</div>",
        '<div class="content3" style="display: none">',
        "</div>",
        '<div class="content4">',
        "</div>",
        '<div class="content5" style="display: none">',
        "</div>",
        '<div class="content6" style="display: none">',
        "</div>",
        "</div></div></div>",
    ].join("");

    $("#product-details").after(tabsHtml);
    $("#product-sidebar").removeClass("stickable").removeClass("sticky");

    var rcmCount = 0;
    var rcmInterval = setInterval(function() {
        if ($("#rcm-container") && $("#pdp-tab").length) {
            $(".content4").append($("#rcm-container"));
        }
        if ($("#ccs-inline-content") && $("#pdp-tab").length) {
            $(".content4").append($("#ccs-inline-content"));
        }
        if ($('div[id^="ins-custom-container"]').length) {
            $(".content4").append($('div[id^="ins-custom-container"]'));
            $("#pdp-tab4").show();
        }
        if ($("#flix-inpage").length) {
            $(".content4").append($("#flix-inpage"));
            $("#pdp-tab4").show();
        }
        
        rcmCount++;
        if (rcmCount === 10) {
            clearInterval(rcmInterval);
        }
    }, 1000);
    

    if ((await $("#product_detail_page_14-content_stage_bottom"), 20)) {
        $(".content1").append(
            $("#product_detail_page_14-content_stage_bottom")
        );
        $("#pdp-tab1").show();
    }
    if ((await $("#product-details .premiumboxes"), 20)) {
        $(".content2").append($("#product-details .premiumboxes"));
        $("#pdp-tab2").show();
    }
    if ((await $("#product-details #product-service"), 20)) {
        $(".content2").append($("#product-details #product-service"));
        $("#product-service").addClass("premiumopts");
        $("#product-service li").removeClass("even").addClass("cf");
        $("#pdp-tab2").show();
    }
    if ((await $("#teknik-bilgiler"), 20)) {
        $(".content3").append($("#teknik-bilgiler"));
        $("#pdp-tab3").show();
    }
    if ((await $("#features"), 20)) {
        $(".content3").append($("#features"));
        $(".content3").append($(".features-wrapper"));
        $("#pdp-tab3").show();
    }
    if ((await $("#produktdetail_seite_3-bottom_right"), 20)) {
        $(".content4").append($("#produktdetail_seite_3-bottom_right"));
        $("#pdp-tab4").show();
    }
    if ((await $("#_C3_BCr_C3_BCn-detaylar_C4_B1"), 20)) {
        $(".content4").append($("#_C3_BCr_C3_BCn-detaylar_C4_B1"));
        $("#pdp-tab4").show();
    }
    if ((await $("#yorumlar-"), 20)) {
        $(".content5").append($("#yorumlar-"));
        $("#pdp-tab5").show();
    }
    if ((await $("#Taksit"), 20)) {
        $(".content6").append($("#Taksit"));
        $("#pdp-tab6").show();
    }

    $(".pdp-tabs span").click(function() {
        $(".pdp-tabs span").removeClass("active");
        var index = $(this).attr("id").replace("pdp-tab", "");
        $(this).addClass("active");
        if (index) {
            $(".tab-content > div").hide();
            $(".content" + index).show();
            window.dispatchEvent(new Event("resize"));
        }
    });

    $(document).on("click", ".bv_button_buttonFull", function() {
        $("#pdp-tab5").click();
        $("html").animate({
                scrollTop: $("#pdp-tab").offset().top - 200,
            },
            2000,
            function() {
                setTimeout(function() {
                    window.scroll(0, $("#pdp-tab").offset().top - 200);
                }, 200);
            }
        );
    });
} else if (scriptLib.isMobile) {
    var tabsHtml = [
        '<div class="contentspot"><div id="pdp-tab-m"><div class="pdp-tabs-m">',
        '<span id="pdp-tab-m-1" class="active">Önerilen Ürünler</span>',
        '<div class="tab-content-m tab-content-m1"></div>',
        '<span id="pdp-tab-m-3">Teknik Özellikler</span>',
        '<div class="tab-content-m tab-content-m3" style="display: none"></div>',
        '<span id="pdp-tab-m-4" style="display: none;">Ürün Açıklaması</span>',
        '<div class="tab-content-m tab-content-m4" style="display: none"></div>',
        '<span id="pdp-tab-m-5" style="display: none;">Ürün Yorumları</span>',
        '<div class="tab-content-m tab-content-m5" style="display: none"></div>',
        '<span id="pdp-tab-m-6" style="display: none;">Taksit/Kredi Seçenekleri</span>',
        '<div class="tab-content-m tab-content-m6" style="display: none"></div>',
        "</div>",
        "</div></div>",
    ].join("");

    if (!$("#pdp-tab-m").length) {
        $('input[name="catalogEntryId"]').closest("form").after(tabsHtml);

        if ((await $("#swogo-bundle-2"), 20)) {
            $(".tab-content-m1").append($("#swogo-bundle-2"));
            $("#pdp-tab-m-1").show();
        }
        if ((await $(".additional-services-list"), 20)) {
            $(".tab-content-m2").append($(".additional-services-list"));
            $("#pdp-tab-m-2").show();
        }
        if ((await $("#product-ratings"), 20)) {
            $(".tab-content-m5").append($("#product-ratings"));
            $("#pdp-tab-m-5").show();
        }
        if ((await $("#rcm-container"), 20)) {
            $(".tab-content-m4").append($("#rcm-container"));
            $("#pdp-tab-m-4").show();
        }
        if ((await $("#flix-inpage"), 20)) {
            $(".tab-content-m4").append($("#flix-inpage"));
            $("#pdp-tab-m-4").show();
        }
        if ((await $(".loadbeeTabContent"), 20)) {
            $(".tab-content-m4").append($(".loadbeeTabContent"));
            $("#pdp-tab-m-4").show();
        }
        if ((await $("#pdp-taksit-kredi"), 20)) {
            $(".tab-content-m6").append($("#pdp-taksit-kredi"));
            $("#pdp-tab-m-6").show();
        }
    }

    var rcmCount = 0;
    var rcmInterval = setInterval(function() {
        if ($("#product-details").length) {
            $(".tab-content-m3").append($("#product-details"));
            $("#pdp-tab-m-3").show();
            if ($("#flix-inpage").length) {
                $(".tab-content-m4").append($("#flix-inpage"));
                $("#pdp-tab-m-4").show();
            }
        }
        if ($("#product-ratings").length) {
            $(".tab-content-m5").append($("#product-ratings"));
            $("#pdp-tab-m-5").show();
        }
        if ($(".seg-reco-wrapper").length) {
            $(".tab-content-m1").append($(".seg-reco-wrapper"));
            $("#pdp-tab-m-1").show();
        }
        if ($("#rcm-container").length) {
            $(".tab-content-m4").append($("#rcm-container"));
            $("#pdp-tab-m-4").show();
        }
        if ($(".channel-html").length) {
            $(".tab-content-m4").append($(".channel-html"));
            $("#pdp-tab-m-4").show();
        }
        if ($("#flix-inpage").length) {
            $(".tab-content-m4").append($("#flix-inpage"));
            $("#pdp-tab-m-4").show();
        }
        rcmCount++;
        if (rcmCount === 10) {
            clearInterval(rcmInterval);
        }
    }, 1000);

    $(".pdp-tabs-m span").click(function() {
        if ($(this).hasClass("active")) {
            $(".pdp-tabs-m > span").removeClass("active");
            $(".tab-content-m").hide();
        } else {
            $(".pdp-tabs-m > span").removeClass("active");
            $(this).addClass("active");
            var index = $(this).attr("id").replace("pdp-tab-m-", "");
            if (index) {
                $(".tab-content-m").hide();
                $(".tab-content-m" + index).show();
                window.dispatchEvent(new Event("resize"));
            }
        }
    });

    $(document).on("click", ".bv_ratings_summary", function() {
        $("#pdp-tab-m-5").click();
        $("html").animate({
                scrollTop: $("#pdp-tab-m").offset().top - 200,
            },
            2000,
            function() {
                setTimeout(function() {
                    window.scroll(0, $("#pdp-tab-m").offset().top - 200);
                }, 200);
            }
        );
    });
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async addPlus90() {
if (scriptLib.isRegisterPage) {
    if (scriptLib.isDesktop) {
        if ($("input#phone2").val() == "") {
            $("input#phone2").val("+90");
        }
    } else if (scriptLib.isMobile) {
        if ($("input#user-mobile-phone-id").val() == "") {
            $("input#user-mobile-phone-id").val("+90");
        }
    }
} else if (scriptLib.isRegisterBasketPage) {
    if (scriptLib.isDesktop) {
        if ($('input#name[name="mobile"]').val() == "") {
            $('input#name[name="mobile"]').val("+90");
        }
    } else if (scriptLib.isMobile) {
        if ($("input#idbillingAddressCellPhone").val() == "") {
            $("input#idbillingAddressCellPhone").val("+90");
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
add13IsGunu() {if (!scriptLib.runThisFunctionOnlyInTestMode("2684d252-ac14-4d33-ab3e-5a985936e404")) return;
function check() {
    var inf = $(".market-later td.status").html();
    if (inf && inf.indexOf("Siparişiniz, 1-3 iş günü") !== -1) {
        var imgExist = $(".market-later").find(".img-1-3").length;
        if (!imgExist) {
            $(".market-later td.status").html(
                '<img class="img-1-3" src="http://data.mediamarkt.com.tr/ux/1-3-is-gunu-sepet.png" alt="1-3 iş gününde teslim" /><div>' +
                inf +
                "</div>"
            );
        }
    }
}
if (scriptLib.isRegisterBasketPage) {
    var count13 = 0;
    var countInterv = setInterval(function() {
        if (scriptLib.isDesktop) {
            check();
            $(document).on("change", "#marketSelector", function() {
                setTimeout(function() {
                    check();
                }, 1500);
            });
        } else if (scriptLib.isMobile) {
            $(".store-availability").each(function(i, v) {
                var inf = $(v).html();
                if (inf && inf.indexOf("Siparişiniz, 1-3 iş günü") !== -1) {
                    var imgExist = $(v).closest("address").find(".img-1-3").length;
                    if (!imgExist) {
                        $(v).before(
                            '<div><img class="img-1-3" src="http://data.mediamarkt.com.tr/ux/1-3-is-gunu-sepet.png" alt="1-3 iş gününde teslim" /></div>'
                        );
                    }
                }
            });
        }
        count13++;
        if (count13 === 15) {
            clearInterval(countInterv);
        }
    }, 1000);
} 

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
addRcmContent() {
if (!scriptLib.isPDP) return; // quit when page is not PDP
if (scriptLib.isDesktop) {
    var url = new URL(window.location.href);
    var c = url.searchParams.get("rcmTest");

    if (!c) {
        return;
    }

    var sku = $("[itemprop='sku']").attr("content") || "";
    sku = sku.replace("sku:", "");
    fetch(
            "https://ux.mediamarkt.com.tr/rcmApi/api/RcmProduct/RCMProduct?productId=" +
            sku
        )
        .then((response) => response.json())
        .then((data) => {
            if (data && data.Layouts) {
                var htmlMedia = "";
                for (var i = 0; i < data.Layouts.length; i++) {
                    htmlMedia +=
                        '<div class="row ' +
                        data.Layouts[i].LayoutInfo.LayoutClass +
                        '">' +
                        getLayoutContent(data.Layouts[i].Contents) +
                        "</div>";
                }
                $(".content4").html(
                    '<div class="ux-media"> ' + htmlMedia + "</div>"
                );
            }
        });

    function getLayoutContent(contentArr) {
        var rowHtml = "";

        for (var i = 0; i < contentArr.length; i++) {
            const type = contentArr[i].Content.ContentType;

            if (type === "Image") {
                rowHtml += getImageContent(contentArr[i].Content);
            }
            if (type === "Youtube") {
                rowHtml += getYoutubeContent(contentArr[i].Content);
            }
            if (type === "Text") {
                rowHtml += getTextContent(contentArr[i].Content);
            }
            if (type === "Title") {
                rowHtml +=
                    '<div class="h2-title ' +
                    contentArr[i].Content.ContentClass +
                    '"><h2> ' +
                    contentArr[i].Content.Title +
                    "</h2></div>";
            }
        }
        return rowHtml;
    }

    function getImageContent(content) {
        let alt = content.alts || "";
        return (
            '<div class="' +
            content.ContentClass +
            '"><img src="' +
            content.images +
            '" alt="' +
            alt +
            '" /></div>'
        );
    }

    function getYoutubeContent(content) {
        var ifr =
            '<iframe src="' +
            content.embedUrl +
            '" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
        return '<div class="' + content.ContentClass + '">' + ifr + "</div>";
    }

    function getTextContent(content) {
        return (
            '<div class="' + content.ContentClass + '">' + content.Text + "</div>"
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async NewBasketPage() {if (!scriptLib.runThisFunctionOnlyInTestMode("89c8a043-5342-4df7-b6e1-416f26c43f83")) return;
if (scriptLib.isBasketPage) {
    if (scriptLib.isDesktop) {
        scriptLib.injectCSS(
            "//csscdn.redblue.de/msp/patternlibrary/deployable/static/style-red_af95546e3c64f536e81bf61cf8ddadf5cd0b3dbf-nofonts.min.css"
        );
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/basketTopBar.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/basketLogicDesktop.min.js"
        );
    } else if (scriptLib.isMobile) {
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/basketLogicMobile.min.js"
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async SwogoForBasketPaage() {
if (scriptLib.isBasketPage) {
    if (scriptLib.isDesktop) {
      if(await scriptLib.waitUntilFieldCreated('.slick-list.draggable')) {
         $('.slick-list.draggable').after('<div id="swogo-bundle-0" class="swogo-box"></div>');
      }
    } else if (scriptLib.isMobile) {

    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixMarginOnBaristaPage() {
if (window.location.pathname == '/tr/shop/barista.html') {
    scriptLib.waitUntilFieldCreated('.m-6').then((res) => {
        if (res) {
            $('.m-1, .m-2, .m-3, .m-4, .m-5, .m-6').css("cssText", "margin: 0 !important;");
            $('.teaser nav ul').css('display', 'flex')
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
outletPageCategories() {
if (!window.isOnLoadingFinishedEventMounted) {
    window.isOnLoadingFinishedEventMounted = true;
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.outletPageCategories();
    });
}
if (scriptLib.isDesktop && scriptLib.isCategoryPage && scriptLib.isOutlet) {

    scriptLib.waitUntilFieldCreated('.breadcrumbs-nav .breadcrumbs').then((res) => {
        if (res) {
            setTimeout(() => {

                let path = window.location.pathname.slice(13, 20);

                if (path == "_outlet") {
                    let newItem = document.createElement('div')
                    newItem.classList.add('upper-outlet-categories')

                    $('.breadcrumbs-nav .breadcrumbs').after(newItem)

                    let category = `
<ul>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-telefon-826512.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/telefon.png" alt="">
        <p>Telefon</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-bilgisayar-826517.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/01-computer.svg" alt="">
        <p>Bilgisayar</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-tv-g%C3%B6r%C3%BCnt%C3%BC-ve-ses-826516.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/03-tv-sound.svg" alt="">
        <p>TV, Görüntü ve Ses</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-aksesuar-826513.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/aksesuar.png" alt="">
        <p>Aksesuar</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-foto-kamera-drone-826511.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/05-foto-video.svg" alt="">
        <p>Foto &amp; Kamera &amp; Drone</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-beyaz-e%C5%9Fya-826514.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/07-washingmachine.svg" alt="">
        <p>Beyaz Eşya</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ev-aletleri-ya%C5%9Fam-826510.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/ev-aletleri.png" alt="">
        <p>Ev Aletleri &amp; Yaşam</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ki%C5%9Fisel-bak%C4%B1m-826518.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/08-blowdryer.svg" alt="">
        <p>Kişisel Bakım</p>
        </a>
    </li>
    <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-spor-oyun-outdoor-826515.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/04-gaming.svg" alt="">
        <p>Spor &amp; Oyun &amp; Outdoor</p>
        </a>
    </li>
    </ul>
    `
                    newItem.innerHTML = category
                }

                scriptLib.injectBrutCSS(`
                .upper-outlet-categories{
                    margin-bottom : 20px;
                }
.upper-outlet-categories ul{
    display : flex;
    justify-content : space-between;
    }
.upper-outlet-categories ul li {
    display : flex;
    flex-direction : column;
    justify-content : center;
    align-items : center;
    width : 9%;
    border :1px solid lightgrey;
    border-radius: 10px;
    padding :20px 5px;
    box-shadow: 0 1px 3px rgb(0 0 0 / 12%), 0 1px 2px rgb(0 0 0 / 24%);
    transition: all .3s cubic-bezier(.25,.8,.25,1);
}
.upper-outlet-categories ul li:hover {
    box-shadow: 0 3px 6px rgb(0 0 0 / 16%), 0 3px 6px rgb(0 0 0 / 23%);
}
.upper-outlet-categories ul li a{
    display : flex;
    flex-direction : column;
    align-items : center;
    text-decoration : none;
    text-align : center;
}
.upper-outlet-categories ul li a p {
    font-size : 12px;
}
.upper-outlet-categories ul li a img {
    margin-bottom : 10px;
    width : 90%;
    height : 50px;
    object-fit : contain ;
}
`)


            }, 1000);

        }
    })
}


//https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=b972f8d7-9dbb-46f1-b76f-23b941e48995

if (scriptLib.isMobile && scriptLib.isCategoryPage) {

    scriptLib.waitUntilFieldCreated('#filter-container').then((res) => {
        if (res) {
            setTimeout(() => {


                let path = window.location.pathname.slice(13, 20);

                if (path == "_outlet") {
                    let newItem = document.createElement('div')
                    newItem.classList.add('upper-outlet-categories')

                    $('#filter-container').before(newItem)

                    let category = `
    <ul>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-telefon-826512.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/telefon.png" alt="">
        <p>Telefon</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-bilgisayar-826517.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/01-computer.svg" alt="">
        <p>Bilgisayar</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-tv-g%C3%B6r%C3%BCnt%C3%BC-ve-ses-826516.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/03-tv-sound.svg" alt="">
        <p>TV, Görüntü ve Ses</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-aksesuar-826513.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/aksesuar.png" alt="">
        <p>Aksesuar</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-foto-kamera-drone-826511.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/05-foto-video.svg" alt="">
        <p>Foto &amp; Kamera &amp; Drone</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-beyaz-e%C5%9Fya-826514.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/07-washingmachine.svg" alt="">
        <p>Beyaz Eşya</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ev-aletleri-ya%C5%9Fam-826510.html">
        <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/ev-aletleri.png" alt="">
        <p>Ev Aletleri &amp; Yaşam</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ki%C5%9Fisel-bak%C4%B1m-826518.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/08-blowdryer.svg" alt="">
        <p>Kişisel Bakım</p>
        </a>
        </li>
        <li>
        <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-spor-oyun-outdoor-826515.html">
        <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/04-gaming.svg" alt="">
        <p>Spor &amp; Oyun &amp; Outdoor</p>
        </a>
        </li>
    </ul>
    `
                    newItem.innerHTML = category
                }

                scriptLib.injectBrutCSS(`
    .upper-outlet-categories{
        overflow : auto ;
        }   
    .upper-outlet-categories ul{
    display : flex;
    justify-content : space-between;
    padding: 0;
    }
    .upper-outlet-categories ul li {
    display : flex;
    flex-direction : column;
    justify-content : center;
    align-items : center;
    min-width : 12%;
    margin : 9px;
    border :1px solid lightgrey;
    border-radius: 10px;
    padding :5px 30px;
    box-shadow: 0 1px 3px rgb(0 0 0 / 12%), 0 1px 2px rgb(0 0 0 / 24%);
    transition: all .3s cubic-bezier(.25,.8,.25,1);
    }
    .upper-outlet-categories ul li:hover {
    box-shadow: 0 3px 6px rgb(0 0 0 / 16%), 0 3px 6px rgb(0 0 0 / 23%);
    }
    .upper-outlet-categories ul li a{
    display : flex;
    flex-direction : column;
    align-items : center;
    text-decoration : none;
    text-align : center;
    }
    .upper-outlet-categories ul li a p {
    font-size : 12px;
    width : 150%;
    }
    .upper-outlet-categories ul li a img {
    margin-bottom : 10px;
    width : 150%;
    height : 35px;
    object-fit : contain ;
    }
`)


            }, 1000);

        }
    })

    scriptLib.waitUntilFieldCreated('#nav-categories').then((res) => {
        if (res) {
            setTimeout(() => {


                let path = window.location.pathname.slice(13, 20);

                if (path == "_outlet") {
                    let newItem = document.createElement('div')
                    newItem.classList.add('upper-outlet-categories')

                    $('#nav-categories').before(newItem)

                    let category = `
    <ul>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-telefon-826512.html">
            <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/telefon.png" alt="">
            <p>Telefon</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-bilgisayar-826517.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/01-computer.svg" alt="">
            <p>Bilgisayar</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-tv-g%C3%B6r%C3%BCnt%C3%BC-ve-ses-826516.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/03-tv-sound.svg" alt="">
            <p>TV, Görüntü ve Ses</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-aksesuar-826513.html">
            <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/aksesuar.png" alt="">
            <p>Aksesuar</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-foto-kamera-drone-826511.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/05-foto-video.svg" alt="">
            <p>Foto &amp; Kamera &amp; Drone</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-beyaz-e%C5%9Fya-826514.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/07-washingmachine.svg" alt="">
            <p>Beyaz Eşya</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ev-aletleri-ya%C5%9Fam-826510.html">
            <img src="https://data.mediamarkt.com.tr/uploads/2022/10-2022-outlet-category-images/ev-aletleri.png" alt="">
            <p>Ev Aletleri &amp; Yaşam</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-ki%C5%9Fisel-bak%C4%B1m-826518.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/08-blowdryer.svg" alt="">
            <p>Kişisel Bakım</p>
            </a>
        </li>
        <li>
            <a href="https://www.mediamarkt.com.tr/tr/category/_outlet-spor-oyun-outdoor-826515.html">
            <img src="https://apps.mediamarkt.ch/NM/live/assets/images/icons/categories/04-gaming.svg" alt="">
            <p>Spor &amp; Oyun &amp; Outdoor</p>
            </a>
        </li>
        </ul>
        `
                    newItem.innerHTML = category
                }

                scriptLib.injectBrutCSS(`
        .upper-outlet-categories{
            overflow : auto ;
        }   
    .upper-outlet-categories ul{
        display : flex;
        justify-content : center;
        flex-wrap: wrap;
        padding: 0;
        }
    .upper-outlet-categories ul li {
        display : flex;
        flex-direction : column;
        justify-content : center;
        align-items : center;
        width : 10%;
        margin : 10px;
        border :1px solid lightgrey;
        border-radius: 10px;
        padding :5px 30px;
        box-shadow: 0 1px 3px rgb(0 0 0 / 12%), 0 1px 2px rgb(0 0 0 / 24%);
        transition: all .3s cubic-bezier(.25,.8,.25,1);
    }
    .upper-outlet-categories ul li:hover {
        box-shadow: 0 3px 6px rgb(0 0 0 / 16%), 0 3px 6px rgb(0 0 0 / 23%);
    }
    .upper-outlet-categories ul li a{
        display : flex;
        flex-direction : column;
        align-items : center;
        text-decoration : none;
        text-align : center;
    }
    .upper-outlet-categories ul li a p {
        font-size : 12px;
        width : 150%;
    }
    .upper-outlet-categories ul li a img {
        margin-bottom : 10px;
        width : 150%;
        height : 35px;
        object-fit : contain ;
    }
    `)

scriptLib.injectBrutCSS(`
ul#nav-categories {
    display: none !important;
}
`)
            }, 1000);


            //$('ul#nav-categories').css('display', 'none');
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
ShareButtonsOnPDP() {if (!scriptLib.runThisFunctionOnlyInTestMode("5ac25534-8f44-468b-86bd-bb59f46ccf84")) return;
if (scriptLib.isPDP && scriptLib.isDesktop) {
    //current url
    let currentUrl = window.location.href;
    let shareMailText = $('#product-details > .details > h1').text()
    let pdpSharePopup = `
<div class="pdp-share-popup">
    <div class="head-pdp" >
        <p> Bu Ürünü Paylaş </p>
        <button>
        <svg class="cls-icn" width="32px" height="32px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="close"><rect width="24" height="24" transform="rotate(180 12 12)" opacity="0"></rect><path d="M13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29-4.3 4.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l4.29-4.3 4.29 4.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path></g></g></svg>
        </button>	
    </div> 
    <div class="icons-pdp"> 
        <li> <a target = "_blank" href="https://api.whatsapp.com/send?text=${currentUrl}"><img src="https://data.mediamarkt.com.tr/img/2022/09/wpicon.png" alt=""></a> </li>
        <li> <a target = "_blank" href="https://www.facebook.com/sharer/sharer.php?u=${currentUrl}"><img src="https://data.mediamarkt.com.tr/img/2022/09/fbicon.png" alt=""></a> </li>
        <li> <a target = "_blank" href="https://twitter.com/share?url=${currentUrl}"><img src="https://data.mediamarkt.com.tr/img/2022/09/twicon.png" alt=""></a> </li>
        <li> <a target = "_blank" href="https://www.instagram.com/"><img src="https://data.mediamarkt.com.tr/img/2022/09/instagramicon.png" alt=""></a> </li>
        <li> <a target = "_blank" href="mailto:?subject=${shareMailText}"><img src="https://data.mediamarkt.com.tr/img/2022/09/mailicon.png" alt=""></a> </li>
    </div>
    <div class="share-pdp-bottom">
        <input type="text" value="" class="share-pdp-input">
        <button class="share-pdp-copy-btn">
        <img src="	https://data.mediamarkt.com.tr/img/2022/08/logo/copy.png" alt="">
        </button>
    </div>
</div>
<div class="pdp-overlay-share"></div>
`;

    let bodyEl = document.querySelector("body");
    bodyEl.innerHTML += pdpSharePopup;

    let upperClass = document.querySelector(".options");

    let shareEl = document.createElement("li");
    shareEl.classList.add("share-btn-pdp");

    let linkEl = document.createElement("a");
    linkEl.textContent = "Paylaş";

    upperClass.append(shareEl);
    shareEl.append(linkEl);
    let pdpOverlayBg = document.querySelector(".pdp-overlay-share");
    let copyInputPdpEl = document.querySelector(
        ".pdp-share-popup .share-pdp-bottom .share-pdp-input"
    );
    let copyInputBtnPdpEl = document.querySelector(
        ".pdp-share-popup .share-pdp-copy-btn"
    );

    let shareClickEventItem = document.querySelector(".share-btn-pdp");

    let popupEl = document.querySelector(".pdp-share-popup");
    let closeBtnSharePdp = document.querySelector(
        ".pdp-share-popup .head-pdp button"
    );

    shareClickEventItem.addEventListener("click", function() {
        popupEl.classList.toggle("active");
        pdpOverlayBg.classList.toggle("active");
    });

    closeBtnSharePdp.addEventListener("click", function() {
        popupEl.classList.remove("active");
        pdpOverlayBg.classList.remove("active");
    });

    //input copy section
    copyInputPdpEl.value = currentUrl;

    copyInputBtnPdpEl.addEventListener("click", function() {
        let vl = this;
        vl.innerHTML = '<img src="https://data.mediamarkt.com.tr/img/2022/09/yesiltik.png" alt="">'
        vl.setAttribute("disabled", "");

        setTimeout(() => {
            vl.innerHTML = '<img src="https://data.mediamarkt.com.tr/img/2022/08/logo/copy.png" alt="">'
            vl.removeAttribute("disabled");
        }, 1000);

        copyInputPdpEl.focus();
        copyInputPdpEl.select();
        navigator.clipboard.writeText(copyInputPdpEl.value);
    });
}

if (scriptLib.isMobile && scriptLib.isPDP) {

    scriptLib.waitUntilFieldCreated("section.bg-white > div.grid > div.grid div.guarantee-info").then((res) => {
        if (res) {

            let nearEl = $("section.bg-white > div.grid > div.grid").find("div.guarantee-info").parent().parent().parent();

            $(nearEl).after(`<div class="gridbox column-1-1  inline-column share-btn-pdp-mobile">
                <a href="#" class="button background-type-2">Paylaş</a>
                </div>`)
        }
    })

    //PRODUCT DETAIL ALL SHARE ADD FAV. ETC. TO PARENT ELEMENT 
    //WHAT NAME İS DFLEXİTEM DO NOT ACTİVE THE FALLOWİNG CODES İTS NOW RECOMENDED


    // scriptLib.waitUntilFieldCreated('.wishl').then((res)=> {
    //   if(res){
    //     let parEls = $('#wrapper-main section.bg-white > .grid > div')
    //     let meanEls = parEls.slice(parEls.length-7, parEls.length-2)
    //     let newElforFlex = document.createElement('div')
    //     newElforFlex.classList.add('dflexitem')
    //     $('.share-btn-pdp-mobile').before(newElforFlex)
    //     $(newElforFlex).css({'display': 'flex', 'flex-wrap' : 'wrap', 'justify-content': 'center'})

    //     let parentFunc = function(parent,childs){
    //         for (let index = 0; index < childs.length; index++) {
    //             const element = childs[index];
    //             parent.appendChild(element)
    //         }
    //     }
    //     parentFunc(newElforFlex,meanEls);
    //   }
    // })

    scriptLib.waitUntilFieldCreated('.share-btn-pdp-mobile').then((res) => {
            if (res) {
                const btn = document.querySelector(".share-btn-pdp-mobile");

                // function for web share api
                let header = document.querySelector('.product-overview-title .ellipsis_text').textContent
                let url = window.location.href

                function webShareAPI(header, description, link) {
                    navigator
                        .share({
                            title: header,
                            text: description,
                            url: link
                        })
                        .then(() => console.log("Successful share"))
                        .catch((error) => console.log("Error sharing", error));
                }
                btn.addEventListener("click", () => {
                    webShareAPI(header, header, url)

                })
            }
        })
        // flex yapısı için kapsayıcı div oluşturma
        // scriptLip.waitUntilFieldCreated('.share-btn-pdp-mobile').then((res) => {
        //     if(res){
        //         let point = $('.share-btn-pdp-mobile')
        //         let parentDiv = document.createElement('div')
        //         parentDiv.classList.add('options-mobile-pdp')
        //         point.before(parentDiv);
        //         let getEls = $('section.bg-white.wrapper-full-width > .grid > div').slice(8,13)

    //         $(getEls).each(function(e){
    //             $(parentDiv).appendTo(e)
    //         })

    //     }
    // })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
newCategoryUX() {
if (!window.isOnLoadingFinishedEventMountedNewCategoryUX) {
    window.isOnLoadingFinishedEventMountedNewCategoryUX = true;
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.newCategoryUX();
    });
}

/*$(document).on('onPlpLoadNewItems', () => {
    console.warn('örnek kodu');
      scriptLibFunctions.newCategoryUX();
})*/

if (scriptLib.isDesktop) {
    if (scriptLib.isCategoryPage || scriptLib.isSearchPage || scriptLib.isWishListPage) {
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCategoryDesktop.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCategoryDesktop.min.js"
        );
    }
}

if (scriptLib.isMobile) {
    if (scriptLib.isCategoryPage || scriptLib.isSearchPage || scriptLib.isWishListPage) {
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCategoryMobile.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCategoryMobile.min.js"
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
newRegisterUX() {
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.newRegisterUX();
    });

if (scriptLib.isRegisterPage) {
    if (scriptLib.isDesktop) {
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newRegisterDesktop.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newRegisterDesktop.min.js"
        );
    }
    if (scriptLib.isMobile) {
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newRegisterMobile.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newRegisterMobile.min.js"
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
digitalCards() {
if (!window.isOnLoadingFinishedEventMounted) {
    window.isOnLoadingFinishedEventMounted = true;
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.digitalCards();
    });
}

if (scriptLib.isPDP) {
    if (scriptLib.isDesktop) {
        $(document).ready(function() {
            var pName = $('h1[itemprop="name"]').html();

            if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                scriptLib.waitUntilFieldCreated(".stock-info").then((result) => {
                    if (result) {
                        $(".stock-info").css({ "display": "none", "visibility": "hidden" });
                        $(".send-stock").css({ "display": "none", "visibility": "hidden" });
                        $(".store-delivery").css({ "display": "none", "visibility": "hidden" });
                        $(".ux-taksit").css({ "display": "none", "visibility": "hidden" });
                        $(".box.infobox.availability ul li:eq(0)").css({ "display": "none", "visibility": "hidden" });
                        $(".price-sidebar .infobox ul > span").css({ "display": "none", "visibility": "hidden" });

                        $("#pdp-tab1").removeClass("hidden");
                        $("#pdp-tab1, #pdp-tab2, #pdp-tab6").css({ "display": "none", "visibility": "hidden" });
                        $(".tab-content .content1, .tab-content .content2, .tab-content .content6").css({ "display": "none", "visibility": "hidden" });
                        $("#pdp-tab4").insertBefore("#pdp-tab3").addClass("active");
                        $(".tab-content .content4").css("display", "block");

                        var digitalCardBanner = '<span class="digital-card-banner">SMS / Email ile gönderim.</span>';
                        $(".price-sidebar .price-details").append(digitalCardBanner);
                    }
                })
            }
        })
    }

    if (scriptLib.isMobile) {
        $(document).ready(function() {
            var pName = $('h1[itemprop="name"]').find("span.ellipsis_text").html();

            if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                scriptLib.waitUntilFieldCreated(".stok-sorgu").then((result) => {
                if (result) {
                $(".ux-taksit").css({ "display": "none", "visibility": "hidden" });
                $("#delivery-type").css({ "display": "none", "visibility": "hidden" });
                $(".store-delivery-mobile").css({ "display": "none", "visibility": "hidden" });
                $(".add-to-comparison-list").parent().css({ "display": "none", "visibility": "hidden" });
                $(".stok-sorgu").parent().css({ "display": "none", "visibility": "hidden" });

                $("#pdp-tab-m-1").removeClass("active");
                $("#pdp-tab-m-1").addClass("hidden");
                $("#pdp-tab-m-2").addClass("hidden");
                $("#pdp-tab-m-6").addClass("hidden");
                $(".tab-content-m1").addClass("hidden");
                $(".tab-content-m2").addClass("hidden");
                $(".tab-content-m6").addClass("hidden");
                $("#pdp-tab-m-4").insertBefore("#pdp-tab-m-3").addClass("active");
                $(".tab-content-m4").insertAfter("#pdp-tab-m-4").css("display", "block");

                var digitalCardBanner = '<div class="grid wrapper-full-width"><span class="digital-card-banner mobil">SMS / Email ile gönderim.</span></div>';
                $(".grid.pdp-product-info").append(digitalCardBanner);
                }
            })
            }
        })
    }
}

if (scriptLib.isBasketPage || scriptLib.isRegisterBasketPage) {
    if (scriptLib.isDesktop) {
        $(document).ready(function() {
            $('.cproduct-info').each(function(i) {
                $(".false.before").css({ "display": "none", "visibility": "hidden" });

                if ($(this).find("h2.cproduct-heading").length) {
                    var pName = $(this).find("h2.cproduct-heading").html();

                    if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                        $(this).find(".description").append('<p class="digital-card-banner desk-basket">"Anında Teslimat" Bu ürün Digital Üründür, Kod gönderimi E-Mail ile yapılacaktır. Digital ürünler yasal mevzuat gereği iade ya da iptal edilememektedir.</p>');
                    }

                    if (scriptLib.isRegisterBasketPage) {
                        $("delivery-time").css({ "display": "none", "visibility": "hidden" });
                    }
                }
            });
        })
    }

    if (scriptLib.isMobile) {
        $(document).ready(function() {
            $('.basket-teaser-item').each(function(i, v) {
                var pName = $(v).find('.basket-product-title-wrapper h2:eq(0)').html();
                if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                    if (!$(v).find('.digital-card-banner').length) {
                        $(v).find('.basket-teaser-container').append('<p class="digital-card-banner mobil-basket">"Anında Teslimat" Bu ürün Digital Üründür, Kod gönderimi E-Mail ile yapılacaktır. Digital ürünler yasal mevzuat gereği iade ya da iptal edilememektedir.</p>');
                    }
                }
            });

            if (scriptLib.isRegisterBasketPage) {
                $('.product-teaser').each(function(i, v) {
                    var pName = $(v).find('h3.ellipsis').html();
                    if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                        if (!$(v).find('.digital-card-banner').length) {
                            $(v).find('.additional-info').append('<p class="digital-card-banner mobil-basket">"Anında Teslimat" Bu ürün Digital Üründür, Kod gönderimi E-Mail ile yapılacaktır. Digital ürünler yasal mevzuat gereği iade ya da iptal edilememektedir.</p>');
                        }
                    }
                });
            }
        })
    }
}

if (scriptLib.isThankyouPage) {
    if (scriptLib.isDesktop) {
        $(document).ready(function() {
            $('.co-product').each(function(i, v) {
                var pName = $(v).find('.product-title').html();
                if (pName && pName.toLocaleLowerCase().indexOf('dijital indirilebilir lisans') != -1) {
                    if (!$(v).find('.digital-card-banner').length) {
                        $(v).find('.product-content').append('<p class="digital-card-banner thankyou">"Anında Teslimat" Bu ürün Digital Üründür, Kod gönderimi E-Mail ile yapılacaktır. Digital ürünler yasal mevzuat gereği iade ya da iptal edilememektedir.</p>');
                    }
                }
            });
        })

        // Uyarı metni 06.03.2023 08:00 kaldırılacak
        var warningS = '<p class="warning">Siparişiniz alınmıştır. Geçici süreliğine sistemlerimizde yapılan geliştirmeler nedeniyle siparişleriniz henüz Hesabım/Siparişlerim alanına yansımamıştır. Pazartesi günü siparişiniz kargoya verilecek olup, güncel durumunu Hesabım/Siparişlerim sayfasında görebileceksiniz. Ürününüz kargoya teslim edildiğinde sizleri SMS ile tekrar bilgilendireceğiz. Anlayışınız için teşekkür ederiz.</p>';

        $(".content-thankyou > .title").after(warningS);
    }

    if (scriptLib.isMobile) {
        $(document).ready(function() {
            var catID = $("meta[property='prudsys:recomm:itemids']").attr("content").toString();

            if (catID.indexOf('MMTR1220855') != -1) {
                var digitalCardBanner = '<p class="digital-card-banner thankyou mobile">"Anında Teslimat" Bu ürün Digital Üründür, Kod gönderimi E-Mail ile yapılacaktır. Digital ürünler yasal mevzuat gereği iade ya da iptal edilememektedir.</p>';

                $("#wrapper-main").append(digitalCardBanner);
                $(".digital-card-banner").insertBefore(".primary-button");
            }
        })

        // Uyarı metni 06.03.2023 08:00 kaldırılacak
        var warningS = '<p class="warning">Siparişiniz alınmıştır. Geçici süreliğine sistemlerimizde yapılan geliştirmeler nedeniyle siparişleriniz henüz Hesabım/Siparişlerim alanına yansımamıştır. Pazartesi günü siparişiniz kargoya verilecek olup, güncel durumunu Hesabım/Siparişlerim sayfasında görebileceksiniz. Ürününüz kargoya teslim edildiğinde sizleri SMS ile tekrar bilgilendireceğiz. Anlayışınız için teşekkür ederiz.</p>';

        $(".bg-white > h1").after(warningS);
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
priceForWeb() {
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.priceForWeb();
    });

    if (scriptLib.isPDP) {
        if (scriptLib.isDesktop) {
            var priceForWeb = `<span class="priceforweb desktop pdp">Web'e Özel Fiyat</span>`;

            var flags = $("img.flags[src*='l112146']");

            $(flags).each(function() {
                $(this).parents("#product-wrapper").find(".price-sidebar").prepend(priceForWeb);
                $(this).remove();
            });

            /*if (scriptLib.getProductSKU() == "1216730" || scriptLib.getProductSKU() == "1222788" || scriptLib.getProductSKU() == "1227169") {
                $(".priceforweb").hide();
            }*/
        }
        if (scriptLib.isMobile) {
            if (window.location.href.indexOf("product") > -1) {
                var priceForWeb = `<p class="pdp-priceforweb"><span class="line"></span><span class="text">Web'e Özel Fiyat</span></p>`;

                var flags = $("img.marketing-flag-item[src*='l119851']");

                $(flags).each(function() {
                    $(this).parent(".swiper-slide").append(priceForWeb);
                    $(this).remove();
                });
            };

            /*var sku = $('[itemprop="sku"]').attr("content").split(":")[1];
            if (sku == "1216730" || sku == "1222788" || sku == "1227169") {
                $(".pdp-priceforweb").hide();
            }*/
        }
    }

    if (scriptLib.isCategoryPage || scriptLib.isSearchPage || scriptLib.isWishListPage) {
        if (scriptLib.isDesktop) {
            var priceForWeb = `<span class="priceforweb desktop plp">Web'e Özel Fiyat</span>`;

            var flags = $("img.flags[src*='l112146']");

            $(flags).each(function() {
                $(this).parent("div").html(priceForWeb);
            })
        }
        if (scriptLib.isMobile) {
            var priceForWeb = `<span class="priceforweb mobile plp">Web'e Özel Fiyat</span>`;

            var flags = $("img.marketing-flag-item[src*='l119851']");

            $(flags).each(function() {
                $(this).parent("a").append(priceForWeb);
                $(this).remove();
            });
        }
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
installationDetails() {
    if (!window.isOnLoadingFinishedEventMounted) {
        window.isOnLoadingFinishedEventMounted = true;
        document.addEventListener("onLoadingFinished", function() {
            scriptLibFunctions.installationDetails();
        });
    }

    if (scriptLib.isPDP) {
        if (scriptLib.isDesktop) {
            var catIDs = ["712509", /*"465754",*/ "465755", "465752", "675550", "676010", "801532", "465711", "675155", "675157", "675163", "465019", "675165", "793010", "809009", "809010", "809011", "793009", "793011", "793012", "793014", "793015", "810024", "810023", "465709"];
            var catID = $("input[name='contentSpotInfo-product_detail-top']").data("categoryid").toString();

            var pdpSetupBTN = '<li><a href="https://www.mediamarkt.com.tr/tr/shop/urun-kurulumu.html" id="product-setupdetails" target="_blank">Kurulum Detayları</a></li>';

            if (jQuery.inArray(catID, catIDs) !== -1) {
                $("#product-details .options").append(pdpSetupBTN);

                var brand = scriptLib.getProductBrand();

                $('#product-setupdetails').each(function(){
                    this.href += '?brand=' + brand;
                });
            }

            scriptLib.injectBrutCSS(`
                #product-details .n-more .options.no-border{
                    overflow: inherit;
                }
                .tooltips{
                    position: absolute;
                    top: -40px;
                    left: 50%;
                    width: 276px;
                    background-color: #222;
                    color: #fff;
                    padding: 5px 6px;
                    text-align: left;
                    border-radius: 4px;
                    display: none;
                    transform: translateX(-50%);
                }
                #product-wrapper #product-details .options a:hover .tooltips{
                    display: block;
                }
            `);
            var tooltips = "<em class='tooltips'>Kombi montajı gaz kuruluşundan sertifikalı/yetkili tesisatçı firmalar tarafından ücretli olarak yapılır.</em>";
            if (catID == "465754") {
                $("#product-details .options").append(pdpSetupBTN);
                $("#product-setupdetails").append(tooltips).attr("href","javascript:void(0)").attr("target","");
            }
        }

        if (scriptLib.isMobile) {
            var catIDs = ["712509", /*"465754",*/ "465755", "465752", "675550", "676010", "801532", "465711", "675155", "675157", "675163", "465019", "675165", "793010", "809009", "809010", "809011", "793009", "793011", "793012", "793014", "793015", "810024", "810023", "465709"];
            var catID = $("input[name='categoryId']").val().toString();

            if (jQuery.inArray(catID, catIDs) !== -1) {
                $('.add-to-comparison-list').closest('.column-1-1').after('<div class="gridbox column-1-1 inline-column"><a href="https://www.mediamarkt.com.tr/tr/shop/urun-kurulumu.html" id="product-setupdetails" target="_blank">Kurulum Detayları</a></div>');

                var brand = scriptLib.getProductBrand();

                $('#product-setupdetails').each(function(){
                    this.href += '?brand=' + brand;
                });
            }

            scriptLib.injectBrutCSS(`
                .tooltips{
                    font-style: normal;
                    position: absolute;
                    top: -60px;
                    left: 50%;
                    width: 200px;
                    background-color: #222;
                    color: #fff;
                    padding: 5px 6px;
                    text-align: left;
                    border-radius: 4px;
                    display: none;
                    transform: translateX(-50%);
                    line-height: 1.2;
                }
                .tooltips.active{
                    display: block
                }
            `);
            var tooltips = "<em class='tooltips'>Kombi montajı gaz kuruluşundan sertifikalı/yetkili tesisatçı firmalar tarafından ücretli olarak yapılır.</em>";
            if (catID == "465754") {
                $('.add-to-comparison-list').closest('.column-1-1').after('<div class="gridbox column-1-1 inline-column"><a href="https://www.mediamarkt.com.tr/tr/shop/urun-kurulumu.html" id="product-setupdetails" target="_blank">Kurulum Detayları</a></div>');
                $("#product-setupdetails").append(tooltips).attr("href","javascript:void(0)").attr("target","");
                $("#product-setupdetails").on("click", function () {
                    $(this).find(".tooltips").toggleClass("active");
                })
            }
        }
    }
    
    if(scriptLib.isInstallationPage){
        var brandBtn = $(".cr_brand-button");
    
        $(brandBtn).each(function() {
            if(window.location.href.indexOf($(this).html()) > -1){
    
                $('html, body').animate({
                    scrollTop: $('#scrollPosition').offset().top
                }, 'slow');
                  
                $(brandBtn).removeClass("cr_brand-button-active");
                $(this).addClass("cr_brand-button-active");
    
                $(".cr_brandslider").prepend($(".cr_brand-button-active").parent());
    
                var target = $(this).attr("data-target");
    
                $(".cr_brand-tabs > .cr_brand-tab").hide();
                $(".cr_brand-tabs > ." + target).show();
            }
        });
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
deleteExtraPriceonMobileCampaign() {if (!scriptLib.runThisFunctionOnlyInTestMode("32e7f030-5ea8-4cab-8f6b-d2605db874ff")) return;
if (scriptLib.isMobile && scriptLib.isPLP) {

    // scriptLib.waitUntilFieldCreated('.wrapper-price > .product-teaser-vatLabel').then((res) => {
    //     if(res){
    setTimeout(() => {
        let sign = '₺'
        let Els = $('.wrapper-price > .product-teaser-vatLabel').next().children('span')
        for (let i = 0; i < Els.length; i++) {
            let nmbr = Els[i].textContent.slice(1)
            let realNumber = Number(nmbr).toFixed(3)
            let result = sign + realNumber
            Els[i].textContent = result
        }
    }, 3000);
    //     }
    // })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async FixPDP_Price() {
// This is the new fiction:
if (scriptLib.isPDP) {
    $("#product-details .price-sidebar .price")
        .hide()
        .css("cssText", "display: none !important");
    $("#product-details .price-sidebar .price-label").after(
        '<div class="new-price-script-lib price big"></div>'
    );
    // <span class="p-6">6</span>
    let price = $('meta[itemprop="price"]').attr("content");
    let pointCame = false;
    if(!price) return;
    price.split("").forEach((it) => {
        $("#product-details .price-sidebar .new-price-script-lib.price").append(
            `<span class="p-${it} ${pointCame ? "p-small" : ""}">${it}</span>`
        );
        if (it === ".") pointCame = true;
    });
    $("#product-details .price-sidebar .new-price-script-lib.price").css(
        "visibility",
        "visible"
    );

    // 1157755 nolu ürünün isim değişikliği
    var sku = scriptLib.getProductSKU();
  
    if (scriptLib.isDesktop) {
        if (await scriptLib.waitUntilFieldCreated('h1[itemprop="name"]')) {
            if(sku === "1157755"){
                $('h1[itemprop="name"]').html("RT46K6000S8/TR 456L No-Frost Üstten Donduruculu Buzdolabı Inox");
            }
        }
    }
    if (scriptLib.isMobile || scriptLib.isApplication) {
        if (await scriptLib.waitUntilFieldCreated(".product-overview-title span")) {
            if(sku === "1157755"){
                $(".product-overview-title span").html("RT46K6000S8/TR 456L No-Frost Üstten Donduruculu Buzdolabı Inox");
            }
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
FixPDP_FavoriButtons() {
// This is the new fiction:
if (scriptLib.isPDP) {
    scriptLib
        .waitUntilFieldCreated(
            "#product-details .details .product-meta-nav ul.options li span"
        )
        .then(() => {
            let item = $(
                "#product-details .details .product-meta-nav ul.options li span"
            );
            for (let i = 0; i < item.length; i++) {
                let tempA = item[i].outerHTML.replace("<span ", "<a ");
                tempA = tempA.replace("</span>", "</a>");
                item[i].outerHTML = tempA;
            }
            console.log("Fav Buttons where fixed...!");
        });
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
ExtraCategoriesRemover() {
let Items = document.querySelectorAll(
    ".categories-tree .categories-tree-descendants li a"
);
console.log(Items);
for (let i = 0; i < Items.length; i++) {
    let txtContent = Items[i].textContent;
    let regEx = /^\s*-/gm;
    if (regEx.exec(txtContent)) {
        Items[i].style.display = "none";
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
installmentScroll() {
if (scriptLib.isPDP) {
    if (scriptLib.isDesktop) {
        $(document).on('click', '.ux-taksit', function() {
            $('#pdp-tab6').trigger('click');
        });
        $(document).on('click', '.swogo-num-bundles-btn.swogo-pointer', function() {
            $('#pdp-tab1').trigger('click');
        });
        if (window.location.href.split('#').pop() == 'yorumlar-') {
            setTimeout(function () {
                $("#pdp-tab5").trigger('click');
                $("html").animate({
                    scrollTop: $("#pdp-tab").offset().top - 300,
                },
                    1000
                );
            }, 1000);
        };

        scriptLib.injectBrutCSS(`
            .all-features{
                cursor: pointer !important;
                margin-left: 30px !important;
            }
        `);

        var allFeatures = '<span class="more all-features">Tüm Özellikler</span>';
        $('.product-meta-nav').find('a.more').after(allFeatures);

        $(document).on('click', '.all-features', function() {
            $('#pdp-tab3').trigger('click');
            $("html").animate({
                scrollTop: $("#pdp-tab").offset().top - 200,
            }, 1000);
        });
    }
    if (scriptLib.isMobile) {
        if (window.location.href.split('#').pop() == 'product-ratings') {
            setTimeout(function () {
                $("#pdp-tab-m-5").trigger('click');
                $("html").animate({
                    scrollTop: $("#pdp-tab-m-5").offset().top - 200,
                },
                    1000
                );
            }, 1000);
        };

        scriptLib.injectBrutCSS(`
            .double-btn{
                align-items: center;
                display:flex;
                justify-content: space-between;
            }
            .all-features{
                color: #000 !important;
                cursor: pointer !important;
                font-size: 14px !important;
                padding: 5px 10px 0 !important;
            }
        `);

        var allFeatures = '<div class="double-btn"><a href="javascript:void(0)" class="all-features">Tüm Özellikler</a></div>';
        $("#type-standard-delivery").after(allFeatures);
        setTimeout(function () {
            $(".double-btn").prepend($(".return-condition"));
        }, 1000);
        
        $(document).on('click', '.all-features', function() {
            $('#pdp-tab-m-3').trigger('click');
            $("html").animate({
                scrollTop: $("#pdp-tab-m").offset().top - 50,
            }, 1000);
        });
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixMobileBannerMargin() {
if (scriptLib.isMobile && scriptLib.isMainPage) {
    let els = document.querySelectorAll(".contentspot > .gridbox");

    els.forEach(function(e) {
        e.style.marginBottom = "10px";
    });
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
pdpPopupSwogo() {
// This is the new fiction:
setTimeout(() => {
  /// cancel if its perf:
if (window.location.host.includes("perf.mediamarkt.com.tr")) {
    $("#pdp-add-to-cart").click(function(e) {
        alert("The item has been added successfully to the cart");
    });
    // console.info("canceled on perf");
    return;
}
  if (scriptLib.isPDP) {
    if (scriptLib.isDesktop) {
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/swogoPdpDesktop.min.js"
        );
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/swogoPdpDesktop.min.css"
        );
    }
    if (scriptLib.isMobile || scriptLib.isApplication) {	
        scriptLib.injectCSS(	
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/swogoPdpMobile.min.css"	
        );	
        scriptLib.injectJS(	
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/swogoPdpMobile.min.js"	
        );	
    }
}
}, 0);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixMobileCategory_Jira_TURFREND_11() {
// fixed how mustafa has disabled this Function // this way disable
if (scriptLib.isMobile && scriptLib.isCategoryPage && scriptLib.isOutlet) {
    scriptLib.injectBrutCSS(`
      ul#nav-categories {
        display: block !important;
        margin-top: 20px;
      }
  `);
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixMobilePopupLiElement() {if (!scriptLib.runThisFunctionOnlyInTestMode("71684ee8-8b42-486a-9c6a-c4d09514653a")) return;
if (scriptLib.isMobile && scriptLib.isPDP) {
    scriptLib.waitUntilFieldCreated('.ins-custom-club-coupon-12923 ul').then((res) => {
        if (res) {
            let el = $('.ins-custom-club-coupon-12923 ul');
            el.css("padding-left", "0");
        }
    })
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixInfoPopupPDP() {
//if (scriptLib.isDesktop && scriptLib.isPDP) {
//    scriptLib.waitUntilFieldCreated('#info-layer.info-window', 86400 * 365).then(s => {
//        if (s) {
//            console.log('came');
//            let elapsedTime = 0;
//            let worker = setInterval(() => {
//                $('#cboxLoadedContent p').css('width', '465px');
//                $('.info-window .layer-content').css('overflow-x', 'hidden');
//                $('#info-layer.info-window').css('width', '493px');
//                $('#cboxLoadedContent').css('width', '493px');
//                $('#cboxContent').css('width', '493px');
//                $('#cboxWrapper').css('width', '493px');
//                $('#colorbox').css({
//                    width: '493px',
//                    left: '50%',
//                    transform: 'translateX(-50%)'
//                });
//                elapsedTime += 100;
//                if (elapsedTime >= 10000) {
                    // clearInterval(worker);
//                }
//            }, 100);
//        }
//    });
//}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
HideSuggestionsForWawlabs() {
scriptLib.injectBrutCSS(`
.ms-autosugestions__results-container, .search-suggestions-container {
    display: none;
}
`);
let searchField = '#wrapper-main > section.bg-white.fixed-search-container.fixed.slide-in > div > div.gridbox.column-1-1 > form > div > input.input-text.search-input';
scriptLib.executeWhenFieldCreated(
    searchField,
    () => {
        $(searchField).attr("type", "text");
    }
);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
fixTopbarWelcomeMessage() {
// this should work on all pages:



const executeChangement = () => {
  if(field.text()==='Hoşgeldiniz') {
    field.text('Hoş geldiniz')
  } else if(field.text()==='Merhaba') {
    setTimeout(executeChangement, 250);
  }
}


let field = $('span[data-identifier="myprofile_salutation_line1"]');
if(field.length) {
  executeChangement();
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
GTM_Event_AddToCart() {
// This is the new fiction:
if (scriptLib.isPDP) {
    $(document).on('onAddToCart', () => {
        console.log("GTM EECaddToCart event fired");
        const extraObject = {
          product_id: $('[itemprop="sku"]').attr("content").split(":")[1],
          value: parseFloat($('[itemprop="price"]').attr("content")),
          currency: 'TRY',
          content_type: 'product',
        }
        if (scriptLib.isDesktop) {
            scriptLib.GtmDispatchEvent("EECaddToCart", "button-green-pdp", "pdp-add-to-cart",extraObject);
        } else if (scriptLib.isMobile) {
            scriptLib.GtmDispatchEvent("EECaddToCart", "mmt-hemenal-btn", "mina",extraObject);
        }
    });
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async CriteoIntegration() {
if(!scriptLib.isPDP && !scriptLib.isMainPage && !scriptLib.isThankyouPage && !scriptLib.isBasketPage && !scriptLib.isPLP) return;

/***************************************************************
**              closing criteo integration on App             **
/**************************************************************/
  if(scriptLib.isApplication) return;                       //**
//*************************************************************/

let sha256 = (str)=> {
return crypto.subtle.digest("SHA-256", new TextEncoder("utf-8").encode(str)).then(buf => {
    return Array.prototype.map.call(new Uint8Array(buf), x=>(('00'+x.toString(16)).slice(-2))).join('');
});
}

function generateUuidV4() {
    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
    );
}


const encryptedId = await sha256(scriptLib.userData.userId);

const isUserLoggedIn = scriptLib.userData.loginStatus!=='OUT';
const account = atob('MTczNDM=') // criteo accound id: '17343';
let cokRVI = scriptLib.getCookie("retailerVisitorId");
let currentDatePlus30Days = new Date( new Date().getTime() + 2592000000);
cokRVI = cokRVI!=='' ? cokRVI : generateUuidV4();
scriptLib.setCookie("retailerVisitorId", cokRVI, currentDatePlus30Days);
const customerId = isUserLoggedIn ? encryptedId : "";
const email = scriptLib.userData.email ?  await sha256(scriptLib.userData.email) : "" ;
const siteType = scriptLib.isDesktop ? "d" : "m";
let pageView;

let toBeInsertedObjsect = {};


scriptLib.injectJS("//dynamic.criteo.com/js/ld/ld.js?a="+account);

/*
###########################################################################################################################
creating an object for wawlabs
###########################################################################################################################

*/

window.wawCriteo = {
 // "account": account,
  "retailerVisitorId": cokRVI,
  "customerId": customerId,
  "email": email,
  "siteType": siteType
}
scriptLib.SendEvent("onCriteoDataReady");

/*
###########################################################################################################################
This is PLP page
###########################################################################################################################

*/
if(scriptLib.isCategoryPage) {

  if (!window.isOnLoadingFinishedEventMountedPLPCriteo) {
    window.isOnLoadingFinishedEventMountedPLPCriteo = true;
    document.addEventListener("onLoadingFinished", function() {
        scriptLibFunctions.CriteoIntegration();
    });
  }

  if (!window.isonPlpLoadNewItemsStartedEventMountedPLPCriteo) {
    window.isonPlpLoadNewItemsStartedEventMountedPLPCriteo = true;
    document.addEventListener("onPlpLoadNewItemsStarted", function() {
        scriptLibFunctions.CriteoIntegration();
    });
  }


  
    let switchToTestMode =  false; // fales means prod; true means test mode
    if (!switchToTestMode || scriptLib.runThisFunctionOnlyInTestMode("e2f70623-1552-4ec1-ac02-751f6c53a521")) {
        // https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=e2f70623-1552-4ec1-ac02-751f6c53a521

        //############################################################
        //                FILLIING EVENT WITH DATA
        //############################################################

        const itemsSKU = scriptLib.getProductsSKU();
        pageView = scriptLib.isDesktop ? "viewCategoryDesktop" : "viewCategoryMobile";

        var storeID;
        if (scriptLib.isDesktop) {
            storeID = $("input[name=contentSpotInfo-category-top]").attr("data-storeid");
        }
        else if (scriptLib.isMobile) {
            storeID = $("input[name=storeId]").val();
        }

        /*
        var catPath;
        if (scriptLib.isDesktop) {
            $("ul.breadcrumbs > li").each(function (i, item) {
                if (!$(this).hasClass("home")) {
                    catPath += $(this).text().trim();
                }

                if ((i == $("ul.breadcrumbs > li").length - 1) == false)
                    catPath += ">";

                catPath = catPath.replace('undefined>', '');
            });
        }
        else if (scriptLib.isMobile) {
            catPath = $(".category-breadcrumb").text();
        }
        */

        var pageNO;
        if (scriptLib.isDesktop) {
            if ($(".pagination-wrapper").length)
                pageNO = parseInt($(".pagination-wrapper").find("li.active").data("value"));
            else
                pageNO = 1;
        }
        else if (scriptLib.isMobile)
            pageNO = 1;

      // console.warn( scriptLib.getCategoryPath() );

      let catPath = scriptLib.getCategoryPath();
      catPath     = catPath.join('>');


        const itemFilters = await scriptLib.getPlpFilter();

        toBeInsertedObjsect = {
            event: "viewCategory",
            item: itemsSKU,
            page_id: pageView,
            store_id: storeID,
            page_number: pageNO,
            category: catPath,
            filters: itemFilters
        };
    }
}

/*
###########################################################################################################################
This is PDP page
###########################################################################################################################

*/
if(scriptLib.isPDP) {
  
    //############################################################
    //                FILLIING EVENT WITH DATA
    //############################################################
  
  const itemSKU = scriptLib.getProductSKU();
  const res = await fetch('https://data.mediamarkt.com.tr/uploads/static/scriptLib/API/getProductDetails.php?sku='+itemSKU);
  const productDetails = await res.json();
  pageView = scriptLib.isDesktop ? "viewItemDesktop" : "viewItemMobile";
  // scriptLib.injectJS("//dynamic.criteo.com/js/ld/ld.js?a=17343");
  toBeInsertedObjsect = {
            event: "viewItem",
            page_id: pageView,
            item: itemSKU,
            price: productDetails.data.price ,
            availability: productDetails.data.availability ? "1" : "0"
  };

  
        //############################################################
        //                  MAKING DIV
        //############################################################
        // let div = document.createElement('div');


  
        let switchToTestMode = false; // fales means prod; true means test mode
        if (!switchToTestMode || scriptLib.runThisFunctionOnlyInTestMode("e2f70623-1552-4ec1-ac02-751f6c53a521")) {
        // https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=e2f70623-1552-4ec1-ac02-751f6c53a521
        
          if(await scriptLib.waitUntilFieldCreated('#page-footer')) {
             if(scriptLib.isDesktop ) {
                $('#page-footer').before('<div id="viewItemDesktop-carousel"></div>');
             } else if(scriptLib.isMobile || scriptLib.isApplication) {
                $('#page-footer').before('<div id="viewItemMobile-carousel"></div>');
             }
          }

          $('#pdp-tab .pdp-tabs span').click( (e) => {
              let areaProvidedForInsider = $('#area-for-insider');
              let areaProvidedForCriteo = $('#viewItemDesktop-carousel');
              if(e.target.id=="pdp-tab4") {
                areaProvidedForInsider.show();
                areaProvidedForCriteo.show();
              } else {
                areaProvidedForInsider.hide();
                areaProvidedForCriteo.hide();
              }
          })
        }


  
}

/*
###########################################################################################################################
This is Basket page ()
###########################################################################################################################

*/
if(scriptLib.isBasketPage) {
    let switchToTestMode = false; // fales means prod; true means test mode
    if (!switchToTestMode || scriptLib.runThisFunctionOnlyInTestMode("e2f70623-1552-4ec1-ac02-751f6c53a521")) {
    // https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=e2f70623-1552-4ec1-ac02-751f6c53a521

      
    //############################################################
    //                FILLIING EVENT WITH DATA
    //############################################################
  
        const cartItemsList = scriptLib.productsInCart();
        const compiledObjectList = cartItemsList.map( a => ({
            id: a.id,
            price: a.price,
            quantity: a.quantity
        }))
        pageView = scriptLib.isDesktop ? "viewBasketDesktop" : "viewBasketMobile";
      /*
        const params = new URLSearchParams(window.location.search);
        let orderId = params.get('orderId');
        if(localStorage.orderId !== orderId) { // in case of refresh we will exit (same order id)
            localStorage.orderId = orderId;
        } else {
            return ;
        }
      */
        toBeInsertedObjsect = {
            event: "viewBasket", 
            page_id: pageView,
            // id: orderId,
            item: compiledObjectList
        };

        //############################################################
        //                  MAKING DIV
        //############################################################
        let div = document.createElement('div');
        if(scriptLib.isDesktop) {
            div.id = "viewBasketDesktop-carousel";
            $('#js-cart-app').after(div);
        } else if(scriptLib.isMobile || scriptLib.isApplication) {
            div.id = "viewBasketMobile-carousel";
            $('#wrapper-main .contentspot').after(div);
        }
        /*
        $(div).css({
            "width" : "100%",
            "height" : "269px",
            "margin-top": "40px",
        }); 
        */
    }
}


/*
###########################################################################################################################
This is Thankyou page ()
###########################################################################################################################

*/
if(scriptLib.isThankyouPage) {
  
    //############################################################
    //                FILLIING EVENT WITH DATA
    //############################################################
  
  const cartItemsList = scriptLib.productsPurchased();
  const compiledObjectList = cartItemsList.map( a => ({
    id: a.id,
    price: a.price,
    quantity: a.quantity
}))
pageView = scriptLib.isDesktop ? "trackTransactionDesktop" : "trackTransactionMobile";
const params = new URLSearchParams(window.location.search);
let orderId = params.get('orderId');
if(localStorage.orderId !== orderId) { // in case of refresh we will exit (same order id)
    localStorage.orderId = orderId;
} else {
    return ;
}
toBeInsertedObjsect = {
    event: "trackTransaction", 
    page_id: pageView, 
    // id: dataLayer.filter(a=>a.event=='gtm.load')[0]["gtm.uniqueEventId"]/*"Transaction Id"*/,
    id: orderId,
    item: compiledObjectList
};
}

/*
###########################################################################################################################
This is Main page
###########################################################################################################################

*/
if(scriptLib.isMainPage) {
  
    //############################################################
    //                FILLIING EVENT WITH DATA
    //############################################################
  
    pageView = scriptLib.isDesktop ? "viewHomeDesktop" : "viewHomeMobile";
    toBeInsertedObjsect = {
      event: "viewHome", page_id: pageView
    }
    
    //############################################################
    //                  MAKING DIV
    //############################################################
    let div = document.createElement('div');
    if(scriptLib.isDesktop) {
        div.id = "viewHomeDesktop-carousel";
        scriptLib.injectBrutCSS('#viewHomeDesktop-carousel-sponsored_products-0 {margin-top: 0 !important;}');
        $('#reference-point').parent().parent().prepend(div);
    } else if(scriptLib.isMobile || scriptLib.isApplication) {
        div.id = "viewHomeMobile-carousel"

        let switchToTestMode = false; // fales means prod; true means test mode
        if (!switchToTestMode || scriptLib.runThisFunctionOnlyInTestMode("e2f70623-1552-4ec1-ac02-751f6c53a521")) {
            // https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=e2f70623-1552-4ec1-ac02-751f6c53a521
          scriptLib.waitUntilFieldCreated('#ullist.titreh2').then( status => {
            if(status) {
              $('#reference-point').parent().parent().prepend(div);
            }
            scriptLib.injectBrutCSS(`a.vindjeshop {
                align-items: center;
                display: flex;
                justify-content: center;
                transform: translateY(-10px);
                height: 50px;
            }`)
          })
        }
    }
  /*
    $(div).css({
        "width" : "100%",
        //"height" : "269px",
        "margin-top": "40px",
    }); 
  */
}


/*
###########################################################################################################################
Firing the event
###########################################################################################################################

*/
window.criteo_q = window.criteo_q || [];
  
window.criteo_q.push(
{ event: "setAccount", account: account },
    { event: "setRetailerVisitorId", id: cokRVI },
    { event: "setCustomerId", id: customerId }, 
    { event: "setEmail", email: email},
    { event: "setSiteType", type: siteType },
    toBeInsertedObjsect
)

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
corporateSales() {
    if (!window.isOnLoadingFinishedEventMounted) {
        window.isOnLoadingFinishedEventMounted = true;
        document.addEventListener("onLoadingFinished", function () {
            scriptLibFunctions.corporateSales();
        });
    }

    // if (scriptLib.isDesktop) {
    //     if (scriptLib.isPDP) {
    //         scriptLib.injectCSS(
    //             "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/corporateSalesDesktop.min.css"
    //         );
    //         scriptLib.injectJS(
    //             "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/corporateSalesDesktop.min.js"
    //         );
    //     }
    // }

    // if (scriptLib.isMobile) {
    //     if (scriptLib.isPDP) {
    //         scriptLib.injectCSS(
    //             "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/corporateSalesMobile.min.css"
    //         );
    //         scriptLib.injectJS(
    //             "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/corporateSalesMobile.min.js"
    //         );
    //     }
    // }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
Buyback() {
// This is the new fiction:
if (!scriptLib.isPDP) return;
// category list:
    // let categoryListPhones = [504171, 644527, 675172];
    const productList = ["telefon", "tablet", "akıllı saat", "apple watch", "macbook"];
    // const isThisMobile = () => {
    //     // debugger
    //     //const regex = /504171|644527|675172/gm;
    //     const regex = new RegExp(categoryListPhones.join("|"), "gm");
    //     const str = $("html").html();
    //     let m;
    //     let count = 0;
    //     let res = false;

    //     while ((m = regex.exec(str)) !== null) {
    //         // This is necessary to avoid infinite loops with zero-width matches
    //         if (m.index === regex.lastIndex) {
    //             regex.lastIndex++;
    //         }

    //         // The result can be accessed through the `m`-variable.
    //         m.forEach((match, groupIndex) => {
    //             count++;
    //             // console.info(`Found match, group ${groupIndex}: ${match}`);
    //         });
    //     }
    //     if (count > 1) {
    //         res = true;
    //     }
    //     return res;
    // };
    setTimeout(async function() {
        var buyback = 0;
        if (scriptLib.isDesktop) {
            if ((await scriptLib.waitUntilFieldCreated(".breadcrumbs li"), 20)) {
                let exist = false;
                let title = $("#product-details div.details h1").text().toLowerCase();
                productList.map( it => {
                    exist = exist || ((title.indexOf(it) > -1) ? true : false);
                    if(it==="tablet") {
                     if(title.indexOf("ekran") > -1) {
                       exist = false;
                     }
                     else if(title.indexOf("tableti") > -1) {
                       exist = false;
                     }
                   }
                })
                if (exist) {
                    buyback = 1;
                }
            }
        } else if (scriptLib.isMobile || scriptLib.isApplication) {
            //$('.site-navigation2__child-list li')
            // if(await scriptLib.waitUntilFieldCreated('#wrapper-main .category-breadcrumb-container .category-breadcrumb-wrapper a'), 20) {
            // 	$('#wrapper-main .category-breadcrumb-container .category-breadcrumb-wrapper').each(function() {
            // 		var a = $(this).find('a').attr('href');
            // 		// if(a && (a.indexOf('504926') !==-1 || a.indexOf('639520') !==-1 || a.indexOf('504171') !==-1)) {
            // 		categoryListPhones.forEach((it)=> {
            // 			if(a && a.indexOf(it)!==-1) buyback = 2;
            // 		});
            // 	});
            // }
            // if(await scriptLib.waitUntilFieldCreated('#wrapper-main .category-breadcrumb-container .category-breadcrumb-wrapper a'), 20) {
            // $('#wrapper-main .category-breadcrumb-container .category-breadcrumb-wrapper').each(function() {
            // var a = $(this).find('a').attr('href');
            // var category = $('meta[property="prudsys:recomm:category"]').attr(
            //     "content"
            // );
            // // if(a && (a.indexOf('504926') !==-1 || a.indexOf('639520') !==-1 || a.indexOf('504171') !==-1)) {
            // categoryListPhones.forEach((it) => {
            //     if (category && category.indexOf(it) !== -1) buyback = 2;
            // });
            // // search for "telefon" word in the title of mobile version
            // let pos = $(".product-overview-title .ellipsis_text")
            //     .text()
            //     .toLowerCase()
            //     .indexOf("telefon");
            // if (pos > -1) {
            //     buyback = 2;
            // }

            if ((await scriptLib.waitUntilFieldCreated(".product-overview-title"), 20)) {
               let exist = false;
               let title = $(".product-overview-title .ellipsis_text").text().toLowerCase();
               productList.map( it => {
                   exist = exist || ((title.indexOf(it) > -1) ? true : false);
                   if(it==="tablet") {
                     if(title.indexOf("ekran") > -1) {
                       exist = false;
                     }
                     else if(title.indexOf("tableti") > -1) {
                       exist = false;
                     }
                   }
               })
               if (exist) {
                   buyback = 2;
               }
            }
            // });
            // }
        }

        let path = "#add-to-basket-buttons";
        if (buyback == 1) {
            // desktop
            // $('.n-more .options').append('<li><a class="buyback" href="#">Eski Cihazını Yenile</a></li>');
            path = ".n-more .options";
            if (!(await scriptLib.waitUntilFieldCreated(path, 20))) return;
            $(path).append(
                '<li><a class="buyback" href="#">Eski Cihazını Yenile</a></li>'
            );
        } else if (buyback == 2) {
            // mobile
            if (!(await scriptLib.waitUntilFieldCreated(path, 20))) return;
            $("#add-to-basket-buttons").after(
                '<div class="gridbox column-1-1 buyback"><a href="#">Eski Cihazını Yenile</a></div>'
            );
        }

        scriptLib.waitUntilFieldCreated(".buyback").then(() => {
            $(document).on("click", ".buyback", function() {
                console.info("Processing your request");
                // let uri = $('#addToBasket').data('data-request-url');
                let uri;
                buyback == 1 && (uri = $("#hidden-pdp-add-to-cart").data("href"));
                buyback == 2 && (uri = $("#addToBasket").data().requestUrl);
                let searchParams = new URLSearchParams(uri);
                const cat = searchParams.get("categoryId") || "";
                const catEntry = searchParams.get("catEntryId") || "";

                // var src="https://bayi.fintegre.com/OnlineBuyback?id=6912&requestID="+uId*2+"&returnCode=" + cat + "l"+ catEntry +"&userId="+uId;
                var src =
                    "https://www.mediamarkt.com.tr/tr/shop/eski-cihazini-yenile.html?returnCode=" +
                    cat +
                    "l" +
                    catEntry;
                window.location.href = src;
            });
        });
    }, 500);

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
setKargoFreeFor250TlAbove() {
// This is the new fiction:
if(!scriptLib.isBasketSummaryPage) return;
if(scriptLib.isDesktop) {
    let kargoFee = parseFloat($('span[ng-bind-html="partialPrice.value | to_trusted"]').text());
    if(kargoFee===0) {
      scriptLib.waitUntilFieldCreated('.tile._d_e_l_i_v_e_r_y [ng-if="deliveryMethod.details.deliveryPrice && !deliveryMethod.details.isDisabled"]')
      .then( found => {
        if(found) {
          $('.tile._d_e_l_i_v_e_r_y [ng-if="deliveryMethod.details.deliveryPrice && !deliveryMethod.details.isDisabled"]').text("Ücretsiz");
        }
      });
    }
}
else if(scriptLib.isMobile) {
    let kargoFee = parseFloat(summaryData.summary.totalSum.items.filter( a => a.label==='Kargo Ücreti')[0].value);
    if(kargoFee===0) {
      scriptLib.waitUntilFieldCreated('#delivery-options label[for="DELIVERY"] strong.ng-binding')
      .then( found => {
        if(found) {
          $('#delivery-options label[for="DELIVERY"] strong.ng-binding').text("Adrese Teslimat Ücretsiz");
        }
      });
    }
}
else if(scriptLib.isApplication) {
    let kargoFee = parseFloat(summaryData.summary.totalSum.items.filter( a => a.label==='Kargo Ücreti')[0].value);
    if(kargoFee===0) {
      scriptLib.waitUntilFieldCreated('#delivery-options label[for="DELIVERY"] strong.ng-binding')
      .then( found => {
        if(found) {
          $('#delivery-options label[for="DELIVERY"] strong.ng-binding').text("Adrese Teslimat Ücretsiz");
        }
      });
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async newHomeCarousel() {
if (scriptLib.isMainPage || scriptLib.isBasketPage) {
    $(document).on('onSlideCarousel', () => {
        scriptLibFunctions.newHomeCarousel();
    });
    
    if (scriptLib.isDesktop) {
        let res1 = await scriptLib.waitUntilFieldCreated('.product-container .products-grid > li .photo .info-wrapper');
        if (res1) {
            scriptLib.injectCSS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCarouselDesktop.min.css"
            );
            scriptLib.injectJS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCarouselDesktop.min.js"
            );
        }
    }
    if (scriptLib.isMobile) {
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCarouselMobile.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCarouselMobile.min.js"
        );
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async newEmptyContent() {
    if (scriptLib.isPDP) {
        if (scriptLib.isDesktop) {
            
            const getEmptyContent = () => {
                var emptyContent = ['<div class="empty-content">', '<div class="empty-photo"><img src="" class="pro-photo"></div>', '<p class="empty-text"></p>', '</div>'].join("");
            
                var pName = $('h1[itemprop="name"]').html();
                var imgSrc = $(".img-preview").attr('src');

                $("#pdp-tab").after(emptyContent);
                $(".pro-photo").attr("src", imgSrc);
                $('.empty-text').html(pName + " teknik özellikler için <a href='javascript:void(0);' id='tecSpec'>tıklayın.</a>");

                $("#tecSpec").on("click", function(){
                    $("#pdp-tab3").click();
                    $("html").animate({
                        scrollTop: $("#pdp-tab").offset().top - 200,
                    },
                        2000,
                        function () {
                            setTimeout(function () {
                                window.scroll(0, $("#pdp-tab").offset().top - 200);
                            }, 200);
                        }
                    );
                });
            }

            getEmptyContent();

            $("#pdp-tab1, #pdp-tab2, #pdp-tab3, #pdp-tab5, #pdp-tab6").on("click", function(){
                $(".empty-content").remove();
            });
            $("#pdp-tab4").on("click", function(){
                getEmptyContent();
            });
        
            let res1 = await scriptLib.waitUntilFieldCreated('.ux-media');
            let res2 = await scriptLib.waitUntilFieldCreated('#inpage-iframe-modal');
            let res3 = await scriptLib.waitUntilFieldCreated('#loadbeeIframeId');
    
            let res4 = await scriptLib.waitUntilFieldCreated('.ux-wr-head');
            let res5 = await scriptLib.waitUntilFieldCreated('#Taksit');
            let res6 = await scriptLib.waitUntilFieldCreated('.swogo-box');
          
            if (res1 || res2 || res3) {
                $(".empty-content").remove();
            }
            else if(!res4){
                $(".pdp-tabs > #pdp-tab2").css("display", "none");
                $(".tab-content > .content2").css("display", "none");
            }
            else if(!res5){
                $(".pdp-tabs > #pdp-tab6").css("display", "none");
                $(".tab-content > .content6").css("display", "none");            
            }
            else if(!res6){
                $(".pdp-tabs > #pdp-tab1").css("display", "none");
                $(".tab-content > .content1").css("display", "none");
            };
        }
        if (scriptLib.isMobile) {
            const getEmptyContentMobile = () => {
                var emptyContent = ['<div class="empty-content">', '<div class="empty-photo"><img src="" class="pro-photo"></div>', '<p class="empty-text"></p>', '</div>'].join("");
            
                var pName = $('h1[itemprop="name"] span').html();
                var imgSrc = $(".lightbox-link-gallery").attr('href');

                $(".tab-content-m4").append(emptyContent);
                $(".pro-photo").attr("src", imgSrc);
                $('.empty-text').html(pName + " teknik özellikler için <a href='javascript:void(0);' id='tecSpec'>tıklayın.</a>");
            
                $("#tecSpec").on("click", function(){
                    $("#pdp-tab-m-3").click();
                });
            }

            getEmptyContentMobile();
        
            let res1 = await scriptLib.waitUntilFieldCreated('.ux-media');
            let res2 = await scriptLib.waitUntilFieldCreated('#inpage-iframe-modal');
            let res3 = await scriptLib.waitUntilFieldCreated('#loadbeeIframeId');
    
            let res4 = await scriptLib.waitUntilFieldCreated('.ux-wr-head');
            let res5 = await scriptLib.waitUntilFieldCreated('#Taksit');
            let res6 = await scriptLib.waitUntilFieldCreated('.swogo-box');
            
            // setTimeout(() => {
                //$("#flix-inpage").after($(".empty-content"));
            // }, 2000);
          
            if (res1 || res2 || res3) {
                $(".empty-content").remove();
            }
            else if(!res4){
                $(".pdp-tabs > #pdp-tab2").css("display", "none");
                $(".tab-content > .content2").css("display", "none");
            }
            else if(!res5){
                $(".pdp-tabs > #pdp-tab6").css("display", "none");
                $(".tab-content > .content6").css("display", "none");            
            }
            else if(!res6){
                $(".pdp-tabs > #pdp-tab1").css("display", "none");
                $(".tab-content > .content1").css("display", "none");
            };
        }
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async newQuaranteeAndServices() {
if (scriptLib.isPDP) {
    if (scriptLib.isDesktop && await scriptLib.waitUntilFieldCreated('.content2')) {
      scriptLib.injectBrutCSS(`
           .ux-switch,.wr-item,.wr-item>label{position:relative}.ux-switch{display:inline-block;width:48px;height:22px}.ux-switch input{opacity:0;width:0;height:0}.ux-switch .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;-webkit-transition:0.4s;transition:0.4s;border-radius:34px}.ux-switch .slider:before{position:absolute;content:"";height:18px;width:18px;left:2px;bottom:2px;background-color:#fff;-webkit-transition:0.4s;transition:0.4s;border-radius:50%}.ux-switch input:checked+.slider{background-color:#1daa81}.ux-switch input:focus+.slider{box-shadow:0 0 1px #1daa81}.ux-switch input:checked+.slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(26px);transform:translateX(26px)}.wr-item{width:calc(33% - 40px);display:flex;align-items:center;justify-content:center;flex-direction:column;padding-top:30px;margin:10px 20px}.wr-head,.wr-message{width:100%;text-align:center;color:#fff}.wr-item+.wr-item::before{width:1px;height:50%;content:"";display:block;background:#ccc;left:-20px;top:25%;position:absolute}.wr-item:nth-child(4):before{content:none}.wr-head{position:absolute;top:0;background:#1daa81;padding:4px}.wr-price-wrapper{display:flex;align-items:center;margin:20px 0}.wr-price{font-size:32px;font-weight:600;margin-left:15px}.wr-taksit{font-size:14px;font-weight:400;margin-left:50px}.ux-wr{display:flex;flex-wrap:wrap;justify-content:center}.ux-wr-wrapper{padding:30px 20px 20px;border-radius:25px;border:1px solid #ccc;margin-top:20px;position:relative}.ux-wr-head{margin:20px 0}.ux-wr-head .p-big{font-size:22px;margin-bottom:15px}.ux-wr-head .p-big b{font-weight:700}.ux-wr-head p{font-size:16px;line-height:20px;margin-bottom:5px}.ux-wr-head a{font-size:12px;text-decoration:underline}.wr-item>label{line-height:18px;padding:0 25px}.wr-item .wr-head{display:none}.wr-item:nth-child(3) .wr-head{display:block}.wr-item label .info{position:absolute;display:block;right:0;top:0;background:url(http://data.mediamarkt.com.tr/ux/info.svg) no-repeat;width:16px;height:16px}.wr-footer{display:flex;align-items:center;margin:10px 0;font-size:14px}.wr-footer img{margin-right:20px}.content2 #product-service,.content2 .premiumboxes{display:none!important}.wr-message{background:#090;padding:8px;border-radius:5px;display:none;position:absolute;box-sizing:border-box;width:calc(100% - 40px);top:10px}
      `);
        var wrItems = '';
        var ll = ['644527', '465595', '504926', '639520', '587058', '640521'];
        var mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazınızı beklenmedik hasarlara karşı koruma altına alırken, garantisini de 5 yıla kadar uzatabilirsiniz.';
        $('.breadcrumbs li a').each(function () {

            var hr = $(this).attr('href');
            if (hr) {
                hr = hr.slice(hr.length - 11).replace('.html', '');
            }

            if (hr && hr.length === 6 && ll.indexOf(hr) !== -1) {
                mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazı kazaen oluşabilecek beklenmedik hasarlara karşı koruma altına alabilirsiniz.';
            }
        });
        var wrHead = [
            '<div class="ux-wr-head"><p class="p-big">',
            '    <b>Cihaz Koruma Sigortası</b> ile satın aldığınız ürünü kaza ve hasarlara karşı korumak ister misiniz?',
            '</p>',
            '<p>' + mes + '</p>',
            '<a href="https://www.mediamarkt.com.tr/tr/shop/hizmetler-koruma-paketi.html" target="_blank">Detaylı bilgi için tıklayınız</a></div>',
        ].join('');

        function findTaksit(str, prc) {
            var res = 0;
            for (var i = 1; i < 5; i++) {
                var tmp = str.split(i + ' Yıl');
                res += (tmp.length - 1) * i;
            }
            var taksit = +prc.split(',')[0];

            return Math.round(taksit / (res * 12)) + 'TL / ' + res * 12 + 'Ay *';
        }

        $('.content2 .extend-guarantee li.cf').each(function (i, v) {
            var lbl = $(v).find('.opt-name').text();
            var prc = $(v).find('.opt-value').text();
            var tempItem = ['<div class="wr-item">',
                '    <span class="wr-head">Mediamarkt Önerisi</span>',
                '    <label> ' + lbl + ' <a class="info" data-layer="warrantytype_external" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a></label>',
                '    <div class="wr-price-wrapper">',
                '        <label class="ux-switch">',
                '            <input type="checkbox" data-order="'+i+'" class="extend-guarantee-cb">',
                '            <span class="slider round"></span>',
                '        </label>',
                '        <h5 class="wr-price"><span>₺</span>' + prc,
                '            <span class="wr-taksit">' + findTaksit(lbl, prc) + '</span>',
                '        </h5>',
                '    </div>',
                '</div>'].join('');
            wrItems += tempItem;
        });

        var svItems = '';
        var svHead = [
            '<div class="ux-wr-head"><p class="p-big">',
            '    <b>Ek Hizmet Paketleri</b>',
            '</p>',
            '<p>Ek hizmet paketleri de satın aldığınız ürüne dayanıklı ekran koruyucu, tv ekran panel koruma gibi ürünlerle',
            '    birlikte teslim edilmesini sağlayabilirsiniz.</p>',
            '<a href="https://www.mediamarkt.com.tr/tr/shop/hizmetler-koruma-paketi.html" target="_blank">Detaylı bilgi için tıklayınız</a></div>',
        ].join('');

        $('.content2 #product-service li.cf').each(function (i, v) {
            var lbl = $(v).find('.service-name').text();
            var prc = $(v).find('.service-value').text();
            var value = $(v).find("span.icon").attr("data-layer");
            var tempItem = ['<div class="wr-item">',
                // '    <span class="wr-head">AVANTAJLI PAKET</span>',
                '    <label> ' + lbl + ' <a class="info" data-layer="' + value +
                '" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a></label>',
                '    <div class="wr-price-wrapper">',
                '        <label class="ux-switch">',
                '            <input type="checkbox" data-order="'+i+'" class="product-service-cb">',
                '            <span class="slider round"></span>',
                '        </label>',
                '        <h5 class="wr-price"><span>₺</span>' + prc,
                // '            <span class="wr-taksit">83TL/24 Ay</span>',
                '        </h5>',
                '    </div>',
                '</div>'].join('');
            svItems += tempItem;
        });

        var wrFooter = [
            '<div class="wr-footer">',
            '<a href="https://imgbb.com/"><img src="https://data.mediamarkt.com.tr/projects/cihazkoruma/cardif-logo.png" alt="cardif-bnp-paribas-group-logo-vector" border="0"></a>',
            '<div><p>Cihaz Koruma Sigortası ve Cihaz Koruma Sigortası Plus içerisinde sunulan sigorta ürününe ilişkin tüm teminatlar BNP Paribas Cardif Sigorta A.Ş. tarafından sağlanmaktadır.</p>',
            '* <i> Yasal düzenlemeler çerçevesinde cihaz türüne ve satış fiyatına bağlı olarak uygulanabilecek taksit sayıları farklılık gösterebilmektedir. Cihazın satın alınması esnasında tercih edilen taksit sayısı sigorta prim tutarının taksitlendirilmesi için de geçerli olacaktır.</i></div>',
            '</div>'
        ].join('');

        var lastHtm = '';
        if ($('.content2 .premiumopts li.cf').length) {
            lastHtm += wrHead + '<div class="ux-wr">' + wrItems + '</div>';
        }
        if ($('.content2 #product-service li.cf').length) {
            lastHtm += svHead + '<div class="ux-wr">' + svItems + '</div>';
        }
        $('.content2').prepend('<div class="ux-wr-wrapper"><div class="wr-message"></div>' + lastHtm + wrFooter + '</div>');

        $(document).on('change', '.extend-guarantee-cb', function () {

            $(".extend-guarantee-cb").not(this).each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).trigger('click');
                }
            });

            var order = $(this).data('order');
            $('.content2 .extend-guarantee ul li.cf input[type="checkbox"]').each(function(i, v) {
                if($(v).is(':checked')) {
                    $(v).click();
                }
            });


            if ($(this).is(':checked')) {

                $('.content2 .extend-guarantee ul li.cf').eq(order).find('input').trigger('click');
                $('.wr-message').hide().html('Paketiniz ürünle beraber sepetinize eklenecektir.').fadeIn();
                setTimeout(function () {
                    $('.wr-message').html('').fadeOut();
                }, 3000);
            }
        });

        $(document).on('change', '.product-service-cb', function () {

            $(".product-service-cb").not(this).each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).trigger('click');
                }
            });
            var order = $(this).data('order');
            $('.content2 #product-service ul li.cf input[type="checkbox"]').each(function(i, v) {
                if($(v).is(':checked')) {
                    $(v).click();
                }
            });
            if ($(this).is(':checked')) {
                $('.content2 #product-service ul li.cf').eq(order).find('input[type="checkbox"]').trigger('click');
                $('.wr-message').hide().html('Paketiniz ürünle beraber sepetinize eklenecektir.').fadeIn();
                setTimeout(function () {
                    $('.wr-message').html('').fadeOut();
                }, 3000);
            }
        });

        $(document).on("click", "#mmt-popup-layer .cls-icn", function() {
            window.added = false;
            window.filled = false;
            window.lastServiceName = "";
            window.initialized = false;
            window.swogoIsAvailable = false;
            window.swogoContent = null;        
            $('#mmt-popup-layer').html('');
        });
    }
    else if (scriptLib.isMobile || scriptLib.isApplication && await scriptLib.waitUntilFieldCreated('.additional-services-list')) {

        scriptLib.injectBrutCSS(`
        .ux-switch{position:relative;display:inline-block;width:48px;height:22px}.ux-switch input{opacity:0;width:0;height:0}.ux-switch .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;-webkit-transition:.4s;transition:.4s;border-radius:34px}.ux-switch .slider:before{position:absolute;content:"";height:18px;width:18px;left:2px;bottom:2px;background-color:#fff;-webkit-transition:.4s;transition:.4s;border-radius:50%}.ux-switch input:checked+.slider{background-color:#1daa81}.ux-switch input:focus+.slider{box-shadow:0 0 1px #1daa81}.ux-switch input:checked+.slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(26px);transform:translateX(26px)}.wr-item{width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative;padding-top:30px;margin:0 0 20px 0}.wr-item+.wr-item{border-top:1px solid #ccc}.wr-head{width:100%;text-align:center;position:absolute;top:0;background:#1daa81;padding:4px;color:#fff}.wr-price-wrapper{display:flex;align-items:center;margin:5px 0}.wr-price{font-size:24px;font-weight:600;margin:0 0 0 15px}.wr-taksit{font-size:14px;font-weight:400;margin-left:50px}.ux-wr{display:flex;flex-wrap:wrap;justify-content:center}.ux-wr-wrapper{padding:20px}.ux-wr-head{margin:20px 0 0}.ux-wr-head .p-big{font-size:18px;margin-bottom:15px}.ux-wr-head .p-big b{font-weight:700}.ux-wr-head p{font-size:16px;line-height:20px;margin-bottom:5px}.ux-wr-head a{font-size:12px;text-decoration:underline}.wr-item>label{position:relative;line-height:18px;padding:0 25px}.wr-item .wr-head{display:none}.wr-item:nth-child(3) .wr-head{display:block}.wr-item label .info{position:absolute;display:block;right:0;top:0;background:url(http://data.mediamarkt.com.tr/ux/info.svg) no-repeat;width:16px;height:16px}.wr-footer{display:flex;align-items:flex-start;margin:10px 0;font-size:14px;flex-direction:column;justify-content:flex-start}.wr-footer img{margin-bottom:10px}.wr-footer p{margin-bottom:10px}.content2 .premiumboxes,.content2 #product-service{display:none!important}.wr-message{width:100%;text-align:center;background:rgb(0,153,0) none repeat scroll 0% 0%;padding:8px;color:#fff;border-radius:5px;display:none;margin-bottom:10px}.group-service-articles .mrh-accordion-content .gridbox{display:none}.guarantee-info{display:none!important}
        `);

        var wrItems = '';
        var ll = ['644527', '465595', '504926', '639520', '587058', '640521'];
        var mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazınızı beklenmedik hasarlara karşı koruma altına alırken, garantisini de 5 yıla kadar uzatabilirsiniz.';
        var tmpCat = $('meta[property="prudsys:recomm:category"]').attr('content');
        var tmpParentCat = $('meta[property="prudsys:recomm:parentcategory"]').attr('content');
        var tmpTopCat = $('meta[property="prudsys:recomm:topcategory"]').attr('content');
        var sku = $('meta[property="sku"]').attr('content');

        if (sku) {
            if (tmpCat && sku.indexOf(tmpCat) !== -1) {
                mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazı kazaen oluşabilecek beklenmedik hasarlara karşı koruma altına alabilirsiniz.';
            }
            if (tmpParentCat && sku.indexOf(tmpParentCat) !== -1) {
                mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazı kazaen oluşabilecek beklenmedik hasarlara karşı koruma altına alabilirsiniz.';
            }
            if (tmpTopCat && sku.indexOf(tmpTopCat) !== -1) {
                mes = 'Cihaz Koruma Sigortası ile satın aldığınız elektronik cihazı kazaen oluşabilecek beklenmedik hasarlara karşı koruma altına alabilirsiniz.';
            }
        }
        var wrHead = [
            '<div class="ux-wr-head"><p class="p-big">',
            '    <b>Cihaz Koruma Sigortası</b> ile satın aldığınız ürünü kaza ve hasarlara karşı korumak ister misiniz?',
            '</p>',
            '<p>' + mes + '</p>',
            '<a href="https://www.mediamarkt.com.tr/tr/shop/hizmetler-koruma-paketi.html" target="_blank">Detaylı bilgi için tıklayınız</a></div>',
        ].join('');

        function findTaksit(str, prc) {
            var res = 0;
            for (var i = 1; i < 5; i++) {
                var tmp = str.split(i + ' Yıl');
                res += (tmp.length - 1) * i;
            }
            var taksit = +prc.split(',')[0];

            return Math.round(taksit / (res * 12)) + 'TL / ' + res * 12 + 'Ay *';
        }

        $('.additional-services-list:not(.service-articles-container) .mrh-accordion-content>.grid').each(function (i, v) {
            var lbl = $(v).find('label').text();
            var prc = $(v).find('.additional-service-price').text();
            var tempItem = ['<div class="wr-item">',
                '    <span class="wr-head">Mediamarkt Önerisi</span>',
                            '    <div class="wr-message"></div>',
                '    <label> ' + lbl + ' <a class="info" data-layer="warrantytype_external" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a></label>',
                '    <div class="wr-price-wrapper">',
                '        <label class="ux-switch">',
                '            <input type="checkbox" data-order="' + i + '" class="extend-guarantee-cb">',
                '            <span class="slider round"></span>',
                '        </label>',
                '        <h5 class="wr-price"><span>₺</span>' + prc,
                '            <span class="wr-taksit">' + findTaksit(lbl, prc) + '</span>',
                '        </h5>',
                '    </div>',
            
                '</div>'].join('');
            wrItems += tempItem;
        });

        var svItems = '';
        var svHead = [
            '<p>Ek hizmet paketleri de satın aldığınız ürüne dayanıklı ekran koruyucu, tv ekran panel koruma gibi ürünlerle',
            '    birlikte teslim edilmesini sağlayabilirsiniz.</p>',
            '<a href="https://www.mediamarkt.com.tr/tr/shop/hizmetler-koruma-paketi.html" target="_blank">Detaylı bilgi için tıklayınız</a></div>',
        ].join('');

        $('.service-articles-container.additional-services-list .mrh-accordion-content>.grid').each(function (i, v) {
            var lbl = $(v).find('label').text();
            var prc = $(v).find('.additional-service-price').text();
            var value = $(v).find('input.input-text').attr("value");
            var tempItem = ['<div class="wr-item">',
                // '    <span class="wr-head">AVANTAJLI PAKET</span>',
                            '    <div class="wr-message"></div>',
                '    <label> ' + lbl + ' <a class="info" data-layer="service_' + value + '" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a></label>',
                '    <div class="wr-price-wrapper">',
                '        <label class="ux-switch">',
                '            <input type="checkbox" data-order="' + i + '" class="product-service-cb">',
                '            <span class="slider round"></span>',
                '        </label>',
                '        <h5 class="wr-price"><span>₺</span>' + prc,
                // '            <span class="wr-taksit">83TL/24 Ay</span>',
                '        </h5>',
                '    </div>',
                '</div>'].join('');
            svItems += tempItem;
        });

        var wrFooter = [
            '<div class="wr-footer">',
            '<a href="https://imgbb.com/"><img src="https://data.mediamarkt.com.tr/projects/cihazkoruma/cardif-logo.png" alt="cardif-bnp-paribas-group-logo-vector" border="0"></a>',
            '<div><p>Cihaz Koruma Sigortası ve Cihaz Koruma Sigortası Plus içerisinde sunulan sigorta ürününe ilişkin tüm teminatlar BNP Paribas Cardif Sigorta A.Ş. tarafından sağlanmaktadır.</p>',
            '* <i> Yasal düzenlemeler çerçevesinde cihaz türüne ve satış fiyatına bağlı olarak uygulanabilecek taksit sayıları farklılık gösterebilmektedir. Cihazın satın alınması esnasında tercih edilen taksit sayısı sigorta prim tutarının taksitlendirilmesi için de geçerli olacaktır.</i></div>',
            '</div>'
        ].join('');

        if ($('.additional-services-list:not(.service-articles-container) .mrh-accordion-content>.grid').length) {
            var lastHtm = wrHead + '<div class="ux-wr">' + wrItems + '</div>';
            $('.additional-services-list:not(.service-articles-container) .mrh-accordion-content').prepend('<div class="ux-wr-wrapper ux-wr-gr-wrapper">' + lastHtm + wrFooter + '</div>');
        }
        if ($('.service-articles-container.additional-services-list .mrh-accordion-content>.grid').length) {
            var lastHtm = svHead + '<div class="ux-wr">' + svItems + '</div>';
            $('.service-articles-container.additional-services-list .mrh-accordion-content').prepend('<div class="ux-wr-wrapper ux-wr-sv-wrapper">' + lastHtm + wrFooter + '</div>');
        }

        $(document).on('change', '.extend-guarantee-cb', function () {

            $(".extend-guarantee-cb").not(this).each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).trigger('click');
                }
            });

            var order = $(this).data('order');

            if ($(this).is(':checked')) {
                $('.additional-services-list:not(.service-articles-container) .mrh-accordion-content>.grid').eq(order).find('input').trigger('click');
                $(this).closest('.wr-item').find('.wr-message').hide().html('Paketiniz ürünle beraber sepete eklenecektir.').fadeIn();
                setTimeout(function () {
                    $('.wr-message').html('').fadeOut();
                }, 3000);
            } else {
                $('.additional-services-list:not(.service-articles-container) .mrh-accordion-content>.grid').eq(order).find('input').removeAttr('checked');
            }
            setTimeout(function () {
                synchronizePopupCheckboxesWithPageCheckboxes();
            }, 300);
        });

        $(document).on('change', '.product-service-cb', function () {

            $(".product-service-cb").not(this).each(function (i, v) {
                if ($(v).is(':checked')) {
                    $(v).trigger('click');
                }
            });
            var order = $(this).data('order');
            if ($(this).is(':checked')) {
                $('.service-articles-container.additional-services-list .mrh-accordion-content>.grid').eq(order).find('input').trigger('click');
                $(this).closest('.wr-item').find('.wr-message').hide().html('Paketiniz ürünle beraber sepete eklenecektir.').fadeIn();
                setTimeout(function () {
                    $('.wr-message').html('').fadeOut();
                }, 3000);
            } else {
                $('.service-articles-container.additional-services-list .mrh-accordion-content>.grid').eq(order).find('input').removeAttr('checked');
            }
            setTimeout(function () {
                synchronizePopupCheckboxesWithPageCheckboxes();
            }, 300);
        });

        $(document).on('click', '#mina', function () {
            fillSwogoWarranties();
            setTimeout(function () {
                synchronizePopupCheckboxesWithPageCheckboxes();
            }, 300);
        });

        function fillSwogoWarranties() {
            $('#container-pop section.first-section .warranties').html('');
            $('#container-pop section.first-section .services').html('');
            let services = [],
                warranties = [];
            $('input.input-text').each((index, element) => {
                element = $(element);
                let parent = element.parent();
                let label = parent.find('label').text().replace(/(\t|\n)/g, '');
                let value = element.attr("value");
                let price = parent.parent().parent().find('.gridbox').eq(2).text().replace(/(\t|\n)/g, '');
                let isService = element.attr('name').split('[')[1].indexOf("service") !== -1;
                let checked = element.is(':checked');
                if (isService) {
                    services.push({
                        "index": index,
                        "label": label,
                        "value": value,
                        "price": price,
                        "checked": checked
                    });
                } else {
                    warranties.push({
                        "index": index,
                        "label": label,
                        "value": value,
                        "price": price,
                        "checked": checked
                    });
                }
            })

            let warrantiesHtml;
            let servicesHtml;

            if (services.length) {
                servicesHtml = '<h3 class="sub-title">Cihazınızı uyumlu ek hizmet ister misiniz?</h3>';
                services.forEach((ele) => {
                    servicesHtml += [
                        '<div class="item">',
                        '    <label for="s' + ele.index + '">' + ele.label, 
                        '    <a class="button-info-layer" data-layer="service_' + ele.value + '" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a>',
                        '</label>',
                        '<div class="w-item-price">',
                        '    <input class="input-service-warranty" param-prefix="serviceCatEntryId" index="' + ele
                            .index + '" type="checkbox" id="s' + ele.index + '"  value="' + ele.value + '"/>',
                        '    <span class="price">₺' + ele.price + '</span>',
                        '</div>',
                        '</div>'
                    ].join('');
                })
            }

            if (warranties.length) {
                warrantiesHtml = '<h3 class="sub-title">Cihazınızı güvence altına almak ister misiniz?</h3>';
                warranties.forEach((ele) => {
                    warrantiesHtml += [
                        '<div class="item">',
                        '<label for="w' + ele.index + '">' + ele.label, 
                        '<a class="button-info-layer" data-layer="warrantytype_external" data-gtm-event="EEC_PRODUCT_CLICK" data-gtm-event-ext="gtmGuaranteeProduct' + i + 1 + '" data-gtm-impression-event-add="EEC_PRODUCT_DETAIL_VIEW" data-gtm-impression-event-ext="gtmGuaranteeProduct' + i + 1 + '"></a>',
                        '</label>',
                        '<div class="w-item-price">',
                        '<input class="input-service-warranty" param-prefix="warrExtCatEntryId" index="' + ele.index + '" type="checkbox" id="w' + ele.index + '"  value="' + ele.value + '"/>',
                        '<span class="price">₺' + ele.price + '</span>',
                        '</div>',
                        '</div>'
                    ].join('');
                })
            }
            $('#container-pop section.first-section .warranties').html(warrantiesHtml);
            $('#container-pop section.first-section .services').html(servicesHtml);

            //Afet Yardım
            if ($('h1[itemprop="name"]').find("span.ellipsis_text").html().toLocaleLowerCase().indexOf('afet yardım') != -1 || $('h1[itemprop="name"]').find("span.ellipsis_text").html().toLocaleLowerCase().indexOf('afet yardim') != -1) {
                scriptLib.waitUntilFieldCreated("#container-pop").then((result) => {
                    if (result) {
                        $(".services").css({ "display": "none" });
                        $(".warranties").css({ "display": "none" });
                        $(".tab-selector").css({ "display": "none" });
                    }
                })
            }
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async BasarsoftNewAddressImplementation() {if (!scriptLib.runThisFunctionOnlyInTestMode("f268c7c4-9e67-4bee-bbf7-437e668d2171")) return;
// Connecting the fields to variables
const fields = {
  anaAddress_Input: $('input[name="street"]'),
  ekAddress_Input: $('input[name="addressAddition"]'),
  city_Select: $('address-remote-options[name="city"] select[name="remoteOptions"]'),
  province_Select: $('address-remote-options[name="district"] select[name="remoteOptions"]'),
  district_Select: $('address-remote-options[name="zip"] select[name="remoteOptions"]')
}

// Hide the fields that will be replaced
fields.anaAddress_Input.hide();
fields.ekAddress_Input.hide();

// Create new fields instead of the hidden ones
const newFields = {
  anaAddress_Input: $('<input type="text" />'),
  ekAddress_Input: $(`
  <div style="display: flex;">
    <input type="text">
    <input type="text">
    <input type="text">
  </div>`)
}
fields.anaAddress_Input.after(newFields.anaAddress_Input);
fields.ekAddress_Input.after(newFields.ekAddress_Input);

newFields.anaAddress_Input.val(fields.anaAddress_Input.val()); 
newFields.ekAddress_Input.val(fields.ekAddress_Input.val()); 

// select Hatay:
fields.city_Select.val('number:-37');
fields.city_Select.trigger('onchange');

// select Bozkurt:
fields.province_Select.val('number:-359');
fields.province_Select.trigger('onchange');

// select Mahmudiye Mh.:
fields.district_Select.val('number:-22476');
fields.district_Select.trigger('onchange');

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async newCheckoutLogin() {
if(scriptLib.isCheckoutLoginPage){
    let loading = `<div id="loading-wrapper"><img src="https://csscdn.redblue.de/MediaTR/skins/102021/tr/images/general/mm-loader.gif" alt="loading icon"></div><style>#loading-wrapper{display:flex;position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;justify-content:center;align-items:center;background-color:#fff}</style>`;
    $('body').append(loading);

    let res = await scriptLib.waitUntilFieldCreated('.coform-field-input.error');

    $('.cobutton.cobutton-next').on('click', function () {
        if (!res) {
            scriptLib.SetLoadingLayer(true);
        }
    })

    /*if(scriptLib.isDesktop){
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCheckoutLoginDesktop.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCheckoutLoginDesktop.min.js"
        );              
    }
    if(scriptLib.isMobile){
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCheckoutLoginMobile.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newCheckoutLoginMobile.min.js"
        );            
    }*/
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
newLoginUX() {
/*if(scriptLib.isLoginPage){
    if(scriptLib.isDesktop){
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newLoginDesktop.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newLoginDesktop.min.js"
        );              
    }
    if(scriptLib.isMobile){
        scriptLib.injectCSS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newLoginMobile.min.css"
        );
        scriptLib.injectJS(
            "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/newLoginMobile.min.js"
        );            
    }
}*/

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async AfetYardim() {
    if (scriptLib.isDesktop) {
        if(scriptLib.isPDP){
            var pName = $('h1[itemprop="name"]').html();
            var message = '<p style="padding:15px;line-height:20px;background-color:#000;color:#fff;font-size:16px;font-weight:700;margin:15px auto;font-family: Source Sans Pro,Arial,sans-serif !important;">Bu ürün Deprem Yardımlaşma Seferberliği kapsamındaki bağış ürünüdür. Girilen teslimat adresi fark etmeksizin, AFAD ile doğrudan deprem bölgesine gönderilecektir. Sipariş verdikten sonra iptal ve iade işlemleri yapılamaz.</p>';

            if (pName && pName.toLocaleLowerCase().indexOf('afet yardım') > -1 || pName && pName.toLocaleLowerCase().indexOf('afet yardim') > -1) {
                scriptLib.waitUntilFieldCreated(".button-green-pdp").then((result) => {
                    if (result) {
                        $(".breadcrumbs").before(message);

                        scriptLib.injectBrutCSS(`
                        .store-delivery,
                        .send-stock,
                        .stock-info,
                        .ux-taksit,
                        .box.infobox.availability ul li:first-child,
                        .price-sidebar .infobox ul > span,
                        #pdp-tab,
                        .product-meta-nav,
                        .swogo-box,
                        .empty-content{
                            display:none !important;
                            visibility:hidden !important;
                        }
                        .button-green-pdp{
                            background:#000 !important;
                        }`);
                    }
                })
            }
        }
        if (scriptLib.isBasketPage || scriptLib.isRegisterBasketPage) {
            if (!window.isOnLoadingFinishedEventMountedForBasket) {
                window.isOnLoadingFinishedEventMountedForBasket = true;
                document.addEventListener("onLoadingFinished", function () {
                    scriptLibFunctions.AfetYardim();
                });
            }
            
            if($('.message-one').length) return;
            $('.cproduct-info').each(function(i) {
                $(".false.before").css({ "display": "none", "visibility": "hidden" });

                if ($(this).find("h2.cproduct-heading").length) {
                    var pName = $(this).find("h2.cproduct-heading").html();
                    var messageOne = '<p class="message-one" style="padding:10px;line-height:16px;background-color:#000;color:#fff;font-size:14px;font-weight:600;margin:15px auto;font-family: Source Sans Pro,Arial,sans-serif !important;">Bu ürün Deprem Yardımlaşma Seferberliği kapsamındaki bağış ürünüdür. Girilen teslimat adresi fark etmeksizin, AFAD ile doğrudan deprem bölgesine gönderilecektir. Sipariş verdikten sonra iptal ve iade işlemleri yapılamaz.</p>'

                    var messageTwo = '<p class="message-two" style="padding:10px;line-height:16px;background-color:#000;color:#fff;font-size:14px;font-weight:600;margin:15px 0 0;font-family: Source Sans Pro,Arial,sans-serif !important;">Deprem Yardımlaşma Seferberliği kapsamında ürünleri satın alırken girilen teslimat adresi farketmeksizin, ürünler AFAD ile doğrudan deprem bölgesine gönderilecektir. Siparişinizde kendiniz için aldığınız ürünler olması durumunda girdiğiniz teslimat adresine ulaştırılacaktır.</p>'

                    if (pName && pName.toLocaleLowerCase().indexOf('afet yardım') > -1 || pName && pName.toLocaleLowerCase().indexOf('afet yardim') > -1) {
                        $(this).find(".description").append(messageOne);
                        
                        if($('.message-two').length) return;
                        $(".copanel-delivery .content-container .selected-method").after(messageTwo);

                        $(this).parents(".cart-product-table").find(".single-services-table").css({ "display": "none", "visibility": "hidden" });
                    }

                    if (scriptLib.isRegisterBasketPage) {
                        scriptLib.injectBrutCSS(`
                        .delivery-time{
                            display:none !important;
                            visibility:hidden !important;
                        }`);
                    }
                }
            });
        }
    }
    if(scriptLib.isMobile || scriptLib.isApplication){
        if (scriptLib.isPDP) {
            var pName = $('h1[itemprop="name"]').find("span.ellipsis_text").html();
            var message = '<p style="padding:10px;line-height:20px;background-color:#000;color:#fff;font-size:14px;font-weight:600;margin:10px 0;font-family: Source Sans Pro,Arial,sans-serif !important;">Bu ürün Deprem Yardımlaşma Seferberliği kapsamındaki bağış ürünüdür. Girilen teslimat adresi fark etmeksizin, AFAD ile doğrudan deprem bölgesine gönderilecektir. Sipariş verdikten sonra iptal ve iade işlemleri yapılamaz.</p>';

            if (pName && pName.toLocaleLowerCase().indexOf('afet yardım') > -1 || pName && pName.toLocaleLowerCase().indexOf('afet yardim') > -1) {
                scriptLib.waitUntilFieldCreated(".stok-sorgu").then((result) => {
                    if (result) {
                        $(".category-breadcrumb-container").before(message);

                        $(".ux-taksit").css({ "display": "none", "visibility": "hidden" });
                        $("#delivery-type").css({ "display": "none", "visibility": "hidden" });
                        $(".store-delivery-mobile").css({ "display": "none", "visibility": "hidden" });
                        $(".add-to-comparison-list").parent().css({ "display": "none", "visibility": "hidden" });
                        $(".stok-sorgu").parent().css({ "display": "none", "visibility": "hidden" });
                        $(".add-to-wishlist").parent().css({ "display": "none", "visibility": "hidden" });
                        $("#corporateOfferBtn").parent().css({ "display": "none", "visibility": "hidden" });
                        $("#pdp-tab-m").css({ "display": "none", "visibility": "hidden" });
                        $(".additional-services-list").parent().css({ "display": "none", "visibility": "hidden" });
                        $("#mina.mmt-hemenal-btn").css({"background": "#000", "border-color": "#000"}).text("Destek Ol");
                    }
                })
            }
        }
        if (scriptLib.isBasketPage) {
            $('.basket-teaser-item').each(function(i, v) {
                var pName = $(v).find('.basket-product-title-wrapper h2:eq(0)').html();
                if (pName && pName.toLocaleLowerCase().indexOf('afet yardım') > -1 || pName && pName.toLocaleLowerCase().indexOf('afet yardim') > -1) {
                    if (!$(v).find('.afetbilgi').length) {
                        $(v).find('.basket-teaser-container').append('<p class="afetbilgi" style="display:inline-block;padding:10px;line-height:16px;background-color:#000;color:#fff;font-size:12px;font-weight:600;margin:15px auto;font-family: Source Sans Pro,Arial,sans-serif !important;">Bu ürün Deprem Yardımlaşma Seferberliği kapsamındaki bağış ürünüdür. Girilen teslimat adresi fark etmeksizin, AFAD ile doğrudan deprem bölgesine gönderilecektir. Sipariş verdikten sonra iptal ve iade işlemleri yapılamaz.</p>');

                        $(v).find(".service-warranty-item").parents(".grid").css({ "display": "none", "visibility": "hidden" });
                    }
                }
            });
        }
        if (scriptLib.isRegisterBasketPage) {
            scriptLib.waitUntilFieldCreated(".product-teaser").then((result) => {
                if (result) {
                    $('.product-teaser').each(function (i, v) {
                        var pName = $(v).find('h3.ellipsis').html();
                        if (pName && pName.toLocaleLowerCase().indexOf('afet yardım') > -1 || pName && pName.toLocaleLowerCase().indexOf('afet yardim') > -1) {
                            if (!$(v).find('.afetbilgi').length) {
                                $(v).find('.additional-info').append('<p class="afetbilgi" style="display:inline-block;padding:10px;line-height:16px;background-color:#000;color:#fff;font-size:12px;font-weight:600;margin:15px auto;font-family: Source Sans Pro,Arial,sans-serif !important;max-height:84px;">Bu ürün Deprem Yardımlaşma Seferberliği kapsamındaki bağış ürünüdür. Girilen teslimat adresi fark etmeksizin, AFAD ile doğrudan deprem bölgesine gönderilecektir. Sipariş verdikten sonra iptal ve iade işlemleri yapılamaz.</p>');
                                
                                if($('.message-two').length) return;

                                $(v).parents(".summary-page").find(".summary-billing").append('<p class="message-two" style="padding:10px;line-height:16px;background-color:#000;color:#fff;font-size:12px;font-weight:600;margin:0 0 10px;font-family: Source Sans Pro,Arial,sans-serif !important;">Deprem Yardımlaşma Seferberliği kapsamında ürünleri satın alırken girilen teslimat adresi farketmeksizin, ürünler AFAD ile doğrudan deprem bölgesine gönderilecektir. Siparişinizde kendiniz için aldığınız ürünler olması durumunda girdiğiniz teslimat adresine ulaştırılacaktır.</p>');
                            }
                        }
                    });
                }
            })
        }
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
refurbishedPhone() {
    if (scriptLib.isPDP) {
        if (scriptLib.isDesktop || scriptLib.isMobile) {
            var pName = $('h1[itemprop="name"]').html();

            if (pName && pName.toLocaleLowerCase().indexOf('yenilenmiş') > -1) {
                scriptLib.injectBrutCSS(`
                        .store-delivery{
                            display:none !important;
                            visibility:hidden !important;
                        }
                        #product-sidebar .support img{
                            width: auto !important;
                        }`);
            }
        }
        if (scriptLib.isMobile || scriptLib.isApplication) {
            var pName = $('h1[itemprop="name"]').find("span.ellipsis_text").html();

            var btnSustainability = '<a href="#" data-layer="sustainability"><img src="//assets.mmsrg.com/isr/166325/c1/-/ASSET_MMS_101504845/fee_70_y_png" alt="" width="70"></a>';

            if (pName && pName.toLocaleLowerCase().indexOf('yenilenmiş') > -1) {
                scriptLib.injectBrutCSS(`
                        .store-delivery-mobile{
                            display:none !important;
                            visibility:hidden !important;
                        }
                        `);
                
                $('.pdp-product-info .column-1-3').append(btnSustainability);
            }
        }
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async iphone14PdpCargoDate() {if (!scriptLib.runThisFunctionOnlyInTestMode("341964f5-36fa-47cb-a52b-4c26703285b5")) return;
if (scriptLib.isPDP) {
    if (scriptLib.isDesktop) {
        let productList = ['1228159', '1228160', '1228161', '1228162', '1228163', '1228164']; console.info('this is temporaRY BECAUSE SCRİPT LİB İS NOT WORKİNG THANK YOU VERY MUCH')
        let productID = $('span[itemprop="sku"]').attr('content').split(':')[1] ;
        let mesaj = 'Ön Sipariştir! 24 Mart itibarıyla kargolanacaktır.';
        if(productList.includes(productID)) {
            $(".price-sidebar .infobox ul > span").text(mesaj);
        }
        if(productList.includes('1223654')) {
            $(".price-sidebar .infobox ul > span").text(mesaj);
        }
    }
    if (scriptLib.isMobile) {
        let productList = ['1228159', '1228160', '1228161', '1228162', '1228163', '1228164']; console.info('this is temporaRY BECAUSE SCRİPT LİB İS NOT WORKİNG THANK YOU VERY MUCH')
        let productID = $('meta[property="sku"]').attr('content').split(':')[1];
        let mesaj = 'Ön Sipariştir! 24 Mart itibarıyla kargolanacaktır.';
        setTimeout(()=>{
            if(productList.includes(productID)) {
                $('#type-standard-delivery h2').html(mesaj)
            }
            if(productList.includes('1223654')) {
                $('#type-standard-delivery h2').html(mesaj)
            }
        },3000);
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async ankastreSetlerLP() {
if (window.location.pathname.indexOf("/tr/shop/ankastre-setler.html") >= 0) {
    if(scriptLib.isDesktop){
        if(await scriptLib.waitUntilFieldCreated('.cms-products-grid .ct-products-grid>li .base-info .photo img')) {
            scriptLib.injectCSS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/ankastreSetlerDesktop.min.css"
            );
            scriptLib.injectJS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/ankastreSetlerDesktop.min.js"
            );
        }
    }
    if(scriptLib.isMobile){
        if(await scriptLib.waitUntilFieldCreated('.dynamic-product-list.template-grid .dynamic-grid-bordered-item img.product-teaser-image')) {
            scriptLib.injectCSS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/ankastreSetlerMobile.min.css"
            );
            scriptLib.injectJS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/ankastreSetlerMobile.min.js"
            );
        }
    }
}
else if (window.location.pathname.indexOf("/tr/shop") >= 0) {
    if(scriptLib.isDesktop){
        if(await scriptLib.waitUntilFieldCreated('.cms-products-grid .ct-products-grid>li .base-info .photo img')) {
            scriptLib.injectCSS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/landingPagesDesktop.min.css"
            );
            scriptLib.injectJS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/landingPagesDesktop.min.js"
            );
        }
    }
    if(scriptLib.isMobile){
        if(await scriptLib.waitUntilFieldCreated('.swiper-slide .product-teaser-container figure img')) {
            scriptLib.injectCSS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/landingPagesMobile.min.css"
            );
            scriptLib.injectJS(
                "//ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/landingPagesMobile.min.js"
            );
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async AboveFooterAreaForInsider() {
// This is the new fiction:

if(scriptLib.isPDP) {
  if(await scriptLib.waitUntilFieldCreated('#page-footer')) {
    $('#page-footer').before('<div id="area-for-insider"></div>');
  }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async newMobileBreadcrumb() {
// This is the new fiction:
    if (scriptLib.isMobile) {
        if (scriptLib.isPDP) {
            if (await scriptLib.waitUntilFieldCreated('#wrapper-main>.category-breadcrumb-container')) {
                scriptLib.injectBrutCSS(`
                    .category-breadcrumb-wrapper{
                        display: none !important;
                        visibilty: hidden !important;
                    }
                    ul.breadcrumb-list{
                        display: flex;
                        flex-direction: row;
                        list-style: none;
                        margin: 0;
                        overflow-x: auto;
                        padding: 0 5px 10px;
                        width: 100%;
                        white-space: nowrap;
                    }
                    ul.breadcrumb-list li{
                        align-items: center;
                        display: flex;
                    }
                    ul.breadcrumb-list li:not(:first-child):before {
                        content: "v";
                        font-family: MM-IconFont,sans-serif;
                        display: inline-block;
                        transform: rotate(-90deg);
                        font-size: 8px;
                        padding: 0;
                        margin-right: 5px;
                        position: relative;
                    }
                    ul.breadcrumb-list li+li{
                        padding-left: 5px;
                    }
                    ul.breadcrumb-list li a{
                        color: #000;
                    }
                    ul.breadcrumb-list li:first-child a{
                        background: url(https://csscdn.redblue.de/MediaTR/skins/102021/tr/images/general/spritescd.png) no-repeat scroll -77px -41px transparent;
                        height: 10px;
                        width: 11px;
                        margin-top: -5px;
                        text-indent: -999em;
                        vertical-align: middle;
                    }
                `);

                var breadcrumbList = "<ul class='breadcrumb-list'></ul>"
                $('.category-breadcrumb-container').append(breadcrumbList);

                let json = $('script[type="application/ld+json"]').html();
                let links = JSON.parse(json).itemListElement;

                var list = links.map((breadcrumb) => {
                    return `
                    <li><a href="${breadcrumb.item['@id']}">${breadcrumb.item['name']}</a></li>
                    `
                }).join().replaceAll('\n', '').replaceAll('\r', '').replaceAll('\t', '').replaceAll(',', '');

                $('.breadcrumb-list').append(list);

                $('.breadcrumb-list li:last-child a').attr("href", "");
            }
        }
    }

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
havaleEftQR() {
// This is the new fiction:

if (scriptLib.isThankyouPage) {
    if (scriptLib.isDesktop) {
        var qr = "<td><img src='https://ux.mediamarkt.com.tr/MMFrontend/ecomm/img/thankyou/garanti-qr.jpg' height='205'></td>";

        if ($(".content-thankyou.thankyou h3").text().indexOf("EFT /HAVALE BİLGİLENDİRME:") >= 0) {
            $(".addtional-details").find("table tr").append(qr);
        }
    }
    if (scriptLib.isMobile) {
        var qr = "<img src='https://ux.mediamarkt.com.tr/MMFrontend/ecomm/img/thankyou/garanti-qr.jpg' width='100%'>";

        if ($(".bg-white h2").text().indexOf("EFT/Havale ile İlgili Bilgiler") >= 0) {
            $("section.bg-white:eq(2)").append(qr);
        }
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/
async omnichannelServicesProject() {if (!scriptLib.runThisFunctionOnlyInTestMode("2fbdd20c-c2b6-42f1-bb3f-ae1a4ad9baa6")) return;
// This is the new fiction:

if(await scriptLib.waitUntilFieldCreated('#page-footer')) {
    if(scriptLib.isDesktop ) {
       
    } 
    else if(scriptLib.isMobile || scriptLib.isApplication) {
       
    }
}

this.methodsEndedExecutionCount++;
}
/*
######################################################################################################################################
function ended
######################################################################################################################################
*/

}
// ###___END_OF_CLASS___###
/*
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 **************																											************
 **************																											************
 **************											SCRIPT LIB														************
 **************																											************
 **************																											************
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Mon Mar 21 2022 @ 12:25
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
class ScriptLib {
    constructor() {
        // Member List:
        this.isApplication = this.getCookie("MC_DEVICE_ID") == "-111" ? true : false;
        this.isMobile = this.getCookie("MC_DEVICE_ID") == "-11" ? true : false;
        this.isDesktop = this.getCookie("MC_DEVICE_ID") == "-1" ? true : false;
        this.isMainPage = dataLayer[0].pageType === "Home" ? true : false;
        this.isPDP = window.location.pathname.indexOf("/tr/product") >= 0 ? true : false;
        this.isBasketPage = window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelDisplayBasket") >= 0 ? true : false;
        this.isCategoryPage = window.location.pathname.indexOf("/tr/category") >= 0 ? true : false;
        this.isOutlet = window.location.pathname.indexOf("/tr/category/_outlet") >= 0 ? true : false; // outlet page is also category page
        this.isSearchPage = (
            window.location.pathname.indexOf("/tr/search") >= 0 /* ||
            window.location.pathname.indexOf("/tr/shop") >= 0 */
            ) ? true : false;
        this.isInstallationPage = window.location.pathname.indexOf("/tr/shop/urun-kurulumu.html") >= 0 ? true : false;
        this.isWishListPage = window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelMAWishlist") >= 0 ? true : false;
        this.isThankyouPage =  window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelOrderSent") >= 0 ? true : false;
        this.isRegisterBasketPage = window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelOrderSummary") >= 0 ||
            window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelOrderRegistration") >= 0 ? true : false;
        this.isBasketSummaryPage = this.isRegisterBasketPage;
        this.isRegisterPage = window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelMARegister") >= 0 ||
            window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelUserRegistrationAdd") >= 0 ? true : false;
        this.isPLP = this.isCategoryPage || this.isSearchPage;
        this.isLoginPage =  window.location.pathname.indexOf("/webapp/wcs/stores/servlet/LogonForm") >= 0 ? true : false;
        this.isCheckoutLoginPage =  window.location.pathname.indexOf("/webapp/wcs/stores/servlet/MultiChannelOrderAuthentication") >= 0 ? true : false;
        this.userData = mcs.user;
        this.isTestModeActive = false;
        this.keyMap = [];
        this.userInfo = this.readUserInfo();
        // End of member list
        this.injectCSS("https://ux.mediamarkt.com.tr/MMFrontend/ecomm/scripts/scriptLib/script_lib.min.css");
        this.ListenToLoading();
        this.ListenToLoadingMobile();
        this.ListenMobilePlpLazyLoad();
        this.ListenCarouselSliding();
        this.setTestMode();
        this.unsetTestMode();
        this.setGuiMode();
        this.unsetGuiMode();
        this.overwriteConsoleLog();
        this.KeyState();
        this.CompareArrays();
        this.ActivateGuiMode();
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Mar 21 2022 @ 16:40
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    waitUntilFieldCreated(fieldSelector, waitingDelay = 10 /* time in seconds*/ ) {
        return new Promise((resolve, reject) => {
            let timeout = waitingDelay * 1000;
            let finderWorker = setInterval(() => {
                // console.log("searching field");
                if ($(fieldSelector).length) {
                    clearInterval(finderWorker);
                    resolve(true);
                }
                if (timeout <= 0) {
                    clearInterval(finderWorker);
                    resolve(false);
                }
                timeout -= 10;
            }, 10);
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Sep 22 2022 @ 14:46
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    executeWhenFieldCreated(fieldSelector, callBack, repeat = 0) {
        console.info("controle started");
        let innerRepeat = repeat - 1;
        let finderWorker = setInterval(() => {
            // console.log("searching field");
            if ($(fieldSelector).length) {
                callBack();
            }
            if (innerRepeat === 0) {
                clearInterval(finderWorker);
            }
            if (innerRepeat > 0) {
                innerRepeat--;
            }
        }, 10);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Mar 16 2022 @ 12:25
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    die(msg = "") {
        throw msg != "" ? msg : "dead!!!";
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Mar 21 2022 @ 16:54
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    injectCSS(url) {
        var head = document.getElementsByTagName("head")[0];
        var link = document.createElement("link");
        link.rel = "stylesheet";
        link.type = "text/css";
        link.href = url;
        link.media = "all";
        head.appendChild(link);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Thu Mar 24 2022 @ 08:39
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    injectJS(src) {
        return new Promise(function(resolve, reject) {
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.src = src;
            script.addEventListener("load", resolve);
            script.addEventListener("error", function(e) {
                reject(e.error);
            });
            document.head.appendChild(script);
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Apr 12 2022 @ 15:49
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    injectBrutJS(js_code) {
        return new Promise(function(resolve, reject) {
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.innerHTML = js_code;
            script.addEventListener("load", resolve);
            script.addEventListener("error", function(e) {
                reject(e.error);
            });
            document.head.appendChild(script);
        });
    }

    SetLoadingLayer(status = true) {
        var loadingLayer = $("#loading-wrapper");
        if (status) {
            loadingLayer.css('display', 'flex');
        } else {
            loadingLayer.css('display', 'none');
        }
    }   

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Mar 13 2023 @ 15:49
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    KeyState() {
        // var x = document.createEvent("KeyboardEvent");
        // x.initEvent("onKeyChange", false, false, { keyMap: this.keyMap });
        // x.initCustomEvent('onKeyChange', false, false, { keyMap: this.keyMap });
        let oldKeyMap = []
        jQuery(window).keydown( e => {
            if(!this.keyMap.filter( f => f == e.keyCode).length)
                this.keyMap.push(e.keyCode)
            if(localStorage.debugKeyMap==='true') {
                if(!oldKeyMap.equals(this.keyMap)) {
                    // document.dispatchEvent(x);
                    const myEvent = new CustomEvent("onKeyChange",  { detail: { keyMap: this.keyMap, }, data: { keyMap: this.keyMap, } });
                    document.dispatchEvent(myEvent);
                }
            }
            oldKeyMap = structuredClone(this.keyMap);
        });
        jQuery(window).keyup( e => {
            let pos = this.keyMap.indexOf(e.keyCode);
            if(pos>=0)
                this.keyMap.splice(pos,1);
            if(localStorage.debugKeyMap==='true') {
                // document.dispatchEvent(x);
                const myEvent = new CustomEvent("onKeyChange",  { detail: { keyMap: this.keyMap, }, data: { keyMap: this.keyMap, } });
                document.dispatchEvent(myEvent);
            }
            oldKeyMap = structuredClone(this.keyMap);
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Apr 12 2022 @ 15:49
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    StartDebugger() {
        $(document).on('onKeyChange', () => {
            if(localStorage.debugKeyMap === 'true' || localStorage.debug === 'true') {
                console.info(scriptLib.keyMap);
                if(scriptLib.keyMap.equals([17,112])) { // CTRL + F1
                    debugger
                }
            }
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Apr 12 2022 @ 15:49
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    injectBrutCSS(css_code) {
        return new Promise(function(resolve, reject) {
            css_code = `
            <style>
                ${css_code}
            </style>
            `;
            document.head.insertAdjacentHTML("beforeend", css_code);
            resolve(true);
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Mar 23 2022 @ 09:59
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    ListenToLoading() {
        var x = document.createEvent("MouseEvent");
        x.initEvent("onLoadingStarted");
        var y = document.createEvent("MouseEvent");
        y.initEvent("onLoadingFinished");
        var loadingWin = false;
        setInterval(function() {
            if (
                $("#loading-bar-spinner").length + $("#loading").length > 0 &&
                !loadingWin
            ) {
                loadingWin = true;
                document.dispatchEvent(x);
            }
            if (
                $("#loading-bar-spinner").length + $("#loading").length == 0 &&
                loadingWin
            ) {
                loadingWin = false;
                document.dispatchEvent(y);
            }
        }, 50);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Mar 15 2023 @ 14:28
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    ListenToLoadingMobile() {
        var x = document.createEvent("MouseEvent");
        x.initEvent("onLoadingStarted");
        var y = document.createEvent("MouseEvent");
        y.initEvent("onLoadingFinished");
        var loadingWinVir = false;
        setInterval(function() {
            if (
                $(".mrh-page-overlay-spinner").css('display') === 'block' &&
                !loadingWinVir
            ) {
                loadingWinVir = true;
                document.dispatchEvent(x);
            }
            if (
                $(".mrh-page-overlay-spinner").css('display') === 'none' &&
                loadingWinVir
            ) {
                loadingWinVir = false;
                document.dispatchEvent(y);
            }
        }, 50);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Dec 30 2022 @ 19:32
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    ListenMobilePlpLazyLoad() {
        window.ListenMobilePlpLazyLoadState = false;
        // mrh-endless-scroll-end loading
        var x = document.createEvent("MouseEvent");
        x.initEvent("onPlpLoadNewItemsFinished");
        var y = document.createEvent("MouseEvent");
        y.initEvent("onPlpLoadNewItemsStarted");
        window.lastProductListLength = 0
        setInterval( () => {
            if($('.mrh-endless-scroll-end.loading').length>0) {
                if(!window.ListenMobilePlpLazyLoadState) {
                    document.dispatchEvent(y);
                    window.ListenMobilePlpLazyLoadState = true;
                }
            }
            let currentProdListLength = $('.product-list-container .product-list li').length;
            if(currentProdListLength > lastProductListLength) {
                lastProductListLength = currentProdListLength;
                window.ListenMobilePlpLazyLoadState = false;
                document.dispatchEvent(x);
            }
        },100);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Jan 2 2023 @ 09:12
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    async ListenCarouselSliding() {
        var x = document.createEvent("MouseEvent");
        x.initEvent("onSlideCarousel");
        if(this.isDesktop) {
            if(await this.waitUntilFieldCreated('#homepage-content .product-container .prev')) {
                $('#homepage-content .product-container .prev, #homepage-content .product-container .next').click( () => {
                    setTimeout(()=>{
                        document.dispatchEvent(x);
                    },500);
                });
            }
        }
        else if(this.isMobile || this.isApplication) {
            let fields = '#wrapper-main > div:nth-child(8) > div:nth-child(4) > div > div.swiper-wrapper > div';
            if (await this.waitUntilFieldCreated(fields)) {
                let prevCount;
                const worker = () => {
                    if(prevCount != $(fields).length) {
                        setTimeout(()=>{
                            document.dispatchEvent(x);
                            prevCount = $(fields).length
                        },100);
                    }
                }
                setInterval(worker, 250);
            }
        }
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Mar 23 2022 @ 17:03
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(";");
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == " ") {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Mar 23 2022 @ 17:03
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);
        let expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Wed Apr 13 2022 @ 18:51
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getNextWorkDay(date) {
        let d = new Date(+date);
        let day = d.getDay() || 7;
        d.setDate(d.getDate() + (day > 5 ? 8 - day : 1));
        return d;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Sal Apr 19 2022 @ 14:32
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    async getProductTitle() {
        if (this.isDesktop) {
            if (await this.waitUntilFieldCreated('h1[itemprop="name"]')) {
                return $('h1[itemprop="name"]').text();
            }
        }
        if (this.isMobile || this.isApplication) {
            if (await this.waitUntilFieldCreated(".product-overview-title span")) {
                return $(".product-overview-title span").text();
            }
        }
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Sal Apr 19 2022 @ 14:43
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getProductBrand() {
        return $('meta[itemprop="brand"]').attr("content");
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Sal Apr 19 2022 @ 16:36
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getProductSKU() {
        if(this.isDesktop)
            return $('#product-details span[itemprop="sku"]').text();
        else
            return $('meta[itemprop="sku"]').attr('content').split(':')[1];
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Feb 17 2023 @ 16:36
     *** Developed By Yahya Bulca
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getProductsSKU() {
        var items = [];

        if (scriptLib.isDesktop) {
            $(".products-list > li").each(function(i, item){
                if(!$(item).hasClass("with-contenspot")){
                    items.push($(item).find(".product-wrapper").attr('data-modelnumber'));
                }
            })
        }
        else if(scriptLib.isMobile){
            $(".product-list > li").each(function(i, item){
                items.push($(item).find(".product-teaser-container").attr('data-modelnumber'));
            })
        }

        return items;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Feb 17 2023 @ 16:36
     *** Developed By Yahya Bulca
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
     async getPlpFilter() {
        var filtersJSON = [];

        if (scriptLib.isDesktop) {
            await $(".headline > a").each(async function () {
                if ($(this).html() == "Marka") {
                    var brandItems = $(this).parents("fieldset").find("ul.options > li");

                    filtersJSON.push(
                        {
                            "name": "brand",
                            "operator": "eq",
                            "value": ""
                        }
                    )

                    await brandItems.each(function () {
                        if ($(this).attr("class") == "active") {
                            filtersJSON[0].value += "|" + $(this).find(".facet-text").html().split('<em class')[0].trim()
                        }
                    })
                    if(filtersJSON[0].value)
                    filtersJSON[0].value = filtersJSON[0].value.substring(filtersJSON[0].value.indexOf("|")+1);
                }
            });

            filtersJSON.push({
                "name": "price",
                "operator": "ge",
                "value": $("input.price-from").val()
            });

            filtersJSON.push({
                "name": "price",
                "operator": "le",
                "value": $("input.price-to").val()
            });
        }
        else if (scriptLib.isMobile) {
            $(".mrh-accordion-headline > a").each(function () {
                if ($(this).find("span").html() == "Marka") {
                    var brandItems = $(this).parents(".facettes-container").find(".mrh-accordion-container");

                    filtersJSON.push(
                        {
                            "name": "brand",
                            "operator": "eq",
                            "value": ""
                        }
                    )
                    /*
                    filtersJSON.push(
                        {
                            "name": "others",
                            "operator": "eq",
                            "value": ""
                        }
                    )
                    */
                    brandItems.each(function () {
                        if ($(this).hasClass("selected")) {
                            $(this).find(".mrh-accordion-content > ul").each(function(){
                                if ($(this).find("li input").is(":checked")) {
                                    if($(this).find("li > label").attr('for').startsWith('brand-')===true) {
                                        filtersJSON[0].value += "|" + $(this).find("li > label").html().split('<span class')[0].trim();
                                    } else {
                                        filtersJSON[1].value += "|" + $(this).find("li > label").html().split('<span class')[0].trim();
                                    }
                                }
                            })
                        }
                    })
                    if(filtersJSON[0].value)
                        filtersJSON[0].value = filtersJSON[0].value.substring(filtersJSON[0].value.indexOf("|")+1);
                    // if(filtersJSON[1].value)
                    //     filtersJSON[1].value = filtersJSON[1].value.substring(filtersJSON[1].value.indexOf("|")+1);
                }
            });

            filtersJSON.push({
                "name": "price",
                "operator": "ge",
                "value": $("input.input-lower-value").val()
            });

            filtersJSON.push({
                "name": "price",
                "operator": "le",
                "value": $("input.input-upper-value").val()
            });
        }
        
        return filtersJSON;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Apr 22 2022 @ 09:12
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    runThisFunctionOnlyInTestMode(uuid) {
        let divHtml = `
        <div id="test-popup" class="move-to-right">
            %HTML%
        </div>
        `;
        const showTestPopup = (uuid) => {
            let html = `
				<button id="quit"></button>
				<h3>ScriptLib Test Mode</h3>
				<p>
					If you see this popup that means you are on test mode. Current test UUID is: 
					<span class="uuid-container">${uuid}</span>
				</p>
				<button id="btn-exit-text">Exit Test</button>
			`;
            if($('#test-popup').length) {
                // $("#test-popup").html(html);
            } else {
                divHtml = divHtml.replace('%HTML%',html);
                $("body").append(divHtml);
                $("body #test-popup #quit").click(() => {
                    if ($("#test-popup").hasClass("move-to-left")) {
                        $("#test-popup").removeClass("move-to-left");
                        $("#test-popup").addClass("move-to-right");
                    } else if ($("#test-popup").hasClass("move-to-right")) {
                        $("#test-popup").removeClass("move-to-right");
                        $("#test-popup").addClass("move-to-left");
                    }
                });
                this.waitUntilFieldCreated("body #test-popup #btn-exit-text").then(() => {
                    $("body #test-popup #btn-exit-text").click(() => {
                        localStorage.removeItem("SCRIPT_LIB_TEST_UUID");
                        $("body #test-popup").remove();
                    });
                });
                var mousePosition;
                var offset = [
                    localStorage.getItem("test-popup:x"),
                    localStorage.getItem("test-popup:y"),
                ];
                var isDown = false;

                let div = document.getElementById("test-popup");

                div.style.left = offset[0] + "px";
                div.style.top = offset[1] + "px";

                div.addEventListener(
                    "mousedown",
                    function(e) {
                        isDown = true;
                        offset = [div.offsetLeft - e.clientX, div.offsetTop - e.clientY];
                    },
                    true
                );

                document.addEventListener(
                    "mouseup",
                    function() {
                        isDown = false;
                    },
                    true
                );

                document.addEventListener(
                    "mousemove",
                    function(event) {
                        event.preventDefault();
                        if (isDown) {
                            mousePosition = {
                                x: event.clientX,
                                y: event.clientY,
                            };
                            localStorage.setItem("test-popup:x", mousePosition.x);
                            localStorage.setItem("test-popup:y", mousePosition.y);
                            div.style.left = mousePosition.x + offset[0] + "px";
                            div.style.top = mousePosition.y + offset[1] + "px";
                        }
                    },
                    true
                );
            }
        };
        let currentPageUUID = localStorage.getItem("SCRIPT_LIB_TEST_UUID");
        if (uuid === currentPageUUID) {
            showTestPopup(uuid);
            this.isTestModeActive = true;
            return true;
        }
        return false;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Apr 22 2022 @ 09:43
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    setTestMode() {
        var url_string = window.location.href;
        var url = new URL(url_string);
        var uuid = url.searchParams.get("SCRIPT_LIB_TEST_UUID");
        if (uuid !== null) {
            localStorage.setItem("SCRIPT_LIB_TEST_UUID", uuid);
        }
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Apr 22 2022 @ 10:07
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    unsetTestMode() {
        var url_string = window.location.href;
        var url = new URL(url_string);
        var uuid_end = url.searchParams.get("SCRIPT_LIB_TEST_UUID_END");
        if (uuid_end !== null) {
            localStorage.removeItem("SCRIPT_LIB_TEST_UUID");
        }
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Mar 23 2023 @ 08:52
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    setGuiMode() {
        var url_string = window.location.href;
        var url = new URL(url_string);
        var uuid = url.searchParams.get("SCRIPT_LIB_GUI");
        localStorage.setItem("SCRIPT_LIB_GUI", new Date().getTime());
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Mar 23 2023 @ 08:52
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    unsetGuiMode() {
        var url_string = window.location.href;
        var url = new URL(url_string);
        var uuid_end = url.searchParams.get("SCRIPT_LIB_GUI_END");
        if (uuid_end !== null) {
            localStorage.removeItem("SCRIPT_LIB_GUI");
        }
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Sep 22 2022 @ 14:54
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    overwriteConsoleLog() {
        //https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=0a5376ff-ddc4-44c1-9364-92337a1622b9
        /*
                if (!this.runThisFunctionOnlyInTestMode(
                    "0a5376ff-ddc4-44c1-9364-92337a1622b9"
                ))
                return;
        */
        window.pauseConsoleMessage = new Date().getTime();
        /*
                window.originalConsoleLog = console.info;
                window.newConsoleLog  = function () { // this must be declared as function and not as arrow function cuz ES6 has no 'arguments' keyword
                    for (let i = 0; i < arguments.length; i++) {
                        const currentArg = arguments[i];
                        window.originalConsoleLog(currentArg);
                    }
                }
                console.log = newConsoleLog;
                console.info = newConsoleLog;
        */
        let condition = this.isTestModeActive || localStorage.debug === 'true';
        if (!condition) {
            window.originalConsoleLog = console.info;
            window.newConsoleLog = function() { // this must be declared as function and not as arrow function cuz ES6 has no 'arguments' keyword
                if (window.pauseConsoleMessage + 3000 < new Date().getTime()) { // only log this message once per 3 seconds
                    window.originalConsoleLog(
                        "%cConsole Messages has been disabled. You can see them only in TEST MODE or when debug flag is activated",
                        "background: #222; color: #bada55"
                    );
                    window.pauseConsoleMessage = new Date().getTime();
                }
            }
            console.log = newConsoleLog;
            console.info = newConsoleLog;
        }
    }


    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Mon Mar 13 2023 @ 10:54
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    getCategoryPath() {
        //https://www.mediamarkt.com.tr/?SCRIPT_LIB_TEST_UUID=0a5376ff-ddc4-44c1-9364-92337a1622b9
        /*
                if (!this.runThisFunctionOnlyInTestMode(
                    "0a5376ff-ddc4-44c1-9364-92337a1622b9"
                ))
                return;
        */
        let res = "";
        let myObj;
        if(this.isSearchPage){
            myObj = dataLayer.filter( s => s.pageType && (s.pageType=="Search Results"))[0];
        }
        else if(this.isCategoryPage){
            myObj = dataLayer.filter( s => s.pageType && (s.pageType=="Category"))[0];
        }
        else if(this.isPDP){
            if(this.isDesktop){
                myObj = dataLayer.filter( s => s.pageType && (s.pageType=="Productdetail"))[0];
            }
            else if(this.isMobile){
                myObj = dataLayer.filter( s => s.pageType && (s.pageType=="ProductdetailNew"))[0];
            }
        }
        if(myObj) {
            let zax = Object.keys(myObj).filter( r => r.indexOf("dimension")>= 0)
            res = [myObj.category]
            zax.forEach( it => {
                res.push(myObj[it])
            })
        }
        return res;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jun 27 2022 @ 14:30
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */

    CompareArrays() {
        // Warn if overriding existing method
        if(Array.prototype.equals)
        console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");
        // attach the .equals method to Array's prototype to call it on any array
        Array.prototype.equals = function (array) {
        // if the other array is a falsy value, return
        if (!array)
            return false;
        // if the argument is the same array, we can be sure the contents are same as well
        if(array === this)
            return true;
        // compare lengths - can save a lot of time 
        if (this.length != array.length)
            return false;

        for (var i = 0, l=this.length; i < l; i++) {
            // Check if we have nested arrays
            if (this[i] instanceof Array && array[i] instanceof Array) {
                // recurse into the nested arrays
                if (!this[i].equals(array[i]))
                    return false;       
            }           
            else if (this[i] != array[i]) { 
                // Warning - two different object instances will never be equal: {x:20} != {x:20}
                return false;   
            }           
        }       
        return true;
        }
        // Hide method from for-in loops
        Object.defineProperty(Array.prototype, "equals", {enumerable: false});
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jun 27 2022 @ 14:30
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    async addItemToCart(catEntryId, cat, storeId = 103452, extraParams = "") {
        //////////////////////////
        // get request:
        //////////////////////////
        function httpGet(theUrl) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false); // false for synchronous request
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }
        // var link = "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?storeId="+storeId+"&langId=-14&catEntryId_"+catEntry+"="+catEntry+"&categoryId_"+catEntry+"="+cat+"&quantity_"+catEntry+"=1";
        var link =
            "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?catEntryId=" +
            catEntryId +
            "&categoryId=" +
            cat +
            "&langId=-14&storeId=" +
            storeId +
            "&quantity=1" +
            extraParams;
        //console.info("item added to the cart",link)
        return httpGet(link);
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jan 26 2023 @ 09:54
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
    */
    productsInCart() {
        return dataLayer.filter(a=>a.event=="EECcheckout")[0].ecommerce.checkout.products;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jul 04 2022 @ 14:53
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    productsInCartCount() {
        /*
        let rest = await this.waitUntilFieldCreated(".ctable-wrapper table.ctable");
        if (rest) {
            return $('.ctable-wrapper table.ctable tbody[product="product"]').length;
        }
        return null;
        */
        return this.productsInCart().length
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jan 26 2023 @ 09:58
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2023 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
    */
    productsPurchased() { // Thankyou Page
        return dataLayer.filter(a=>a.event=='EECpurchase')[0].ecommerce.purchase.products;
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Fri Jul 07 2022 @ 16:28
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */
    API_getProductPrice(sku) {
        return new Promise((resolve) => {
            let metaPath = "product:price:amount";
            if (scriptLib.isMobile) {
                // change to desktop version
                scriptLib.setCookie("MC_DEVICE_ID", "-1", 125);
            }
            fetch(`https://www.mediamarkt.com.tr/catentry/${sku}`).then(
                async(res) => {
                    if (scriptLib.isMobile) {
                        // return back to mobile version
                        scriptLib.setCookie("MC_DEVICE_ID", "-11", 125);
                    }
                    let pdpPageHtml = $(await res.text());
                    pdpPageHtml.each((i, element) => {
                        element = $(element);
                        if (element[0].nodeName == "META") {
                            if (element.attr("property") == metaPath) {
                                let price = element.attr("content");
                                resolve(price);
                            }
                        }
                    });
                    resolve(undefined);
                }
            );
        });
    }

    /***********************************************************************************************************************************
     ************************************************************************************************************************************
     *** Created on Tue Nov 01 2022 @ 13:13
     *** Developed By Mohamed Elleuch
     *** Copyright (c) 2022 - MIT
     ************************************************************************************************************************************
     ************************************************************************************************************************************
     */

    GtmDispatchEvent(eventName, objectClassName, objectId, object) {
        dataLayer.push({
            "event": eventName,
            "gtm.element": {
                "jQuery111306991843893108853": 236,
                "sizzle1666354906431": {
                    "parentNode": [
                        4411,
                        122,
                        false
                    ]
                }
            },
            "gtm.elementClasses": objectClassName,
            "gtm.elementId": objectId,
            "gtm.elementTarget": "",
            "gtm.elementUrl": "",
            "gtm.uniqueEventId": new Date().getTime(),
            ...object
        })
    }

    AreWeInThisPeriod = (a, b) => {
        let d = new Date();
        let c1 = d > new Date(a);
        let c2 = d < new Date(b);
        let c3 = c1 && c2;
        return c3;
    }



    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Tue Mar 16 2023 @ 17:29
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    Sleep(ms)
    {
        return(
            new Promise(function(resolve, reject)
            {
                setTimeout(function() { resolve(); }, ms);
            })
        );
    }




    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Tue Mar 20 2023 @ 11:38
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    ActivateGuiMode() {
        return;
        if(localStorage.SCRIPT_LIB_GUI===undefined) return;
        let html = `
        <div id="gui-editor">
            <h3>ScriptLib GUI Editor</h3>
            <p id="sabboura">
                
            </p>
            <button id="btn-exit-text">Exit Test</button>
        </div>
        <div id="overlay-blurry"></div>
        `;
        $("body #gui-editor #quit").click(() => {
            if ($("#gui-editor").hasClass("move-to-left")) {
                $("#gui-editor").removeClass("move-to-left");
                $("#gui-editor").addClass("move-to-right");
            } else if ($("#gui-editor").hasClass("move-to-right")) {
                $("#gui-editor").removeClass("move-to-right");
                $("#gui-editor").addClass("move-to-left");
            }
        });
        this.waitUntilFieldCreated("body #gui-editor #btn-exit-text").then(() => {
            $("body #gui-editor #btn-exit-text").click(() => {
                localStorage.removeItem("SCRIPT_LIB_GUI");
                $("body #gui-editor").remove();
            });
        });
        if($('#gui-editor').length==0) {
            $('body').append(html);
        }
        let k = this.keyMap;
        document.body.addEventListener("mousemove", function(e) {
            if(k.equals([17])) {
                $('#overlay-blurry').show();
                return;
            } else {
                $('#overlay-blurry').hide();
            }
    		let x=e.clientX;
    		let y=e.clientY;
            if(y<window.innerHeight*0.3) {
                $("body #gui-editor").addClass('louta');
            }
            else if(y>window.innerHeight*0.6) {
                $("body #gui-editor").removeClass('louta');
            }
    		let cursor=`
            <strong>Mouse Position Is :</strong> ${x} and ${y}<br>
            <u style="color:red;font-weight: 700;">Current Element:</u><br>
            <strong>Tagname:</strong> ${window.current.tagName.toLowerCase()}<br>
            <strong>ID:</strong> ${window.current.id}<br>
            <strong>Class:</strong> ${window.current.getAttribute('class')}<br>
            `;
    		document.getElementById("sabboura").innerHTML=cursor
        })
        document.body.addEventListener("mouseover", function(e) {
            e.stopPropagation();
            e.preventDefault();
            e.target.addEventListener("mouseout", function (e) {
                e.target.className = e.target.className.replace(new RegExp(" highlight\\b", "g"), "");
                window.current = e.target;
            });
            e.target.className += " highlight";
        });
        this.injectBrutCSS(`.highlight { outline: 4px solid #07C; transition: all 400ms; background-color: #0077cc3b; }`);
        // this.StopAllEvents();
        /*
        let stop = setInterval(this.StopAllEvents, 750);
        $(window).load(function () {
            setTimeout( () => clearInterval(stop),3000);
          });
        */
        document.body.addEventListener("click", function(e) {
            e.stopPropagation();
            $(e.target).off();
            console.warn(e.target);
        });
    }



    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Tue Mar 20 2023 @ 16:16
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    StopAllEvents() {
        $("a").click(function(e) { e.preventDefault(); e.stopPropagation(); });
        $("button").click(function(e) { e.preventDefault(); e.stopPropagation(); });
        $("div").click(function(e) { e.preventDefault(); e.stopPropagation(); });
        $("span").click(function(e) { e.preventDefault(); e.stopPropagation(); });
    }




    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Tue Mar 28 2023 @ 10:55
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    limitExecutionByTime(time) {
        let t1 = new Date().getTime();
        if(typeof(t0)==='undefined') {
            window.t0 = t1;
            return false; // executed first time ... not limited
        } else {
            if(t1-window.t0>=time) {
                window.t0 = t1;
                return false; // period bigger than time passed ... not limited
            } else {
                return true; // period less than time passed ... limited
            }
        }
    }




    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Wed Mar 29 2023 @ 09:32
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    SendEvent(eventName, eventData=null) {
        const myEvent = new CustomEvent(eventName,  eventData);
        document.dispatchEvent(myEvent);
    }




    /***********************************************************************************************************************************
     ************************************************************************************************************************************
    *** Created on Thu Apr 04 2023 @ 12:54
    *** Developed By Mohamed Elleuch
    *** Copyright (c) 2023 - MIT
    ************************************************************************************************************************************
    ************************************************************************************************************************************
    */
    readUserInfo() {
        return {

                    timeOpened:new Date(),
                    timezone:(new Date()).getTimezoneOffset()/60,
                
                    pageon(){return window.location.pathname},
                    referrer(){return document.referrer},
                    previousSites(){return history.length},
                
                    browserName(){return navigator.appName},
                    browserEngine(){return navigator.product},
                    browserVersion1a(){return navigator.appVersion},
                    browserVersion1b(){return navigator.userAgent},
                    browserLanguage(){return navigator.language},
                    browserOnline(){return navigator.onLine},
                    browserPlatform(){return navigator.platform},
                    javaEnabled(){return navigator.javaEnabled()},
                    dataCookiesEnabled(){return navigator.cookieEnabled},
                    dataCookies1(){return document.cookie},
                    dataCookies2(){return decodeURIComponent(document.cookie.split(";"))},
                    dataStorage(){return localStorage},
                
                    sizeScreenW(){return screen.width},
                    sizeScreenH(){return screen.height},
                    sizeDocW(){return document.width},
                    sizeDocH(){return document.height},
                    sizeInW(){return innerWidth},
                    sizeInH(){return innerHeight},
                    sizeAvailW(){return screen.availWidth},
                    sizeAvailH(){return screen.availHeight},
                    scrColorDepth(){return screen.colorDepth},
                    scrPixelDepth(){return screen.pixelDepth},
                
                /*
                    latitude(){return position.coords.latitude},
                    longitude(){return position.coords.longitude},
                    accuracy(){return position.coords.accuracy},
                    altitude(){return position.coords.altitude},
                    altitudeAccuracy(){return position.coords.altitudeAccuracy},
                    heading(){return position.coords.heading},
                    speed(){return position.coords.speed},
                    timestamp(){return position.timestamp},
                */
        
            };
    }
}
window.scriptLib = new ScriptLib();



/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Mar 8 2022 @ 11:00
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */

 window.blockFakeEmails = (text) => {
    const regex = /(\.{2,}|-{2,}|(\+\d*))/gm;
    const subst = ``;
    const result = text.replace(regex, subst);

    return result;
};

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Mar 16 2022 @ 15:37
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
if (
    window.location.pathname ===
    "/webapp/wcs/stores/servlet/MultiChannelOrderSummary"
) {
    let failed = 0;
    let timerHandler = setInterval(() => {
        if ($(".delivery-type-container .panel.panel-default").length > 0) {
            clearInterval(timerHandler);
            $(".delivery-type-container .panel.panel-default").after(`
				<div class="form-group pickup-message-container">
					<a href="#/checkout/summary/delivery-address" ng-if="pickupData.selected" class="pickup-message-link edit-location-link ng-scope" ng-click="openPickupModal(); $event.stopPropagation(); $event.preventDefault();">
						<p class="pickup-message-title user-address-title ng-binding">Mağazadan Teslim Al</p>
						<p class="pickup-message-paragraph">Ürününüzü mağazadan teslim almak ister misiniz?</p>
					</a>
				</div>
			`);
            $(".form-group .pickup-message-link").click(() => {
                setTimeout(() => {
                    $(
                        '.panel-pickup span.accordion-state-indicator[ng-click="toggleOpen()"]'
                    ).trigger("click");
                    setTimeout(() => {
                        $(".panel-title a.edit-location-link.ng-scope").trigger("click");
                    }, 400);
                }, 700);
            });
        } else {
            if (failed >= 100) {
                clearInterval(timerHandler);
            }
            failed++;
        }
    }, 200);
}

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Mar 21 2022 @ 17:02
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
if (
    window.location.pathname.indexOf(
        "/webapp/wcs/stores/servlet/MultiChannelDisplayBasket"
    ) === 0
) {
    let searchParams = new URLSearchParams(window.location.search);

    if (searchParams.has("returnCode")) {
        var ids = searchParams.get("returnCode").split("l");
        var catId = ids[0];
        var catEntry = ids[1];

        // test link
        // https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14&returnCode=797527l7788401

        var uri = `/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?storeId=103452&langId=-14&catEntryId=${catEntry}&categoryId=${catId}`;

        var a =
            '<a href="#" class="button add-to-cart dr" data-href="' + uri + '"></a>';

        $("body").append(a);

        setTimeout(function() {
            $(".add-to-cart.dr").trigger("click");
            setTimeout(() => {
                window.location.href = `https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14`;
            }, 500);
        }, 10);
    }
}

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Mar 22 2022 @ 13:47
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
if (
    window.location.pathname.indexOf(
        "/webapp/wcs/stores/servlet/MultiChannelOrderSummary"
    ) === 0
) {
    $(window).ready(() => {
        //$('.ctable-wrapper .ctable .cart-product-table .single-services-table .cservice .cservice-table .c-header.th-title .cservice-header').each((i, e) => e.click());
    });
}

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Mar 23 2022 @ 13:20
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
document.addEventListener("onLoadingFinished", function() {
    let intVar;
    //setTimeout(() => {
    //	$('.ctable-wrapper .ctable .cart-product-table .single-services-table .cservice .cservice-table .c-header.th-title .cservice-header').each((i, e) => e.click());
    //}, 500);
    const CheckIfFieldsAreClosed = async() => {
        if (
            (await scriptLib.waitUntilFieldCreated(
                    ".ctable-wrapper .ctable .cart-product-table .single-services-table .cservice"
                ),
                20)
        ) {
            clearInterval(intVar);
            return;
        }
        var classList = $(
                ".ctable-wrapper .ctable .cart-product-table .single-services-table .cservice"
            )
            .attr("class")
            .split(/\s+/);
        let state = true;
        $.each(classList, function(index, item) {
            // debugger
            if (item === "expanded") {
                state = false;
            }
        });
        return state;
    };
    intVar = setInterval(() => {
        if (CheckIfFieldsAreClosed()) {
            $(
                ".ctable-wrapper .ctable .cart-product-table .single-services-table .cservice .cservice-table .c-header.th-title .cservice-header"
            ).each((i, e) => e.click());
        } else {
            clearInterval(intVar);
        }
    }, 500);
});

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Apr 06 2022 @ 13:35
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
$(window).ready(() => {
    if (scriptLib.isMobile || !scriptLib.isPDP) {
        return; // this should not be executed on mobile
    }

    console.info("store delivery desktop started.");
    scriptLib
        .waitUntilFieldCreated(".box.infobox.availability ul")
        .then((res) => {
            $(".box.infobox.availability ul").append(
                '<li class="stock-info"><a data-type="link" href="#" class="stok-bilgisi">Mağaza Stok Durumu</a></li>'
            );
        });
    scriptLib
        .waitUntilFieldCreated("#product-details > div.price-sidebar .price-button")
        .then((res) => {
            if (!res) {
                // throw "Add To Card button was not found!!!";
            }
            $("#product-details > div.price-sidebar .price-button").after(
                '<div class="store-delivery button-green-pdp"><a href="#">Mağazadan Teslim Al</a></div>'
            );

            $(".store-delivery , .stok-bilgisi").click(function(evt) {
                console.info("link clicked");
                if ($(".stock-mdl").length && false) {
                    // always refresh iframe content
                    $(".stock-mdl").show();
                } else {
                    var sku = $("[itemprop='sku']").attr("content") || "";
                    sku = sku.replace("sku:", "");
                    var uri =
                        "https://ux.mediamarkt.com.tr/store-delivery/index.html?id=" + sku;
                    if ($(evt.target).attr("data-type") === "link") {
                        uri =
                            "https://ux.mediamarkt.com.tr/stok-takip/index.html?id=" + sku;
                    }
                    var clsIcon =
                        '<svg class="stock-cls-icn" width="32px" height="32px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="close"><rect width="24" height="24" transform="rotate(180 12 12)" opacity="0"></rect><path d="M13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29-4.3 4.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l4.29-4.3 4.29 4.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path></g></g></svg>';
                    var iframe =
                        ' <div style="display:flex;" class="stock-mdl"><div>' +
                        clsIcon +
                        '<iframe src="' +
                        uri +
                        '" title="Stok Durumu Görüntüle"></iframe></div></div>';
                    $("body").append(iframe);

                    setTimeout(() => {
                        $("#cboxOverlay").hide();

                        $(".stock-cls-icn").click(function() {
                            $(".stock-mdl").hide();
                            $(".stock-mdl").remove();
                            $("#cboxOverlay").hide();
                        });
                    }, 100);
                }
            });
        });

    /***********************************************************************************************************************************/

    if (window.addEventListener) {
        window.addEventListener("message", handleIFrameEvent, false);
    } else if (window.attachEvent) {
        window.attachEvent("onmessage", handleIFrameEvent, false);
    }
    //window.addEventListener("message", handleIFrameEvent, false);

    async function handleIFrameEvent(e) {
        let evtName = e.data.func;
        // console.info(e);
        if (evtName !== "callSetPickupStore") {
            return;
        }
        if (e.origin === "https://ux.mediamarkt.com.tr") {
            let store_id = e.data.store_id;
            var urlStr = $("#hidden-pdp-add-to-cart").attr("data-href");
            // here new func**************************************
            urlStr = urlStr.replace(/_\d*/gm, "");
            const catEntryIdArray = RegExMatchAll(urlStr, /catEntryId=\d*/gm);
            const categoryIdArray = RegExMatchAll(urlStr, /categoryId=\d*/gm);
            console.info("add item to cart", catEntryIdArray, categoryIdArray);
            await CartAddItem(
                catEntryIdArray[0].split("=")[1],
                categoryIdArray[0].split("=")[1]
            );
            await SetPickupStore(store_id);
            setTimeout(function() {
                window.location.href =
                    "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14";
            }, 1500);
        } else {
            throw "unknown origin";
        }
    }

    async function SetPickupStore(pickupStoreId) {
        // 129953
        // 33361
        // orderId = await GetOrderId();
        orderId = pickupStoreId;
        // console.info(pickupStoreId,orderId);
        await fetch(
            "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelOrderSummaryController", {
                headers: {
                    accept: "application/json",
                    "accept-language": "tr,en;q=0.9,en-GB;q=0.8,en-US;q=0.7",
                    "content-type": "application/x-www-form-urlencoded",
                    "sec-ch-ua": '" Not A;Brand";v="99", "Chromium";v="98", "Microsoft Edge";v="98"',
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": '"Windows"',
                    "sec-fetch-dest": "empty",
                    "sec-fetch-mode": "cors",
                    "sec-fetch-site": "same-origin",
                    "x-requested-with": "XMLHttpRequest",
                },
                referrer: "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelOrderSummary?storeId=103452&orderId=" +
                    orderId +
                    "&langId=-14&rememberMe=true",
                referrerPolicy: "strict-origin-when-cross-origin",
                body: "storeId=103452&langId=-14&orderId=" +
                    orderId +
                    "&pickUpStoreId=" +
                    pickupStoreId +
                    "&pickUpStopGo=false&method=marketSelected",
                method: "POST",
                mode: "cors",
                credentials: "include",
            }
        );
    }

    async function GetOrderId() {
        res = await fetch(
            "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14"
        );
        var html = await res.text();
        html = $(html);
        let link = $(html)
            .find(
                "#js-cart-app > div.cobuttons.cobuttons-cart > div > .cocheckout-actions > a"
            )
            .attr("href");
        var url = new URL(link);
        var orderId = url.searchParams.get("orderId");
        return orderId;
    }

    function RegExMatchAll(str, regex) {
        let arrMatch = [];
        while ((m = regex.exec(str)) !== null) {
            // This is necessary to avoid infinite loops with zero-width matches
            if (m.index === regex.lastIndex) {
                regex.lastIndex++;
            }
            // The result can be accessed through the `m`-variable.
            m.forEach((match, groupIndex) => {
                // console.log(`Found match, group ${groupIndex}: ${match}`);
                arrMatch.push(match);
            });
        }
        return arrMatch;
    }

    //////////////////////////
    // add item to cart:
    //////////////////////////

    //call example: CartAddItem(7669647,797524) : asus computer

    function CartAddItem(catEntryId, cat, storeId = 103452, extraParams = "") {
        // var link = "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?storeId="+storeId+"&langId=-14&catEntryId_"+catEntry+"="+catEntry+"&categoryId_"+catEntry+"="+cat+"&quantity_"+catEntry+"=1";
        var link =
            "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?catEntryId=" +
            catEntryId +
            "&categoryId=" +
            cat +
            "&langId=-14&storeId=" +
            storeId +
            "&quantity=1" +
            extraParams;
        //console.info("item added to the cart",link)
        return httpGet(link);
    }

    //////////////////////////
    // get request:
    //////////////////////////

    function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################

    async function GetFullStoreList() {
        let res = await fetch(
            "https://ux.mediamarkt.com.tr/store-delivery/stores-list.json"
        );
        let data = res.json();
        return data;
    }

    async function GetFullStoreList_old() {
        //debugger
        res = await fetch("https://www.mediamarkt.com.tr/tr/marketselection.html");
        var html = await res.text();
        html = $(html);
        let attr = "href";
        let nodeListStores = $(html).find(".all-markets-list li a");
        if ((nodeListStores.length = 0)) {
            nodeListStores = $(html).find("#dropdown-market-list option");
            attr = "data-link";
        }
        let listStores = [];
        nodeListStores.each((index, element) => {
            element = $(element);
            let text = element.text();
            var storeId = element
                .attr(attr)
                .split("/")[element.attr("href").split("/").length - 1].split(",")[1];
            let city = text.split("|")[0]; //.replaceAll(' ','');
            let store = text.split("|")[1];
            //store && (store = store.replaceAll(' ',''));
            listStores.push(
                JSON.parse(`
				{
					"city": "${city}",
					"store": "${store}",
					"storeId": "${storeId}"
				}
			`)
            );
        });
        return listStores;
    }

    async function GetStoreId(wantedStoreName) {
        let list = await GetFullStoreList();
        let res = list.filter((item) => {
            return (
                wantedStoreName.indexOf(item.city) > -1 &&
                wantedStoreName.indexOf(item.store) > -1
            );
        });
        if (res.length === 1) {
            return res[0];
        } else {
            throw "more than store where found";
        }
    }

    const onNotificationFromIframe = async(store_name) => {
        let store = await GetStoreId(store_name);
        let store_id = store.storeId;
        let res = await SetPickupStore(store_id);
        console.info(store_id);
    };
});

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Apr 08 2022 @ 16:03
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
$(window).ready(() => {
    if (scriptLib.isDesktop) {
        return; // this should not be executed on desktop
    }

    console.info("store delivery mobile started.");
    $(".gridbox.column-1-1.buyback").length &&
        $(".gridbox.column-1-1.buyback").after(
            '<div class="gridbox column-1-1 store-delivery-mobile"><a href="#">Mağazadan Teslim Al</a></div>'
        );
    $(".gridbox.column-1-1.buyback").length ||
        $("#add-to-basket-buttons").after(
            '<div class="gridbox column-1-1 store-delivery-mobile"><a href="#">Mağazadan Teslim Al</a></div>'
        );

    $(".store-delivery-mobile").click(function() {
        console.info("link clicked");
        //if($('.stock-mdl').length) {
        //    $('.stock-mdl').show();
        //} else
        {
            var sku = $("[itemprop='sku']").attr("content") || "";
            sku = sku.replace("sku:", "");
            var uri =
                "https://ux.mediamarkt.com.tr/store-delivery/index.html?id=" + sku;
            var clsIcon =
                '<svg class="stock-cls-icn" width="32px" height="32px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="close"><rect width="24" height="24" transform="rotate(180 12 12)" opacity="0"></rect><path d="M13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29-4.3 4.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l4.29-4.3 4.29 4.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z"></path></g></g></svg>';
            var iframe =
                ' <div class="stock-mdl"><div>' +
                clsIcon +
                '<iframe src="' +
                uri +
                '" title="Stok Durumu Görüntüle"></iframe></div></div>';
            $("body").append(iframe);
            setTimeout(() => {
                $("#cboxOverlay").hide();
            }, 100);
        }
    });

    $(".stock-cls-icn").click(function() {
        $(".stock-mdl").hide();
        $("#cboxOverlay").hide();
    });

    /*****************************************************************************************************/

    if (window.addEventListener) {
        window.addEventListener("message", handleIFrameEvent, false);
    } else if (window.attachEvent) {
        window.attachEvent("onmessage", handleIFrameEvent, false);
    }
    //window.addEventListener("message", handleIFrameEvent, false);

    async function handleIFrameEvent(e) {
        let evtName = e.data.func;
        // console.info(e);
        if (evtName !== "callSetPickupStore") {
            return;
        }
        if (e.origin === "https://ux.mediamarkt.com.tr") {
            let store_id = e.data.store_id;
            var urlStr = $("#addToBasket").attr("data-request-url");
            // here new func**************************************
            urlStr = urlStr.replace(/_\d*/gm, "");
            const catEntryIdArray = RegExMatchAll(urlStr, /catEntryId=\d*/gm);
            const categoryIdArray = RegExMatchAll(urlStr, /categoryId=\d*/gm);
            console.info("add item to cart", catEntryIdArray, categoryIdArray);
            await CartAddItem(
                catEntryIdArray[0].split("=")[1],
                categoryIdArray[0].split("=")[1]
            );
            await SetPickupStoreMobile(store_id);
            setTimeout(function() {
                window.location.href =
                    "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14";
            }, 1500);
        } else {
            throw "unknown origin";
        }
    }

    async function SetPickupStoreMobile(pickupStoreId) {
        // 129953
        // 33361
        let orderId = await GetOrderIdMobile();

        await fetch(
            "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelOrderSummaryController?storeId=103452&orderId=" +
            orderId +
            "&langId=-14", {
                headers: {
                    accept: "application/json, text/plain, */*",
                    "accept-language": "en-US,en;q=0.9,tr;q=0.8,de-DE;q=0.7,de;q=0.6",
                    "content-type": "application/x-www-form-urlencoded",
                    "sec-fetch-dest": "empty",
                    "sec-fetch-mode": "cors",
                    "sec-fetch-site": "same-origin",
                },
                referrer: "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelOrderSummary?storeId=103452&orderId=" +
                    orderId +
                    "&langId=-14&rememberMe=true",
                referrerPolicy: "strict-origin-when-cross-origin",
                body: "method=saveDeliveryData&pickUpStoreId=" +
                    pickupStoreId +
                    "&shipModeId=-136002&value=PICKUP",
                method: "POST",
                mode: "cors",
                credentials: "include",
            }
        );
    }

    async function GetOrderIdMobile() {
        res = await fetch(
            "https://www.mediamarkt.com.tr/webapp/wcs/stores/servlet/MultiChannelDisplayBasket?storeId=103452&langId=-14"
        );
        var html = await res.text();
        html = $(html);
        let link = $(html)
            .find(
                "#wrapper-main section.bg-white.total-price-container > form.proceed-to-checkout"
            )
            .attr("action");
        html.each((i, el) => {
            if (el.getAttribute && el.getAttribute("id") === "wrapper-main") {
                link ||
                    (link = el
                        .querySelector(
                            "section.bg-white.total-price-container > form.proceed-to-checkout"
                        )
                        .getAttribute("action"));
            }
        });
        var url = new URL(link);
        var orderId = url.searchParams.get("orderId");
        return orderId;
    }

    function RegExMatchAll(str, regex) {
        let arrMatch = [];
        while ((m = regex.exec(str)) !== null) {
            // This is necessary to avoid infinite loops with zero-width matches
            if (m.index === regex.lastIndex) {
                regex.lastIndex++;
            }
            // The result can be accessed through the `m`-variable.
            m.forEach((match, groupIndex) => {
                // console.log(`Found match, group ${groupIndex}: ${match}`);
                arrMatch.push(match);
            });
        }
        return arrMatch;
    }

    //////////////////////////
    // add item to cart:
    //////////////////////////

    //call example: CartAddItem(7669647,797524) : asus computer

    function CartAddItem(catEntryId, cat, storeId = 103452, extraParams = "") {
        // var link = "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?storeId="+storeId+"&langId=-14&catEntryId_"+catEntry+"="+catEntry+"&categoryId_"+catEntry+"="+cat+"&quantity_"+catEntry+"=1";
        var link =
            "/webapp/wcs/stores/servlet/MultiChannelOrderCatalogEntryAdd?catEntryId=" +
            catEntryId +
            "&categoryId=" +
            cat +
            "&langId=-14&storeId=" +
            storeId +
            "&quantity=1" +
            extraParams;
        //console.info("item added to the cart",link)
        return httpGet(link);
    }

    //////////////////////////
    // get request:
    //////////////////////////

    function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################
    //##################################################################################

    async function GetFullStoreList() {
        let res = await fetch(
            "https://ux.mediamarkt.com.tr/store-delivery/stores-list.json"
        );
        let data = res.json();
        return data;
    }

    async function GetFullStoreList_old() {
        //debugger
        res = await fetch("https://www.mediamarkt.com.tr/tr/marketselection.html");
        var html = await res.text();
        html = $(html);
        let attr = "href";
        let nodeListStores = $(html).find(".all-markets-list li a");
        if ((nodeListStores.length = 0)) {
            nodeListStores = $(html).find("#dropdown-market-list option");
            attr = "data-link";
        }
        let listStores = [];
        nodeListStores.each((index, element) => {
            element = $(element);
            let text = element.text();
            var storeId = element
                .attr(attr)
                .split("/")[element.attr("href").split("/").length - 1].split(",")[1];
            let city = text.split("|")[0]; //.replaceAll(' ','');
            let store = text.split("|")[1];
            //store && (store = store.replaceAll(' ',''));
            listStores.push(
                JSON.parse(`
				{
					"city": "${city}",
					"store": "${store}",
					"storeId": "${storeId}"
				}
			`)
            );
        });
        return listStores;
    }

    async function GetStoreId(wantedStoreName) {
        let list = await GetFullStoreList();
        let res = list.filter((item) => {
            return (
                wantedStoreName.indexOf(item.city) > -1 &&
                wantedStoreName.indexOf(item.store) > -1
            );
        });
        if (res.length === 1) {
            return res[0];
        } else {
            throw "more than store where found";
        }
    }

    const onNotificationFromIframe = async(store_name) => {
        let store = await GetStoreId(store_name);
        let store_id = store.storeId;
        let res = await SetPickupStore(store_id);
        console.info(store_id);
    };
});

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Apr 12 2022 @ 13:42
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */
$(window).ready(() => {
    if (scriptLib.isPDP) {
        if (scriptLib.isDesktop) {
            if ($('h1[itemprop="name"]').text().indexOf("PHILIPS") >= 0) {
                scriptLib.injectJS(
                    "https://tracking.channelsight.com/api/tracking/v2/Init"
                );
            }
        } else if (scriptLib.isMobile) {
            if ($(".product-overview-title span").text().indexOf("PHILIPS") >= 0) {
                scriptLib.injectJS(
                    "https://tracking.channelsight.com/api/tracking/v2/Init"
                );
            }
        } else { // case of mobile app
            if ($(".product-overview-title span").text().indexOf("PHILIPS") >= 0) {
                scriptLib.injectJS(
                    "https://tracking.channelsight.com/api/tracking/v2/Init"
                );
            }
        }
    }

    if (scriptLib.isThankyouPage) {
        let data = [];
        $(".checkout-container .co-product").each((x, i) => {
            let sku = $(i).attr("data-reco-pid");
            let title = $(i).find(".product-title").text();
            if (title.indexOf("PHILIPS") == -1) return;
            let price_qnty = $(i).find(".product-amount").text();
            let price = 0; //price_qnty.split(' : ')[0];
            let qnty = price_qnty.split(" : ")[1];
            data.push({
                Name: title,
                ProductCode: sku,
                Category: "####",
                Price: price,
                Quantity: parseInt(qnty),
            });
        });
        let code = `
		ChannelSight_Type = "OrderTracking"; ChannelSight_Separator = ".";
		var CS_Products = ${JSON.stringify(data)};
		varCS_Order = {Currency:"TRY"};
		`;
        scriptLib.injectBrutJS(code);
        scriptLib.injectJS(
            "https://tracking.channelsight.com/api/tracking/v2/Init"
        );
    }
});

/***********************************************************************************************************************************
 ************************************************************************************************************************************
 *** Created on Tue Apr 14 2022 @ 15:44
 *** Developed By Mohamed Elleuch
 *** Copyright (c) 2022 - MIT
 ************************************************************************************************************************************
 ************************************************************************************************************************************
 */

$(window).on('onWaitingForFictionsStart', () => {

scriptLibFunctions.testModeFunction()

scriptLibFunctions.LoadingForWawlabs()

scriptLibFunctions.processNewDeviceRequest()

scriptLibFunctions.setKargoExpectedDate()

scriptLibFunctions.iphone14BasketpagesetCargoDate()

scriptLibFunctions.iphone14ListPagesetCargoDate()

scriptLibFunctions.iphone14BasketNextPagesetCargoDate()

scriptLibFunctions.removeiPhone14infoBadge()

scriptLibFunctions.showIphoneWarning()

scriptLibFunctions.manageAssistBox()

scriptLibFunctions.setKargoMessageInPDP()

scriptLibFunctions.removePickupStoreBtnForOutletProducts()

scriptLibFunctions.swogoForCategoryAndSearchPages()

scriptLibFunctions.SwogoHeroPDP()

scriptLibFunctions.loadTvSliderFiles()

scriptLibFunctions.changeMoreClickableLink()

scriptLibFunctions.setTabMenuPDP()

scriptLibFunctions.addPlus90()

scriptLibFunctions.add13IsGunu()

scriptLibFunctions.addRcmContent()

scriptLibFunctions.NewBasketPage()

scriptLibFunctions.SwogoForBasketPaage()

scriptLibFunctions.fixMarginOnBaristaPage()

scriptLibFunctions.outletPageCategories()

scriptLibFunctions.ShareButtonsOnPDP()

scriptLibFunctions.newCategoryUX()

scriptLibFunctions.newRegisterUX()

scriptLibFunctions.digitalCards()

scriptLibFunctions.priceForWeb()

scriptLibFunctions.installationDetails()

scriptLibFunctions.deleteExtraPriceonMobileCampaign()

scriptLibFunctions.FixPDP_Price()

scriptLibFunctions.FixPDP_FavoriButtons()

scriptLibFunctions.ExtraCategoriesRemover()

scriptLibFunctions.installmentScroll()

scriptLibFunctions.fixMobileBannerMargin()

scriptLibFunctions.pdpPopupSwogo()

scriptLibFunctions.fixMobileCategory_Jira_TURFREND_11()

scriptLibFunctions.fixMobilePopupLiElement()

scriptLibFunctions.fixInfoPopupPDP()

scriptLibFunctions.HideSuggestionsForWawlabs()

scriptLibFunctions.fixTopbarWelcomeMessage()

scriptLibFunctions.GTM_Event_AddToCart()

scriptLibFunctions.CriteoIntegration()

scriptLibFunctions.corporateSales()

scriptLibFunctions.Buyback()

scriptLibFunctions.setKargoFreeFor250TlAbove()

scriptLibFunctions.newHomeCarousel()

scriptLibFunctions.newEmptyContent()

scriptLibFunctions.newQuaranteeAndServices()

scriptLibFunctions.BasarsoftNewAddressImplementation()

scriptLibFunctions.newCheckoutLogin()

scriptLibFunctions.newLoginUX()

scriptLibFunctions.AfetYardim()

scriptLibFunctions.refurbishedPhone()

scriptLibFunctions.iphone14PdpCargoDate()

scriptLibFunctions.ankastreSetlerLP()

scriptLibFunctions.AboveFooterAreaForInsider()

scriptLibFunctions.newMobileBreadcrumb()

scriptLibFunctions.havaleEftQR()

scriptLibFunctions.omnichannelServicesProject()


/*
scriptLib measure performace
*/
if(window.localStorage.debug==='true') {
    window.scriptLibEndTime = new Date().getTime();
    console.warn("SCRIPT LIB END EXECUTION TIME: ", scriptLibEndTime);
    console.warn("SCRIPT LIB TOOK SYNCHRONOUSLY: ", scriptLibEndTime - scriptLibStartTime, "MILLISECONDS");
}

})

window.scriptLibFunctions = new ScriptLibFunctions();

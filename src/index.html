<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScriptLib Code Editor!</title>
	<script type="text/javascript" src="lib/sweetalert2.all.min.js"></script>
	<script type="text/javascript" src="lib/jquery.js"></script>
	<script type="text/javascript" src="lib/codemirror.js" ></script>
	<script defer type="text/javascript" src="script.js" ></script>
	<script defer type="text/javascript" src="terminal.js" ></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Gugi&display=swap" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="./index.css" />

	<script type="text/javascript">
      
        //sourceCode = atob(`###_ENCRYPTED_BASE64_DATA_###`);
        let startPosition;// = data.indexOf("class ScriptLibFunctions {");
		function onEditorInput(e) {
			// debugger
			if(window.methodsObject) {
			window.openedMethodId && (methodsObject.methodList[openedMethodId].body = view.state.doc.toString());
			}
			window.onEditorInput = onEditorInput;

		}
	</script>
</head>
<body>
	<div id="main-container">
		<div id="left-side">
			<input id="searchInput" type="search" onkeyup="searchFicion()" onclick="setTimeout(searchFicion,100)" placeholder="&#xF002; Search" style="font-family:Arial, FontAwesome">
			<ul id="fiction-list">
			</ul>
		</div>
		<div id="editor"></div>
		<input class="terminal" placeholder="Write a terminal command here" >
	</div>
	<div class="dropdown-menu dropdown-menu-sm" id="context-menu">
		<a class="dropdown-item" onclick="selectContextMenuItem(event)" href="#">Menu Not Ready Yet</a>
		<a class="dropdown-item" onclick="selectContextMenuItem(event)" href="#">Menu Not Ready Yet</a>
		<a class="dropdown-item" onclick="selectContextMenuItem(event)" href="#">Menu Not Ready Yet</a>
    </div>
	<ul id="logList"></ul>



<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->
<!--##############################################################################################################################################-->


<script>
	'use strict';
    const {
		basicSetup,
		/* EditorView */
	} = CM["codemirror"];
    const {
		EditorView,
		keymap
	} = CM["@codemirror/view"];
    const {
		indentWithTab
	} = CM["@codemirror/commands"];
	const {
		javascript,
		javascriptLanguage
	} = CM["@codemirror/lang-javascript"];
	const {
		completeFromList
	} = CM["@codemirror/autocomplete"];
	let jsCompletion = completeFromList(Object.getOwnPropertyNames(window).map(p => {
		return {
			label: p,
			type: /^[A-Z]/.test(p) ? "class" : typeof window[p] == "function" ? "function" : "variable"
		};
	}));
	window.view = new EditorView({
		doc: window.sourceCode || '',
		extensions: [
			EditorView.updateListener.of(onEditorInput),
			basicSetup, 
			javascript(), 
			javascriptLanguage.data.of({
				autocomplete: jsCompletion
			}),
			keymap.of([indentWithTab])
		],
		parent: document.querySelector("#editor")
	});
	
	</script>
	<script type="text/javascript">
		
		document.querySelector('#editor').onclick = function(e) {
            document.querySelector("#context-menu").style.display = "none";
            return false; 
        }
		
		document.querySelector('#context-menu').onclick = function(e) {
            document.querySelector("#context-menu").style.display = "none";
            return false; 
        }

		document.querySelector('#editor').oncontextmenu = function(e) { 
            var top = e.pageY - 0;
            var left = e.pageX + 5;
            document.querySelector("#context-menu").style.display = "flex";
            document.querySelector("#context-menu").style.top = top+"px";
            document.querySelector("#context-menu").style.left = left+"px";
            return false; 
        }

        function selectContextMenuItem(event) {
        	console.log("menu clicked", event.target);
        }
		setTimeout(() => {
			selectFile();
		}, 300);

		document.querySelector('#editor').oninput = () => {
			document.querySelector('.fiction-item.active').classList.add("modified");
			let id = document.querySelector('.fiction-item.active').getAttribute('fiction-id');
			window.methodsObject.methodList[id].modified = true;
		}
	</script>
</body>
</html>

